Build1=Default,roman.app
File1=!finish-button arial bold 80.png
File10=6.png
File100=leaderboardbutton.png
File101=learning.png
File102=left-arrow.png
File103=levelLabel.png
File104=levelup.mp3
File105=levelup.png
File106=leveluplayout.bil
File107=lightbuilb-face.png
File108=lightning.png
File109=lightning2.png
File11=7.png
File110=literature.png
File111=lives.mp3
File112=loading.html
File113=loading_icon.gif
File114=mechanic.png
File115=mission-accomplished.png
File116=money-bag.gif
File117=moreapps.png
File118=movies.png
File119=music.png
File12=8.png
File120=next button.png
File121=no-internet.png
File122=options.png
File123=ornament.png
File124=outofliveslayout.bil
File125=pacific.jpg
File126=pawn.png
File127=philosophy.png
File128=photo-1515523110800-9415d13b84a8.jpeg
File129=physics.png
File13=80sMusic.png
File130=play-button.png
File131=pressstart.png
File132=pyramid.png
File133=qmarktutorialview.bil
File134=questionlayout.bil
File135=question-mark(3).png
File136=question-mark.png
File137=rating.png
File138=ratingtext.png
File139=realityTV.png
File14=9.png
File140=religion.png
File141=reportquestionlayout.bil
File142=reset.png
File143=resetscorelayout.bil
File144=return-to-the-past.png
File145=revWar.png
File146=right-arrow.png
File147=rising-sun.png
File148=rock.png
File149=rocket.png
File15=90s.png
File150=rome.JPG
File151=rome.png
File152=rome2.webp
File153=rome3.webp
File154=rome4.jpg
File155=rome5.jpg
File156=rome6.jpg
File157=rome7.jpg
File158=rook.png
File159=sailing.png
File16=90sMusic.png
File160=sailing3.jpg
File161=sale.png
File162=saleico.png
File163=science.png
File164=score.png
File165=scorepage.bil
File166=settings.png
File167=settingsbutton.png
File168=settingspage.bil
File169=share.png
File17=achievementbutton.png
File170=slam.mp3
File171=slash.png
File172=soviet-union.png
File173=spashscreen.bil
File174=sports.png
File175=start.gif
File176=startbutton3.gif
File177=startbutton4.gif
File178=startfinal.png
File179=startupoff.png
File18=add buff.png
File180=startupon.png
File181=statistics.png
File182=statisticsico.png
File183=statue-of-liberty.png
File184=store.png
File185=storebutton.png
File186=storetital.png
File187=talking.gif
File188=tech.png
File189=teststore.bil
File19=add-user.png
File190=tier1.png
File191=tier2.png
File192=tier3.png
File193=tier4.png
File194=tier5.png
File195=timedmode.png
File196=titlescreenlayout2.bil
File197=totalCoins.png
File198=transp.gif
File199=trophy.png
File2=0.png
File20=alphaview.png
File200=tutorial.png
File201=tv.png
File202=unchecked.png
File203=unchecked-white.png
File204=untitled-8.png
File205=up-arrow.png
File206=USgeo.png
File207=USHistory.png
File208=ussr2.jpg
File209=vehicles.png
File21=analytics.png
File210=verify.png
File211=warning.png
File212=whip.mp3
File213=whip.png
File214=windows.png
File215=worldgeography.png
File216=worldHistory.png
File217=world-wide-web.png
File218=wrong.mp3
File219=ww2.png
File22=anatomy.png
File220=yourscore.png
File221=yourscore2.png
File23=approve.png
File24=areyousuredialog.bil
File25=arrow.png
File26=arrow-right.png
File27=back-button.png
File28=banner.png
File29=baseball.png
File3=1.png
File30=basketball.png
File31=bear.png
File32=beatles.png
File33=bet.png
File34=bg1.gif
File35=bible.png
File36=bigfoot.png
File37=biology.png
File38=blastoff.mp3
File39=bolt.png
File4=10.png
File40=bulby-checks-falling.gif
File41=bulby-think.gif
File42=butterfly.png
File43=cancel.png
File44=categoryPage.bil
File45=categoryview.png
File46=cdl.png
File47=check(1).png
File48=check.png
File49=checkbox.png
File5=2.png
File50=checked-white.png
File51=chemistry.png
File52=christmas.png
File53=click.gif
File54=click.mp3
File55=click2.gif
File56=coinico.png
File57=coins.png
File58=coinsGained.png
File59=coinsLost.png
File6=3.png
File60=collectbutton.png
File61=completedgif.html
File62=config.properties
File63=correct.png
File64=correct.wav
File65=criminalHistory.png
File66=culture.png
File67=decline.png
File68=dialoglivestutorial.bil
File69=divide-mathematical-sign.png
File7=4.png
File70=down-arrow.png
File71=email.png
File72=emaillayout.bil
File73=end-trivia-button.png
File74=ExpandLayout.bil
File75=fashion.png
File76=finish.mp3
File77=finishbutton.gif
File78=finishfinal.png
File79=gear.png
File8=5.png
File80=geo.png
File81=golf.png
File82=groundhog.png
File83=heart.png
File84=heartbuff.png
File85=heartico.png
File86=high-score-edit.png
File87=history.png
File88=history-book.png
File89=holidays.png
File9=5050.png
File90=horse.png
File91=idea.gif
File92=ideas.png
File93=idol.png
File94=incorrect.png
File95=info.png
File96=introPage.bil
File97=islam.png
File98=islam1.jpg
File99=leaderboard.png
FileGroup1=Default Group
FileGroup10=numbers
FileGroup100=Default Group
FileGroup101=Default Group
FileGroup102=Default Group
FileGroup103=Default Group
FileGroup104=Default Group
FileGroup105=Default Group
FileGroup106=Default Group
FileGroup107=Default Group
FileGroup108=Default Group
FileGroup109=Default Group
FileGroup11=numbers
FileGroup110=Default Group\Cat Icons\New Group
FileGroup111=Default Group
FileGroup112=Default Group
FileGroup113=Default Group
FileGroup114=Default Group\Cat Icons
FileGroup115=Default Group
FileGroup116=New Group
FileGroup117=Default Group
FileGroup118=Default Group\Cat Icons
FileGroup119=Default Group\Cat Icons\Main Cat
FileGroup12=numbers
FileGroup120=Default Group
FileGroup121=Default Group
FileGroup122=New Group
FileGroup123=Default Group
FileGroup124=Default Group
FileGroup125=Default Group
FileGroup126=Default Group
FileGroup127=Default Group\Cat Icons\New Group
FileGroup128=Default Group
FileGroup129=Default Group\Cat Icons
FileGroup13=Default Group\Cat Icons
FileGroup130=Default Group
FileGroup131=Default Group
FileGroup132=Default Group\Cat Icons
FileGroup133=Default Group
FileGroup134=Default Group
FileGroup135=Default Group
FileGroup136=Default Group
FileGroup137=Default Group
FileGroup138=Default Group
FileGroup139=Default Group\Cat Icons\New Group
FileGroup14=numbers
FileGroup140=Default Group\Cat Icons\Main Cat
FileGroup141=Default Group
FileGroup142=Default Group
FileGroup143=Default Group
FileGroup144=Default Group
FileGroup145=Default Group\Cat Icons
FileGroup146=Default Group
FileGroup147=Default Group
FileGroup148=Default Group\Cat Icons
FileGroup149=Default Group
FileGroup15=Default Group\Cat Icons
FileGroup150=Default Group
FileGroup151=Default Group\Cat Icons
FileGroup152=Default Group
FileGroup153=Default Group
FileGroup154=Default Group
FileGroup155=Default Group
FileGroup156=Default Group
FileGroup157=Default Group
FileGroup158=Default Group
FileGroup159=Default Group\Cat Icons\New Group
FileGroup16=Default Group\Cat Icons
FileGroup160=Default Group
FileGroup161=Default Group
FileGroup162=Default Group
FileGroup163=Default Group\Cat Icons\Main Cat
FileGroup164=Default Group
FileGroup165=Default Group
FileGroup166=Default Group
FileGroup167=Default Group
FileGroup168=Default Group
FileGroup169=Default Group
FileGroup17=Default Group
FileGroup170=Default Group
FileGroup171=Default Group
FileGroup172=Default Group
FileGroup173=Default Group
FileGroup174=Default Group\Cat Icons\Main Cat
FileGroup175=Default Group
FileGroup176=Default Group
FileGroup177=Default Group
FileGroup178=Default Group
FileGroup179=New Group
FileGroup18=Default Group
FileGroup180=New Group
FileGroup181=Default Group
FileGroup182=Default Group
FileGroup183=Default Group
FileGroup184=Default Group
FileGroup185=Default Group
FileGroup186=Default Group
FileGroup187=Default Group
FileGroup188=Default Group\Cat Icons\Main Cat
FileGroup189=Default Group
FileGroup19=Default Group
FileGroup190=Default Group
FileGroup191=Default Group
FileGroup192=Default Group
FileGroup193=Default Group
FileGroup194=Default Group
FileGroup195=Default Group
FileGroup196=Default Group
FileGroup197=Default Group
FileGroup198=Default Group
FileGroup199=Default Group
FileGroup2=numbers
FileGroup20=New Group
FileGroup200=Default Group\Cat Icons\New Group
FileGroup201=Default Group\Cat Icons
FileGroup202=Default Group
FileGroup203=Default Group
FileGroup204=Default Group
FileGroup205=Default Group
FileGroup206=Default Group\Cat Icons\New Group
FileGroup207=Default Group\Cat Icons
FileGroup208=Default Group
FileGroup209=Default Group\Cat Icons\Main Cat
FileGroup21=Default Group
FileGroup210=New Group
FileGroup211=Default Group
FileGroup212=Default Group
FileGroup213=Default Group
FileGroup214=Default Group\Cat Icons
FileGroup215=Default Group\Cat Icons\New Group
FileGroup216=Default Group\Cat Icons
FileGroup217=Default Group
FileGroup218=Default Group
FileGroup219=Default Group\Cat Icons
FileGroup22=Default Group\Cat Icons
FileGroup220=Default Group
FileGroup221=Default Group
FileGroup23=Default Group
FileGroup24=Default Group
FileGroup25=New Group
FileGroup26=Default Group
FileGroup27=Default Group
FileGroup28=Default Group
FileGroup29=Default Group\Cat Icons\New Group
FileGroup3=Default Group
FileGroup30=Default Group\Cat Icons
FileGroup31=Default Group
FileGroup32=Default Group\Cat Icons
FileGroup33=Default Group
FileGroup34=Default Group
FileGroup35=Default Group\Cat Icons
FileGroup36=Default Group
FileGroup37=Default Group\Cat Icons
FileGroup38=Default Group
FileGroup39=Default Group
FileGroup4=numbers
FileGroup40=Default Group
FileGroup41=Default Group
FileGroup42=Default Group
FileGroup43=Default Group
FileGroup44=Default Group
FileGroup45=New Group
FileGroup46=Default Group\Cat Icons
FileGroup47=Default Group
FileGroup48=Default Group
FileGroup49=Default Group
FileGroup5=numbers
FileGroup50=Default Group
FileGroup51=Default Group\Cat Icons
FileGroup52=Default Group\Cat Icons\New Group
FileGroup53=Default Group
FileGroup54=Default Group
FileGroup55=Default Group
FileGroup56=Default Group
FileGroup57=Default Group
FileGroup58=Default Group
FileGroup59=Default Group
FileGroup6=numbers
FileGroup60=Default Group
FileGroup61=Default Group
FileGroup62=Default Group
FileGroup63=Default Group
FileGroup64=Default Group
FileGroup65=Default Group\Cat Icons\New Group
FileGroup66=Default Group\Cat Icons\Main Cat
FileGroup67=Default Group
FileGroup68=Default Group
FileGroup69=Default Group
FileGroup7=numbers
FileGroup70=Default Group
FileGroup71=Default Group
FileGroup72=Default Group
FileGroup73=Default Group
FileGroup74=Default Group
FileGroup75=Default Group\Cat Icons
FileGroup76=Default Group
FileGroup77=Default Group
FileGroup78=Default Group
FileGroup79=Default Group
FileGroup8=numbers
FileGroup80=Default Group\Cat Icons\Main Cat
FileGroup81=Default Group\Cat Icons
FileGroup82=Default Group
FileGroup83=Default Group
FileGroup84=Default Group
FileGroup85=Default Group
FileGroup86=Default Group
FileGroup87=Default Group\Cat Icons\Main Cat
FileGroup88=Default Group\Cat Icons\Main Cat
FileGroup89=Default Group\Cat Icons\Main Cat
FileGroup9=Default Group
FileGroup90=Default Group
FileGroup91=Default Group
FileGroup92=Default Group
FileGroup93=Default Group
FileGroup94=Default Group
FileGroup95=Default Group
FileGroup96=Default Group
FileGroup97=Default Group\Cat Icons
FileGroup98=Default Group
FileGroup99=Default Group
Group=Default Group
Library1=b4xgifview
Library10=ihud
Library11=inet
Library12=iphone
Library13=irandomaccessfile
Library14=istore
Library15=istringutils
Library16=iui8
Library17=iui9
Library18=ixui
Library19=keyvaluestore
Library2=iadmob
Library20=xui views
Library3=icircularprogress
Library4=icore
Library5=icustomdialog
Library6=ifirebaseanalytics
Library7=igamecenter
Library8=ihttp
Library9=ihttputils2
Module1=Assets
Module2=Assets2
Module3=DBRequestManager
NumberOfFiles=221
NumberOfLibraries=20
NumberOfModules=3
Version=8.9
@EndOfDesignText@
#Region Project Attributes
	#ApplicationLabel: Trivia Whip
	#Version: 1.6.6
	'Orientation possible values: Portrait, LandscapeLeft, LandscapeRight and PortraitUpsideDown
	#iPhoneOrientations: Portrait
	#iPadOrientations: Portrait
	#Target: iPhone
	 #ATSEnabled: True
	#MinVersion: 9
	#PlistExtra: <key>GADIsAdManagerApp</key><true/>
	#AdditionalLib: libsqlite3.dylib
	#AdditionalLib: libz.dylib
	#AdditionalLib: WebKit.framework
	#CertificateFile: ios_distribution.cer
		
	' CHANGE PROVISION FILE HERE
	#ProvisionFile: roman.mobileprovision
	'natesobol@gmail.com
	'mcab-qtfr-aczz-pyeq
	' AD STRING BEFORE STORE RELEASE*****
	#PlistExtra: <key>SKAdNetworkItems</key><array><dict><key>SKAdNetworkIdentifier</key><string>cstr6suwn9.skadnetwork</string></dict></array>
	#PlistExtra: <key>NSUserTrackingUsageDescription</key>
	#PListExtra: <string>This identifier will be used To deliver personalized ads To you.</string>
	#PlistExtra: <key>NSBltoothAlwaysUsageDescription</key><string>Used to integrate gmap framework.</string>
	
#If OBJC
#import <AVFoundation/AVFoundation.h>
- (void) setAudioSession {
[[AVAudioSession sharedInstance] setCategory: AVAudioSessionCategoryPlayback withOptions: AVAudioSessionCategoryOptionDefaultToSpeaker error: nil];
}
#end if

#if OBJC

-(void) trans: (UINavigationController*)nav :(NSString*)tp :(NSString*)from
{
CATransition *transition = [CATransition animation];
transition.duration = 0.3f;
transition.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];
transition.type = tp;
transition.subtype = from;
[nav.view.layer addAnimation:transition forKey:nil];
}

#End If

#if OBJC 
#import <AppTrackingTransparency/AppTrackingTransparency.h>
#import <AdSupport/AdSupport.h>
- (void)requestIDFA {
    if (@available(iOS 14, *)) {
      [ATTrackingManager requestTrackingAuthorizationWithCompletionHandler:^(ATTrackingManagerAuthorizationStatus status) {
          [self.bi raiseUIEvent:nil event:@"gad_trackingauthorization:" params:@[@(status)]];
      }];
    } else {
          [self.bi raiseUIEvent:nil event:@"gad_trackingauthorization:" params:@[@(3)]];
    }
}
#End If
' Courtney is the best 😘
#if OBJC
	- (NSArray *)GetAdaptiveSize:(float)width {
   GADAdSize g = GADCurrentOrientationAnchoredAdaptiveBannerAdSizeWithWidth(width);
   CGSize s = g.size;
   return @[[NSValue valueWithBytes: &g
               objCType:@encode(GADAdSize)], @(s.width), @(s.height)];
}
#End If

#if OBJC
@end
@interface B4IGameCenterViewControllerDelegate :NSObject<GKGameCenterControllerDelegate>
@end
@implementation B4IGameCenterViewControllerDelegate
- (void)gameCenterViewControllerDidFinish:(GKGameCenterViewController *)gameCenterViewController {
   [gameCenterViewController dismissViewControllerAnimated:YES completion:nil];
}
#End If

#if OBJC
@end
@interface B4IGameCenter (achievement)
@end
@implementation B4IGameCenter (achievement)
- (NSObject *)SubmitAchievement:(GKAchievement *)ach {
    [GKAchievement reportAchievements:@[ach] withCompletionHandler:^(NSError *e) {
        if (e != nil)
            [B4I shared].lastError = e;
        [B4IObjectWrapper raiseEventFromDifferentThreadWithExplicitSender:self :ach :@"_achievementsubmitted:" :@[@(e == nil)]];
    }];
    return ach;
}
#End If

#End Region
#UrlScheme: com.googleusercontent.apps.401551439279-ts8gqlldl88p0ptgv80to37gcgbkfkc0
Sub Process_Globals
	
	'GUI Frame
	Public App As Application
	Public NavControl As NavigationController
	Private Page1 As Page
	Private reportPage As Page
	Private splashPage As Page
	
	Dim masterQuestionText_Map As Map
	Dim mastercorrectAnswer_Map As Map
	Dim masterWrongAnswer1_Map As Map
	Dim masterWrongAnswer2_Map As Map
	Dim masterWrongAnswer3_Map As Map
	Dim masterQuestionCatagory_Map As Map
	Dim random As Int  = 0
	
	Type DBResult (Tag As Object, Columns As Map, Rows As List)
	Type DBCommand (Name As String, Parameters() As Object)
	Private const rdcLink As String = "http://192.168.0.6:17178/rdc"
	'Public rdcConnector1 As RDCConnector

	'GUI
	Private iad As InterstitialAd
	Private hud As HUD
	Private xui As XUI
	Private analytics As FirebaseAnalytics
	Private safari As SafariController
	
	' Title Layout
	Private playButton As Panel
	Private scoreLabel As Label

	'Question Layout
	Private questionLabel As Label
	Private aLabel As SwiftButton
	Private bLabel As SwiftButton
	Private cLabel As SwiftButton
	Private dLabel As SwiftButton
	Private nextQuestionButton As Panel
	Private skipButton As Panel
	Private AnimatedCounter1 As Label
	Private timerdescLabel As Label
	Private coinAddLabel As Label
	Dim DEV_COUNTER As Int = 0
	Dim peteCounter As Int = 0
	Dim globalindex2 As Int = 0
	Dim reremoveable As Boolean = False
	Dim backButtonBool As Boolean = False

	' Settings Layout
	Private ImageView1 As ImageView
	Private Switch1 As Switch
	Private backButton As Button
	Private Label2 As Label
	Private darkThemeLabel As Label
	Private Slider1 As Slider
	Private sliderNumber As B4XFloatTextField
	Private Button1 As Button
	Private settingsButton As ImageView
	Private isDark As Boolean
	Dim doneButton As BarButton
	Private quizLengthLabel As Label
	Private AdView1 As AdView
	
	'Achievement Layout
	Private milestoneProgressView As AnotherProgressBar
	Private levelLabel As Label
	Private milestoneProgressLabel As Label
	Private ImageView2 As ImageView
	Private ImageView3 As ImageView
	Private ImageView4 As ImageView
	Private finishButton As Panel
	Private AnotherProgressView1 As AnotherProgressBar
	Private finalScoreLabel As Label
	Private questionsRemainingLabel As Label
	Private achievementButton As ImageView
	Private miledesc As Label
	Private coinLabel As Label
	Dim checked As Bitmap
	Dim unchecked As Bitmap
	
	' Score Layout
	Private coinCountLabel As Label
	Private coinsGainedLabel As Label
	Private yourScoreIs As Label
	Private totalledUpCoinsLabel As Label
	Private yourTotalIs As Label
	
	'areyousure dialog Layout
	Private areyousureLabel As Label
	
	'Logical/Counters
	Dim canshownow As Boolean = False
	Dim questionCount As Int = 0
	Dim correctCount As Int = 0
	Dim incorrectCount As Int = 0
	Dim milestoneArray(63) As Int
	Dim quizCatagoryInt As Int = 0
	Dim correctInGame As Float = 0
	Dim questionAmount As Int = 0
	Dim coinDoubler As Float = 1
	Dim doubleCorrect As Float = 1
	Dim skipCost As Float = 1
	
	'String
	Dim pickerString As String
	Dim pickerString2 As String
	Private selectedString As Object
	Dim getLayoutName As String = ""
	Dim reportQuestionString As String = ""
	
	'Files & Lists
	Private kvscache As KeyValueStore
	Private settingsKvs As KeyValueStore
	Private coinKvs As KeyValueStore
	Private buffKvs As KeyValueStore
	Private emailKvs As KeyValueStore
	Private devKVS As KeyValueStore
	Private achieveKVS As KeyValueStore
	Private idolKvs As KeyValueStore
	Private inARowKvs As KeyValueStore
	Private livesKVS As KeyValueStore
	Private saveOldKvs As KeyValueStore
	Private titleKvs As KeyValueStore
	Public catKvs As KeyValueStore
	Public subCatKvs As KeyValueStore 
	Public ratioKvs As KeyValueStore
	Public catPageKvs As KeyValueStore
	Public toggleAlphaKvs As KeyValueStore
	Public toggleCatStartupKvs As KeyValueStore
	Private pickerList As List
	Private pickerList2 As List
	Dim newQ As Boolean = True
	
	' misc
	Dim dropdowncount As Int = 0
	Dim mileStoneMap As Map
	Private backButtonQuiz As Button
	Private milestoneLabel As Label
	Private TimerIdfa As Timer
	Private scoreInfoLabel As Label
	Private timeModeInfoButton As ImageView
	Private achDescLabel As Label
	Private achInfoButton As ImageView
	Private analyticsLabel As Label
	Private ImageView6 As ImageView
	Private Game As GKGameCenter
	Private analyticInfoLabel As Label
	Private gameViewButton As ImageView
	Private versionNumber As Label
	Dim MyStore As Store
	Private lblUser As Label
	Private btnSignIn As Button
	Private txtScore As Label
	Private btnSubmit As Button
	Private CustomListView1 As CustomListView

'	Dim bannerAdString As String = "ca-app-pub-3472531531906905/9126474617"
'	Dim institualAdString As String = "ca-app-pub-3472531531906905/7749566342"
	Dim bannerAdString As String = "ca-app-pub-3472531531906905/9126474617"
	Dim institualAdString As String = "ca-app-pub-3472531531906905/7749566342"
	Private sendEmailButton As ImageView
	Private returnEmailField As TextField
	Private subjectField As TextField
	Private bodyField As TextView
	Private emailButton As SwiftButton
	Private emailTitleLabel As Label
	Private emailLabel As Label
	Private subjectLabel As Label
	Private bodyLabel As Label
	Private developerSiteButton As ImageView
	Private triviaCompleteWebview As WebView
	Private questionsPanel As Panel
	Private resetScoreButton As ImageView
	Private developerSiteButton2 As ImageView
	Private AnotherProgressBar1 As AnotherProgressBar
	Private leaveReviewButton As ImageView
	Private checkMarkImageView As ImageView
	Private AnotherProgressBar2 As AnotherProgressBar
	Private questionBackgroundPanel As Panel
	Private progressLabelLabel As Label
	Private colorview9 As ImageView
	Private colorview8 As ImageView
	Private colorview7 As ImageView
	Private colorview6 As ImageView
	Private coloview5 As ImageView
	Private colorview4 As ImageView
	Private colorview3 As ImageView
	Private colorview1 As ImageView
	Private colorPanel As Panel
	Private buySchemeButton As SwiftButton
	Private buySchemeLabel As Label
	Private buyAvatarLabel As Label
	Private butAvatarButton As SwiftButton
	Private colorview2 As ImageView
	Dim colorArray() As Int
	colorArray = Array As Int(xui.Color_RGB(255,255,255), xui.Color_RGB(220,220,220))
	Private storeButton As ImageView
	Private avatarView1 As ImageView
	Private avatarView2 As ImageView
	Private avatarView3 As ImageView
	Private avatarView4 As ImageView
	Private avatarView5 As ImageView
	Private avatarView6 As ImageView
	Private avatarView7 As ImageView
	Private avatarView8 As ImageView
	Private avatarView9 As ImageView
	Dim viewName As String
	Private titleAvatarView As ImageView
	Private titleUsername As Label
	Private avatarPanel As Panel
	Private avatarTitlePanel As Panel
	Private storeTitleLabel As Label
	Private scoreInfoButton As ImageView
	Private titleTotalCorrectLabel As Label
	Private myNameLabel As Label
	Private developerSiteButton3 As ImageView
	Private tableBackPanel As Panel
	Private hiScoreLabel As Label
	Private timerLabel As Label
	Private removeAdsLoading As B4XLoadingIndicator
	Private removeAdsLabel As Label
	Private removeAdsSwitch As Switch
	Private shareToSocial As Button
	Private scoreLabelLabel As Label
	Private splashtest As Button
	Private CustomListView2 As CustomListView
	Private incorrectLabel As Label
	Private leaderboardTitleLabel As Label
	Private settingsTitleLabel As Label
	Private achTitleLabel As Label
	Private timer1 As Timer
	Private targetTime As Long
	Dim ping As MediaPlayer
	Dim lvlpanel As Panel
	Dim hasConnection As Boolean = True
	Private correctImgView As ImageView
	Private incorrectImgView As ImageView
	Private muteLabel As Label
	Private muteSwitch As Switch
	Private labelExitAnalytic As ImageView
	Private correctInfoLabel As Label
	Private correctInfoButton As ImageView
	Private labelExitCorrectInfo As ImageView
	Private exitLabelScoreInfo As ImageView
	Private exitAchInfo As ImageView
	Private exitTimerInfo As ImageView
	Private buyBuffLabel As Label
	Private buyBuffButton As SwiftButton
	Private doubleCoinsButton As ImageView
	Private doubleCorrectButton As ImageView
	Private skipReductionButton As ImageView
	Private buffPanel As Panel
	Private reportQuestionButton As ImageView
	Private storeCoinLabel As Label
	Private titleLabel As Label
	Private unlock1 As ImageView
	Private unlock2 As ImageView
	Private unlock3 As ImageView
	Private coinsInfoButton As ImageView
	Private coinsInfoLabel As Label
	Private labelexitCoins As ImageView
	Private reportToQuizButton As Button
	Private noConnectionImageView As ImageView
	Private closeSplash As Button
	Private nextQuestion As Panel
	Private nextQuestionLabel As Label
	Private skipLabel As Label
	Private analyticButton As SwiftButton
	Private exitHintButton As ImageView
	Private hintInfoButton As ImageView
	Private hintInfoLabel As Label
	Private emailLoadingIndicator As B4XLoadingIndicator
	Private topBarPanel As Panel
	Private testLeader As Button
	Private restorePurchasesButton As ImageView
	Private testLeader2 As Button
	Private emailLogo As ImageView
	Private timedModeButton As ImageView
	Private achievementModeButton As ImageView
	Private timedHighlight As ImageView
	Private achieveHighlight As ImageView
	Private userPanel As Panel
	Private questionMarkSwitch As Switch
	Private questionMarkLabel As Label
	Private nextQuestionImage As ImageView
	Private levelGainedImage As ImageView
	Private newLevelLabel As Label
	Dim ingame As Boolean = True
	Dim idolFlag As Boolean = False
	Dim globalindex As Int
	Private finshLevelLabel As Label
	Private titleCoinAddLabel As Label
	Private levelCoinsAddLabel As Label
	Private levelUpPanel As Panel
	Private collectButton As Button
	Private questionProgressBar As AnotherProgressBar
	Private shareButton As ImageView
	Private idol1 As ImageView
	Private idol2 As ImageView
	Private idol3 As ImageView
	Private questionIdol As ImageView
	Private idolButton As ImageView
	Private buyIdolLabel As Label
	Private devPW As TextField
	Private storeAvatarView As ImageView
	Private aPanel As Panel
	Private coinsSpentLabel As Label
	Private coinsSpent As Label
	Private livesLabel As Label
	Private heartBuffButton As ImageView
	Private idol4 As ImageView
	Private idol5 As ImageView
	Private correctAddLabel As Label
	Private livesImageView As ImageView
	Dim pulseTimer As Timer
	Dim Button1X As Int
	Dim Button1Y As Int
	Dim Button1SizeX As Int
	Dim Button1SizeY As Int
	Dim Button1ThrobX As Int
	Dim Button1ThrobY As Int
	Private buffLabelPanel As Panel
	Private Label10 As Label
	Private progressPanel As Panel
	Private buffSlot1 As ImageView
	Private buffSlot2 As ImageView
	Private buffSlot3 As ImageView
	Private buffSlot4 As ImageView
	Private div2 As Panel
	Private div1 As Panel
	Private idolPanel As Panel
	Private check1 As ImageView
	Private check2 As ImageView
	Private check3 As ImageView
	Private check4 As ImageView
	Private check5 As ImageView
	Private statsPanel As Panel
	Private buffPerkPanel As Panel
	Private coinsPanel As Panel
	Private menuButtonsPanel As Panel
	Private titlePanel As Panel
	Private titleProgressPanel As Panel
	Private pickerPanel As Panel
	Private coinSubtLabel As Label
	Private correctSubtLabel As Label
	Private roundScoreLabel As Label
	Private sendEmailPanel As Panel
	Private devSitePanel As Panel
	Private resetScorePanel As Panel
	Private leaveReviewPanel As Panel
	Private shareAppPanel As Panel
	Private restorePurchPanel As Panel
	Private sliderLabel As Label
	Private resetScoreInfoLabel As Label
	Private restorePurchInfoLabel As Label
	Private restorePurchInfoButton As ImageView
	Private resetScoreInfoButton As ImageView
	Private exitResetInfoLabel As ImageView
	Private exitRestorePurch As ImageView
	Private incorrectIcon As ImageView
	Private correctIcon As ImageView
	Private liveSubtLabel As Label
	Dim timer2 As Timer
	Dim debugFlag As Boolean = False
	Private VideoPlayer1 As VideoPlayer
	Private heartViewTutorial As Button
	Private CircularProgress1 As CircularProgress
	Private Panel1 As Panel
	Private ornament As ImageView
	Private finishCircularProgress As CircularProgress
	Private skipImage As ImageView
	Private livesLabelTutorial As Label
	Private masterPanelSettings As Panel
	Private masterPanelTitle As Panel
	Private centerPanel As Panel
	Private B4XGifView1 As B4XGifView
	Private clickpanel As Panel
	Private B4XGifView2 As B4XGifView
	Private practiceModeButton As ImageView
	Private practiceModeHighlight As ImageView
	Private practiceModeInfoButton As ImageView
	Private practiceModeLabel As Label
	Private practiceModeDesc As Label
	Private exitPracticeDesc As ImageView
	Private endGifView As B4XGifView
	Dim questionDoneMap As Map
	Private qmarkViewTutorial As Button
	Private masterPanelQuestions As Panel
	Private levelupBackground As ImageView
	Private bulbyintrolabel As Label
	Private levelupgif As B4XGifView
	Dim one As Bitmap
	Dim two As Bitmap
	Dim three As Bitmap
	Dim four As Bitmap
	Dim five As Bitmap
	Dim six As Bitmap
	Dim seven As Bitmap
	Dim eight As Bitmap
	Dim nine As Bitmap
	Dim ten As Bitmap
	Dim zero As Bitmap
	' main cat bitmaps
	Dim ScienceImage As Bitmap
	Dim historyImage As Bitmap
	Dim cultureImage As Bitmap
	Dim musicImage As Bitmap
	Dim sportsImage As Bitmap
	Dim religionImage As Bitmap
	Dim vehicleImage As Bitmap
	Dim techImage As Bitmap
	Dim geoImage As Bitmap	
	Dim geoImage As Bitmap	
	Dim humanitiesImage As Bitmap
	Dim holidaysImage As Bitmap
	
	' in alphabetical order
	Dim anatomy As Bitmap
	Dim egyptIcon As Bitmap
	Dim baseball As Bitmap
	Dim basketball As Bitmap
	Dim beatles As Bitmap
	Dim bible As Bitmap
	Dim biology As Bitmap
	Dim cdl As Bitmap
	Dim mechanic As Bitmap
	Dim chemistry As Bitmap
	Dim christmas As Bitmap
	Dim crimeHistory As Bitmap
	Dim eightiesMusic As Bitmap
	Dim fashion As Bitmap
	Dim golf As Bitmap
	Dim islam As Bitmap
	Dim literature As Bitmap
	Dim movies As Bitmap
	Dim ninetiesCulture As Bitmap
	Dim nintiesMusic As Bitmap
	Dim philosophy As Bitmap
	Dim physics As Bitmap
	Dim realityTV As Bitmap
	Dim revWar As Bitmap
	Dim rock As Bitmap
	Dim rome As Bitmap
	Dim sailing As Bitmap
	Dim tutorial As Bitmap
	Dim TV As Bitmap
	Dim US As Bitmap
	Dim USGeography As Bitmap
	Dim windows As Bitmap
	Dim worldHistory As Bitmap
	Dim worldGeography As Bitmap
	Dim WWTwo As Bitmap
	Private number1 As ImageView
	Private number2 As ImageView
	Private slashImageView As ImageView
	Private levelLabelImageView As ImageView
	Private levelImageView1 As ImageView
	Private levelImageView2 As ImageView
	Private gainedImageView1 As ImageView
	Private gainedImageView2 As ImageView
	Private gainedImageView3 As ImageView
	Private lostImageView1 As ImageView
	Private lostImageView2 As ImageView
	Private lostImageView13 As ImageView
	Private totalImageView1 As ImageView
	Private totalImageView2 As ImageView
	Dim dropDownBool As Boolean = False
	Private totalImageView3 As ImageView
	Private lostImageView3 As ImageView
	Private totalImageView4 As ImageView
	Private categoryListView As CustomListView
	Public catList As List 
	Public subCatListScience As List 
	Public subCatListHistory As List 
	Public subCatListCulture As List 
	Public subCatListMusic As List 
	Public subCatListSports As List 
	Public subCatListReligion As List 
	Public subCatListVehicle As List 
	Public subCatListTech As List 
	Public subCatListGeography As List 
	Public subCatListHumanities As List 
	Public subCatListHolidays As List 
	Public subCatList As List 
	Public subCatImages As List
	Public mainCatImages As List
	Private catButton As ImageView
	Private clvCheckedLegendLabel As Label
	Private catNameLegendLabel As Label
	Private catTitleLabel As Label
	Private titleCatCLV As CustomListView
	Private clickGifView As B4XGifView
	Private clickTutorialPanel As Panel
	Private clickTutorialMasterPanel As Panel
	Private questionCatLabel As Label
	Private questionSubCatLabel As Label
	Dim panelCount As Int = 0
	Private lblTitle As Label
	Private pnlExpanded As Panel
	Private ExpandDropDownArrow As ImageView
	Private catChkImgView As ImageView
	Private catPanel As Panel
	Private catDoneButton As Panel
	Private AlphabeticalToggleButton As Panel
	Private doneImageView As ImageView
	Private liveTutorialImagePanel As Panel
	Private bulbyTextImageView As ImageView
	Private catViewOnStartButton As Panel
	Private catViewOnStartImg As ImageView
	Private AlphabeticalToggleImg As ImageView
	Dim startUpOffBitmap As Bitmap
	Dim startUpOnBitmap As Bitmap
	Dim categoryViewBitmap As Bitmap
	Dim alphaViewBitmap As Bitmap
	Private subCatImageView As ImageView
	Private nameLabel As Label
	Private catScreenLoadingIndicator As B4XLoadingIndicator
	Private doneButtonIntro As Button
	Private coinsGifViewIntro As B4XGifView
	Private ScrollView1 As ScrollView
End Sub

Private Sub Application_Start (Nav As NavigationController)
	Try
		'GUI Initialize/Priority functions
		NavControl = Nav
		titleKvs.Initialize(File.DirDocuments, "titleKvs.dat")
		'titleKvs.Put("1", 1)
		Dim t As Int
		t = Rnd(1,7)
		Me.As(NativeObject).RunMethod("setAudioSession", Null) 
'		If titleKvs.ContainsKey("1") = False Or t = 3 Then
'			splashPage.Initialize("splashscreen")
'			splashPage.RootPanel.LoadLayout("spashscreen")
'			VideoPlayer1.LoadVideo(File.DirAssets, "romanicon.mp4")
'			VideoPlayer1.Play
'			NavControl.ShowPage(splashPage)
'			NavControl.NavigationBarVisible = False
'			VideoPlayer1.ShowControls = False
'			wait for VideoPlayer1_Complete
'			VideoPlayer1.Pause
'		End If
		Log(VideoPlayer1.Duration)
	
		MainPageINIT
	Catch
		hud.ToastMessageShow(LastException, False)
		catchToFirebase(LastException)
	End Try
End Sub

Sub runVideo
'	splashPage.Initialize("splashscreen")
'	splashPage.RootPanel.LoadLayout("spashscreen")
'	VideoPlayer1.LoadVideo(File.DirAssets, "romanicon.mp4")
'	VideoPlayer1.Play
'	NavControl.ShowPage(splashPage)
'	NavControl.NavigationBarVisible = False
'	VideoPlayer1.ShowControls = False
'	wait for closeSplash_Click
'	VideoPlayer1.Pause
'	splashPage.RootPanel.RemoveAllViews
'	Page1.RootPanel.RemoveAllViews
End Sub

Sub MainPageINIT
	Try
		toggleAlphaKvs.Initialize(File.DirDocuments, "toggleAlphaKvs.dat")
		toggleCatStartupKvs.Initialize(File.DirDocuments, "toggleCatStartupKvs.dat")
		catKvs.Initialize(File.DirDocuments, "catKvs.dat")
		subCatKvs.Initialize(File.DirDocuments, "subCatKvs.dat")
		catList.Initialize
		subCatImages.initialize
		mainCatImages.Initialize
		subCatListScience.Initialize
		subCatListHistory.Initialize
		subCatListCulture.Initialize
		subCatListMusic.Initialize
		subCatListSports.Initialize
		subCatListReligion.Initialize
		subCatListVehicle.Initialize
		subCatListTech.Initialize
		subCatListGeography.Initialize
		subCatListHumanities.Initialize
		subCatListHolidays.Initialize
		subCatList.Initialize
		getCatList
		getSubCatList
		getSubCatImages
		getMainCatImages
		catKvsInit
		catSettingsKVSinit
		setCatBitmaps
		subCatKvsInit
		Dim no As NativeObject = Me
		no.RunMethod("requestIDFA", Null)
'		Dim version As Object = no.RunMethod("objectForInfoDictionaryKey:", Array("CFBundleShortVersionString"))
			
		settingsKvs.Initialize(File.DirDocuments, "settings.dat")
		settingsKvsSetup
		Page1.Initialize("Page1")
		analytics.Initialize
		iad.Initialize("iad", institualAdString)
		analytics.SendEvent("app_launched", Null)
		Page1.Title = "Trivia Whip"
		Page1.RootPanel.RemoveAllViews
		NavControl.NavigationBarVisible = False
		
		Dim catPageBool As Boolean = False
		catPageKvs.Initialize(File.DirDocuments, "catPageKvs.dat")
		If catPageKvs.ContainsKey("1") == False Then
			catPageKvs.Put("1", False)
		End If
		If catPageBool == False And toggleCatStartupKvs.Get("1") == False Then
			backButtonBool = False
			catButton_Click
			analytics.SendEvent("cat_page_startup",Null)
			getCatSettings
			catPageBool = True
			backButton.Visible = False
			Wait For catDoneButton_Click
			catScreenLoadingIndicator.mBase.Visible = True
			Page1.RootPanel.RemoveAllViews
			catScreenLoadingIndicator.mBase.Visible = False
			backButtonBool = True
		else if toggleCatStartupKvs.Get("1") Then
			backButtonBool = True
		End If
		
		Page1.RootPanel.LoadLayout("introPage")
		showPage(NavControl,Page1,3)
		coinsGifViewIntro.SetGif(File.DirAssets, "money-bag.gif")
		wait for doneButtonIntro_Click
		Page1.RootPanel.RemoveAllViews
'		
		
		' Load title Screen
		Page1.RootPanel.LoadLayout("titleScreenLayout2")
		analytics.SendEvent("title_screen_startup",Null)
		fillMilestoneArray
		showPage(NavControl,Page1,3)
		getTitleImage
		TitlePageDesignerScript
		timer1.Initialize("timer1", 1000)
		timer2.Initialize("timer2", 1000)
		doneButton.InitializeCustom(Page1)

		' KVS Inits
		kvscache.Initialize(File.DirDocuments, "kvs_file.dat")
		coinKvs.Initialize(File.DirDocuments, "coins.dat")
		buffKvs.Initialize(File.DirDocuments, "buff.dat")
		emailKvs.Initialize(File.DirDocuments, "email.dat")
		devKVS.Initialize(File.DirDocuments, "dev.dat")
		achieveKVS.Initialize(File.DirDocuments, "achieve.dat")
		idolKvs.Initialize(File.DirDocuments, "idol.dat")
		inARowKvs.Initialize(File.DirDocuments, "row.dat")
		livesKVS.Initialize(File.DirDocuments, "lives.dat")
		saveOldKvs.Initialize(File.DirDocuments, "old.dat")
		ratioKvs.Initialize(File.DirDocuments, "ratioKvs.dat")
		
		initMaps

		' Misc Inits
		TimerIdfa.Initialize("TimerIdfa", 2000)
		TimerIdfa.Enabled = True
		MyStore.Initialize("MyStore")
		Game.Initialize("GameCenter")
		'Page1.RootPanel.SetLayoutAnimated(0, 0, 0, 0, Page1.RootPanel.Width, Page1.RootPanel.Height)
		Sleep(0)

		B4XGifView1.SetGif(File.DirAssets, "startButton4.gif")
		'B4XGifView1.
		
		If titleKvs.ContainsKey("1") = False Then
			qmarkTutorialDialog	
		End If
		clicktutorial
		If devKVS.ContainsKey("1") = False Then
			devKVS.Put("1",0)
		End If

		If IsDebug Then
			debugFlag = True
		Else
			debugFlag = False
		End If
				
		'KVS Validation
		
		buffKvsSetup
		emailKvsSetup
		buffIconTitle
		idolIconTitle
		idolKvsSetup
		inARowKvsSetup
		saveOldKvsSetup
		coinKvsSetup
		kvsCacheSetup
		
		'livesKvsSetup
		StartTimer2(10)
		isAdRemoved ' checks if ads are bought
				
		' Sets title Theme
		If 1 == settingsKvs.Get("1") Then
			titleDarkTheme
		Else
			titleLightTheme
		End If
				
		'Gui computation
		getTitleCatCLVItems
		titleButtonColor
		'playPulseAnimation(playButton)
		pickStoreItems
		titleAvatarView.Bitmap= LoadBitmap(File.DirAssets, viewName)
		avatarTitlePanel.Color = colorArray(0)
		coinLabel.Text = (coinKvs.Get("1"))
		disableQuestionMark
		'Get Ads
		'getBannerAd
		loadToggleButtons
				
		'Last priority/gui computation
		Switch1.Initialize(0)
		milestoneProgressTitle(milestoneProgressView)
		titleUsername.Text = Game.LocalPlayer.DisplayName
		titleTotalCorrectLabel.text = Round(kvscache.get("1"))
		pickBuffTitle(buffKvs.Get("1"))
		
	Catch
		Log(LastException)
		catchToFirebase(LastException)
	End Try
End Sub

Sub backButtonAnimation
	For i = 0 To Page1.RootPanel.NumberOfViews-1
		Page1.RootPanel.GetView(i).SetAlphaAnimated(100, 0)
	Next
	
End Sub

Sub catchToFirebase(exception As String)
	analytics.SendEvent(exception, Null)
End Sub

Sub initMaps
	masterQuestionText_Map.Initialize
	mastercorrectAnswer_Map.Initialize
	masterWrongAnswer1_Map.Initialize
	masterWrongAnswer2_Map.Initialize
	masterWrongAnswer3_Map.Initialize
	masterQuestionCatagory_Map.Initialize
End Sub

Sub TitlePageDesignerScript
	Dim MiddleofPanel As Int= masterPanelTitle.Width/2
	titlePanel.Left = MiddleofPanel - titlePanel.Width/2
	titleProgressPanel.Left = MiddleofPanel - titleProgressPanel.Width/2
	menuButtonsPanel.Left = MiddleofPanel - menuButtonsPanel.Width/2
	playButton.Left = MiddleofPanel - playButton.Width/2
	Dim playSpacing As Int  = (playButton.Height - timedModeButton.Height)/2
	timeModeInfoButton.left = timedModeButton.Left + timedModeButton.Width - (timeModeInfoButton.Width/2)
	timeModeInfoButton.top = timedModeButton.Top - (timeModeInfoButton.Height/2)
End Sub

Private Sub VideoPlayer1_Complete
	NavControl.RemoveCurrentPage
	MainPageINIT
End Sub

Sub setCatBitmaps
	startUpOffBitmap.Initialize(File.DirAssets, "startupoff.png")
	startUpOnBitmap.Initialize(File.DirAssets, "startupon.png")
	categoryViewBitmap.Initialize(File.DirAssets, "categoryview.png")
	alphaViewBitmap.Initialize(File.DirAssets, "alphaview.png")
End Sub

private Sub videoComplete
	'NavControl.ShowPage(Page1)
End Sub

Sub IsDebug As Boolean
 #If DEBUG
	Return True
 #Else
   Return False
 #End If
End Sub

Sub isAdRemoved
	If 1 == settingsKvs.Get("5") Then
		bannerAdString = ""
		institualAdString = ""
	End If
End Sub

Sub getCatSettings
	If toggleCatStartupKvs.Get("1") == False Then
		catViewOnStartImg.Bitmap = startUpOnBitmap
		Else
		catViewOnStartImg.Bitmap = startUpOffBitmap
	End If
	If toggleAlphaKvs.Get("1") == False Then
		AlphabeticalToggleImg.Bitmap = categoryViewBitmap
		Else
			AlphabeticalToggleImg.Bitmap = alphaViewBitmap
	End If
End Sub

Sub catSettingsKVSinit
	If toggleCatStartupKvs.ContainsKey("1") == False Then
		toggleCatStartupKvs.Put("1", False)
	End If
	If toggleAlphaKvs.ContainsKey("1") == False Then
		toggleAlphaKvs.Put("1", False)
	End If
End Sub

Sub kvsCacheSetup
	If kvscache.ContainsKey("1") = False Then	'Checks to see if kvs file exists
		kvscache.Put("1", 0)
	End If
	If kvscache.ContainsKey("2") = False Then
		kvscache.Put("2", 1)
	End If
	If kvscache.ContainsKey("3") = False Then
		kvscache.Put("3", 0)
	End If
	If kvscache.ContainsKey("7") = False Then
		kvscache.Put("7", 0)
	End If
	If kvscache.ContainsKey("8") = False Then
		kvscache.Put("8", 0)
	End If
End Sub

Sub coinKvsSetup 'Coins
	
	If coinKvs.ContainsKey("1")  = False Then
		coinKvs.Put("1", 0)
		coinLabel.Text = "0"
	End If
	If coinKvs.ContainsKey("2")  = False Then
		coinKvs.Put("2", 0)    ' Amount spent in the store
	End If
	
	If coinKvs.ContainsKey("3")  = False Then
		coinKvs.Put("3", 0)    ' Amount Spent in a game
	End If
End Sub

Sub storeIdolView
	If 0 = idolKvs.Get("1") Then
		disableIdolView(Null)
	End If
	If 1 == idolKvs.Get("1") Then
		disableIdolView(idol1)
	End If
	If 2 == idolKvs.Get("1") Then
		disableIdolView(idol2)
	End If
	If 3 == idolKvs.Get("1") Then
		disableIdolView(idol3)
	End If
	If 4 == idolKvs.Get("1") Then
		disableIdolView(idol4)
	End If
	If 5 == idolKvs.Get("1") Then
		disableIdolView(idol5)
	End If
End Sub

Sub playPulseAnimation(view As Button)
	Button1SizeX = view.Width
	Button1SizeY = view.Height
	Button1X = view.Left
	Button1Y = view.Top
	Button1ThrobX = Min(Button1SizeX, Button1SizeY) * 0.05   'relative throb size 5%
	Button1ThrobY = Button1ThrobX    'same throb for both axes
	pulseTimer.Initialize("playButton", 1000 / 15)    '15 frames per second
	pulseTimer.Enabled = True
End Sub




Sub playButton_Tick
	Dim Phase As Double = Sin(DateTime.Now / (4000 / 3.14159 / 2))    'cycle time (throb period?) 2 seconds (2000 ms)
	If heartViewTutorial.IsInitialized And Not(levelUpPanel.Tag = "title") And Not(levelUpPanel.Tag = "finish") Then
		Dim ThrobX As Int = Button1ThrobX * Phase
		Dim ThrobY As Int = Button1ThrobY * Phase
		heartViewTutorial.Left = Button1X + ThrobX
		heartViewTutorial.Top = Button1Y + ThrobY
		heartViewTutorial.SetLayoutAnimated(0, 1, heartViewTutorial.Left, heartViewTutorial.Top,Button1SizeX - 2 * ThrobX, Button1SizeY - 2 * ThrobY)
	End If
End Sub

Sub saveOldKvsSetup
	If saveOldKvs.ContainsKey("1") = False Or saveOldKvs.ContainsKey("2") = False Or saveOldKvs.ContainsKey("3") = False Then
		saveOldKvs.Put("1", 0)
		saveOldKvs.Put("2", 0)
		saveOldKvs.Put("3", 0)
	End If
End Sub

Sub saveOldKvsSet
	saveOldKvs.Put("1", kvscache.Get("1"))
	saveOldKvs.Put("2", coinKvs.Get("1"))
	saveOldKvs.Put("3", kvscache.Get("2"))
End Sub

Sub saveOldKvsGet
	kvscache.Put("1", saveOldKvs.Get("1"))
	coinKvs.Put("1", saveOldKvs.Get("2"))
	kvscache.Put("2", saveOldKvs.Get("3"))
End Sub

Sub TimerIdfa_Tick
	CheckIdfa
End Sub

Sub fillMilestoneArray
	Dim d As Int = 5
	Dim c As Int = 0
	Dim i As Int = 0
	Do While i < 10000
		i = i + d
		d = d+5
		milestoneArray(c) = i
		c = c+1
	Loop
	Log("Length: " & c)
End Sub

Sub emailKvsSetup
	If emailKvs.ContainsKey("1") = False Then
		emailKvs.Put("1", "")
	End If
End Sub


Sub milestoneProgressTitle(progressView As AnotherProgressBar)
	getKvsCache
	progressView.ValueChangePerSecond = 40
	progressView.mBase.SetColorAndBorder(xui.Color_RGB(0, 0, 0), 2,xui.Color_RGB(0, 0, 0),4)
	If  1 == kvscache.Get("2") Then
		progressView.Value = (kvscache.Get("1")/5) * 100
		If Page1.RootPanel.alpha = 1 Then
			levelLabel.Text = "Level: " & (kvscache.Get("2"))
		Else
			levelLabel.Text = "L. " & (kvscache.Get("2"))
		End If
		milestoneProgressLabel.text = Round(kvscache.get("1")) & "/" & "5"
		kvscache.Put("3", 0)
	Else
		Dim firstParam As Int = kvscache.Get("1") - milestoneArray(kvscache.Get("2")-2)
		Dim secondParam As Int = (milestoneArray(kvscache.Get("2")-1) - (milestoneArray(kvscache.Get("2")-2)))
		progressView.Value= (firstParam/secondParam) * 100
		Log("# of Views: " & Page1.RootPanel.NumberOfViews)
		If Page1.RootPanel.alpha = 1 Then
			levelLabel.Text = "Level: " & (kvscache.Get("2"))
		Else
			levelLabel.Text = "L. " & (kvscache.Get("2"))
		End If
		milestoneProgressLabel.Text = firstParam&"/"&secondParam
	End If
End Sub

Sub clearKVS    ' Test Mode ONLY
	kvscache.Put("1", 0)
	kvscache.Put("2", 1)
	kvscache.Put("3", 0)
	kvscache.Put("4", 0)
	kvscache.Put("5", 0)
	kvscache.Put("6", 0)
	kvscache.Put("7", 0)
End Sub

Sub livesKvsSetup
	If 1 == buffKvs.Get("6") Then
		livesKVS.Put("1", 6 * (settingsKvs.Get("4")/10))
	Else
		livesKVS.Put("1", 5 * (settingsKvs.Get("4")/10))
	End If
	If 0 == settingsKvs.Get("4") Then
		If 1 == buffKvs.Get("6") Then
			livesKVS.Put("1", 6)
		Else
			livesKVS.Put("1", 5)
		End If
	End If
	If 1 == settingsKvs.Get("10") Then
		livesKVS.Put("1", 1000)
	End If
End Sub

Sub settingsKvsSetup
	If settingsKvs.ContainsKey("1")  = False Or settingsKvs.ContainsKey("2") = False Or settingsKvs.ContainsKey("3")  = False Or settingsKvs.ContainsKey("4") = False Or settingsKvs.ContainsKey("5") = False Or settingsKvs.ContainsKey("6") = False Or settingsKvs.ContainsKey("7")  = False Or settingsKvs.ContainsKey("8")  = False Or settingsKvs.ContainsKey("9")  = False Or settingsKvs.ContainsKey("10")  = False Then
		settingsKvs.Put("1", 0) ' dark/light theme
		settingsKvs.Put("2", 0) 'timer mode
		settingsKvs.Put("3", 0) ' achievement mode
		settingsKvs.Put("4", 10) ' Slider value
		settingsKvs.Put("5", 0) ' Ads removed
		settingsKvs.Put("6", 0) ' Scheme Color
		settingsKvs.Put("7", 0) ' Avatar
		settingsKvs.Put("8", 1) ' Mute
		settingsKvs.Put("9", 0) ' Enable Question Buttons
		settingsKvs.Put("10", 0) ' picker choice
		Log("CREATING NEW SETTINGSKVS FILE")
	End If
End Sub

Sub inARowKvsSetup
	If inARowKvs.ContainsKey("1") = False Then
		inARowKvs.Put("1", 0)
		Log("inARowKvs: " & inARowKvs.Get("1"))
	End If
End Sub

Sub idolKvsSetup
	If idolKvs.ContainsKey("1") = False Then
		idolKvs.Put("1", 0)
		Log("IDOLKVS: " & idolKvs.Get("1"))
	End If
End Sub

Sub buffKvsSetup
	If buffKvs.ContainsKey("1") = False Or buffKvs.ContainsKey("2") = False Or buffKvs.ContainsKey("3") = False Or buffKvs.ContainsKey("4") = False Or buffKvs.ContainsKey("5") = False Then
		buffKvs.Put("1", 0)
		buffKvs.Put("2", 0)
		buffKvs.Put("3", 1)
		buffKvs.Put("4", 1)
		buffKvs.Put("5", 1)
		buffKvs.Put("6", 0)
		Log("BUFFKVS: " & buffKvs.Get("1"))
	End If
End Sub

Sub pickStoreItems
	pickColor(settingsKvs.Get("6"))
	'Log("pick color: " & settingsKvs.Get("6"))
	pickAvatar(settingsKvs.Get("7"))
'	Log("pick avatar: " & settingsKvs.Get("7"))
End Sub

Private Sub CheckIdfa
	TimerIdfa.Enabled = False
	Dim no As NativeObject = Me
	no.RunMethod("requestIDFA", Null)
	Wait For GAD_TrackingAuthorization (Status As Int)
	Log("IDFA Status: " & Status)
	If Status = 0 Then
		TimerIdfa.Enabled = True
		Return
	End If
	Log("Finish IDFA")
	'From this line you can continue ADs loading
End Sub

Sub StartTimer (seconds As Int)
	targetTime = DateTime.Now + seconds * DateTime.TicksPerSecond
	AnimatedCounter1.Text = 15
	timer1.Enabled = True
End Sub

Sub StartTimer2 (seconds As Int)
	targetTime = DateTime.Now + seconds * DateTime.TicksPerSecond
	timer2.Enabled = True
End Sub

Sub Timer2_Tick
	Dim t As Long = Max(0, targetTime - DateTime.Now)
	Dim seconds As Int
	seconds = (t Mod DateTime.TicksPerMinute) / DateTime.TicksPerSecond
	If seconds = 0 Then
		getTitleImage
		'seconds = 15
		StartTimer2(10)
	End If
End Sub


Sub Timer1_Tick
	Dim t As Long = Max(0, targetTime - DateTime.Now)
	Dim seconds As Int
	seconds = (t Mod DateTime.TicksPerMinute) / DateTime.TicksPerSecond
	If seconds >= 0 Then
		AnimatedCounter1.text = seconds
		Log(seconds)
		Dim e As Float = seconds/15
		Log(e)
		CircularProgress1.SetProgress(e, 0)
		If seconds = 0 Then
			DisplayWrong
			answerButtonsUserEnabled(False)
			correctInGame = correctInGame - (5 * buffKvs.Get("3"))
			coinAddLabel.Text = (-5 * buffKvs.Get("3"))
			coinAddLabel.textcolor = Colors.Black
			coinAnimation
			nextQuestionButtonUserEnabled(True)
			timer1.Enabled = False
			livesKVS.Put("1", livesKVS.Get("1") - 1)
		End If
	End If
	Log("seconds " & seconds)
	If t = 0 Then
		timer1.Enabled = False
	End If
	
End Sub

Sub ShakeView (View As ImageView, Duration As Int)
	If debugFlag = False Then
		Dim Left As Int = View.Left
		Dim Delta As Int = 4dip
		For i = 1 To 6
			View.SetLayoutAnimated(Duration / 5, .1, View.Left + Delta, View.Top, View.Width, View.Height)
			Delta = -Delta
			Sleep(Duration / 5)
		Next
		View.SetLayoutAnimated(Duration/5, .1, View.Left,View.Top, View.Width, View.Height)
	End If
End Sub

Sub finishCountAnimation
	For i = 0 To correctInGame
		coinsGainedLabel.Text = i
		Sleep(10)
	Next
End Sub

Sub nextQuestionAnimation
	Dim a,b,c,d As Boolean = False
	Do Until a And b And c And d
		Dim i As Int = Rnd(1,5)
		Select i
			Case 1
				aLabel.mbase.SetLayoutAnimated(300, aLabel.mbase.left + 500, aLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
				a = True
				Log("A")
			Case 2
				bLabel.mbase.SetLayoutAnimated(300, bLabel.mbase.left + 500, bLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
				b = True
				Log("B")
			Case 3
				cLabel.mbase.SetLayoutAnimated(300, cLabel.mbase.left + 500, cLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
				c = True
				Log("C")
			Case 4
				dLabel.mbase.SetLayoutAnimated(300, dLabel.mbase.left + 500, dLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
				questionIdol.SetLayoutAnimated(300, 1, aLabel.mbase.left + 500, questionIdol.Top, questionIdol.Width, questionIdol.Height)
				d = True
				Log("D")
		End Select
	Loop
	Sleep(50)
	aLabel.mbase.SetLayoutAnimated(0, aPanel.left -1000, aLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
	bLabel.mbase.SetLayoutAnimated(0, aPanel.left -1000, bLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
	cLabel.mbase.SetLayoutAnimated(0, aPanel.left -1000, cLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
	dLabel.mbase.SetLayoutAnimated(0, aPanel.left -1000, dLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
	questionIdol.SetLayoutAnimated(0, 1, aPanel.left -1000, aLabel.mBase.Top, questionIdol.Width, questionIdol.Height)
	Dim a, b, c, d As Boolean = False
	Do Until a And b And c And d
		Dim i As Int = Rnd(1,5)
		Select i
			Case 1
				aLabel.mbase.SetLayoutAnimated(300, aPanel.left, aLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
				a = True
			Case 2
				bLabel.mbase.SetLayoutAnimated(300, aPanel.left, bLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
				b = True
			Case 3
				cLabel.mbase.SetLayoutAnimated(300, aPanel.left, cLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
				c = True
			Case 4
				dLabel.mbase.SetLayoutAnimated(300, aPanel.left, dLabel.mBase.Top, aLabel.mBase.Width, aLabel.mBase.Height)
				questionIdol.SetLayoutAnimated(300, 1, aPanel.left, aLabel.mBase.Top+10, questionIdol.Width, questionIdol.Height)
				d = True
		End Select
	Loop
End Sub

Sub finishTotalCoinsAnimation
	totalledUpCoinsLabel.Text = coinKvs.Get("1")
	For i = 0 To correctInGame - coinKvs.Get("3")
		totalledUpCoinsLabel.Text = coinKvs.Get("1") + i
		Sleep(10)
	Next
End Sub

Sub wrongProgressAnimation
	ShakeView(incorrectIcon, 100)
	liveSubtAnimation
End Sub

Sub correctProgressAnimation
	ShakeView(correctIcon, 100)
End Sub

Sub liveSubtAnimation()
	'If debugFlag = False Then
	liveSubtLabel.SetAlphaAnimated(1000,1)
	liveSubtLabel.SetAlphaAnimated(1000,0)
	liveSubtLabel.SetLayoutAnimated(1000,1, progressPanel.left + livesLabel.Left+5, progressPanel.top + livesLabel.Top + 30, liveSubtLabel.Width, liveSubtLabel.Height)
	Sleep(1000)
	liveSubtLabel.SetLayoutAnimated(0,1, progressPanel.left + livesLabel.Left+3, progressPanel.top + livesLabel.Top+1, liveSubtLabel.Width, liveSubtLabel.Height)
	'End If
End Sub

Sub coinAnimation()
	If 0 == settingsKvs.Get("10") And debugFlag = False Then
		coinCountLabel.Text = coinKvs.Get("1")
		coinAddLabel.SetAlphaAnimated(1000,1)
		coinAddLabel.SetAlphaAnimated(1000,0)
	End If
End Sub

Sub coinAnimation2
	If 0 == settingsKvs.Get("10") And debugFlag = False Then
		coinAddLabel.SetLayoutAnimated(1000,1, topBarPanel.left + coinCountLabel.Left, topBarPanel.top + coinCountLabel.Top, coinAddLabel.Width, coinAddLabel.Height)
		Sleep(1000)
		coinAddLabel.Visible = False
		coinAddLabel.SetLayoutAnimated(0,1, topBarPanel.left + coinCountLabel.Left, coinCountLabel.Top+50, coinAddLabel.Width, coinAddLabel.Height)
		coinAddLabel.Visible = True
	End If
End Sub

Sub scorePageAnimation
	Dim tbleft As Int = tableBackPanel.Left
	Dim tbtop As Int = tableBackPanel.Top
	Dim tbheight As Int = tableBackPanel.Height
	Dim tdwidth As Int = tableBackPanel.Width
	tableBackPanel.SetLayoutAnimated(0, 1, -200, -200, 0, 0)
	tableBackPanel.SetLayoutAnimated(1000,1,tbleft,tbtop,tdwidth,tbheight)
End Sub

Sub correctAnimation
	If 0 == settingsKvs.Get("10") And debugFlag = False Then
		correctAddLabel.SetAlphaAnimated(1000,1)
		correctAddLabel.SetAlphaAnimated(1000,0)
		titleTotalCorrectLabel.text = Round(kvscache.get("1"))
		correctAddLabel.Text = "+" & NumberFormat(1 * buffKvs.Get("4"),1,1)
		correctAddLabel.SetLayoutAnimated(1000,1, topBarPanel.left + titleTotalCorrectLabel.Left+15, topBarPanel.top + titleTotalCorrectLabel.Top, correctAddLabel.Width, correctAddLabel.Height)
		Sleep(1000)
		correctAddLabel.Visible = False
		correctAddLabel.SetLayoutAnimated(0,1, topBarPanel.left + titleTotalCorrectLabel.Left, titleTotalCorrectLabel.Top+50, correctAddLabel.Width, correctAddLabel.Height)
		correctAddLabel.Visible = True
	End If
End Sub

Sub storeCoinAnimation
	If debugFlag = False Then
		coinAddLabel.textcolor = Colors.Black
		coinAddLabel.Visible = True
		coinAddLabel.SetLayoutAnimated(2000,1, userPanel.left + storeCoinLabel.left, userPanel.Top + storeCoinLabel.Top + 50, coinAddLabel.Width, coinAddLabel.Height)
		Sleep(2050)
		coinAddLabel.Visible = False
		coinAddLabel.SetLayoutAnimated(0,1,  userPanel.left + storeCoinLabel.left, userPanel.Top + storeCoinLabel.Top, coinAddLabel.Width, coinAddLabel.Height)
	End If
End Sub

Sub Capitalize(t As String) As String
	Dim s,r  As String
	s = t.SubString2(0,1)
	r = t.SubString2(1, t.Length)
	Return s.ToUpperCase & r
End Sub

Sub generateImage(subCat As String)
	Dim alphaSubCatList As List
	Dim hasCat As Boolean = False
	alphaSubCatList.Initialize
	alphaSubCatList.AddAll(subCatList)
	alphaSubCatList.Sort(True)
	subCatImageView.Visible = True
	
	For i = 0 To alphaSubCatList.Size - 1
		If alphaSubCatList.Get(i) == subCat Then
			subCatImageView.bitmap = subCatImages.get(i)
			hasCat = True
		End If
	Next
	If hasCat == False Then
		subCatImageView.Visible = False
	End If
End Sub

Sub getQuestionCat
	Dim mainCat As String = masterQuestionCatagory_Map.Get(random)
	Dim subCat As String = masterQuestionCatagory_Map.Get(random)
	Log(mainCat)
	Log(subCat)
	Try
	If Not(mainCat == "null") And Not(subCat == "null") Then
		Dim underscoreIndex As Int = mainCat.IndexOf("_")
		mainCat = mainCat.SubString2(0, underscoreIndex)
		subCat = subCat.SubString(underscoreIndex + 1)
		mainCat = Capitalize(mainCat)
		subCat = Capitalize(subCat)
		questionCatLabel.Text = mainCat
		questionSubCatLabel.Text = subCat
		Log(mainCat)
		Log(subCat)
		generateImage(subCat)
	End If
	questionCatLabel.visible = False
	questionSubCatLabel.visible = False
	Catch
		Log(LastException)
		catchToFirebase(LastException)
	End Try
End Sub

Sub Trim(trimString As String)
	trimString = trimString.Trim
	Return trimString
End Sub

Sub ButtonText()
	
	Sleep(0)
	newQ = True
	random = Rnd(2, Assets.List1.Size + Assets2.List1.Size -2)
	getQuestionCat

	
	'Try
	
	Log("Random: " & random)
	Log("LIST SIZE IN MAIN: " & (Assets.List1.Size + Assets2.List1.Size -2))
	If questionCount < Assets.List1.Size + Assets2.List1.Size Then
		' counter that points to number that points to question string
		'checkDuplicate
		If newQ Then
			questionLabel.Text = Trim(masterQuestionText_Map.Get(random))
			aLabel.xLBL.Text = Trim(mastercorrectAnswer_Map.Get(random))
			bLabel.xLBL.text = Trim(masterWrongAnswer1_Map.Get(random))
			cLabel.xLBL.text = Trim(masterWrongAnswer2_Map.Get(random))
			dLabel.xLBL.text = Trim(masterWrongAnswer3_Map.Get(random))
			questionDoneMap.Put(questionCount, Trim(masterQuestionText_Map.Get(random)))
			If Trim(masterQuestionText_Map.Get(random)) == "null" Or Trim(masterQuestionText_Map.Get(random)) == Null Then
				Log("NULL QUESTION!!!")
				questionLabel.Text = Trim(masterQuestionText_Map.Get(random))
				aLabel.xLBL.Text = Trim(mastercorrectAnswer_Map.Get(random))
				bLabel.xLBL.text = Trim(masterWrongAnswer1_Map.Get(random))
				cLabel.xLBL.text = Trim(masterWrongAnswer2_Map.Get(random))
				dLabel.xLBL.text = Trim(masterWrongAnswer3_Map.Get(random))
			End If
			Log("Starting Button Swap")
			For i = 0 To 20
				ButtonSwap
			Next
		Else
			questionLabel.Text = Trim(masterQuestionText_Map.Get(random))
			aLabel.xLBL.Text = Trim(mastercorrectAnswer_Map.Get(random))
			bLabel.xLBL.text = Trim(masterWrongAnswer1_Map.Get(random))
			cLabel.xLBL.text = Trim(masterWrongAnswer2_Map.Get(random))
			dLabel.xLBL.text = Trim(masterWrongAnswer3_Map.Get(random))
		End If
		Log("End Button Swap")
		questionCount = questionCount + 1
		kvscache.Put("7", kvscache.Get("7") + 1)
		Log("Question #:" & questionCount)
		Sleep(0)
	End If
	'Catch
	Log(LastException)
	'End Try
End Sub

Sub buttontextold
	'	Sleep(0)
'	newQ = True
'	getQuestionCat
'	'Try
'	Dim random As Int = Rnd(2, Assets.List1.Size + Assets2.List1.Size -2)
'	Log("LIST SIZE IN MAIN: " & (Assets.List1.Size + Assets2.List1.Size -2))
'	If questionCount < Assets.List1.Size + Assets2.List1.Size Then
'		' counter that points to number that points to question string
'		'checkDuplicate
'		If newQ Then
'			questionLabel.Text = Trim(masterQuestionText_Map.Get(Assets.List1.get(questionCount)))
'			aLabel.xLBL.Text = Trim(mastercorrectAnswer_Map.Get(Assets.List1.get(questionCount)))
'			bLabel.xLBL.text = Trim(masterWrongAnswer1_Map.Get(Assets.List1.get(questionCount)))
'			cLabel.xLBL.text = Trim(masterWrongAnswer2_Map.Get(Assets.List1.get(questionCount)))
'			dLabel.xLBL.text = Trim(masterWrongAnswer3_Map.Get(Assets.List1.get(questionCount)))
'			questionDoneMap.Put(questionCount, Trim(masterQuestionText_Map.Get(Assets.List1.get(questionCount))))
'			If Trim(masterQuestionText_Map.Get(Assets.List1.get(questionCount))) == "Null" Or Trim(masterQuestionText_Map.Get(Assets.List1.get(questionCount))) == Null Then
'				Log("NULL QUESTION!!!")
'				questionLabel.Text = Trim(masterQuestionText_Map.Get(Assets.List1.get(random)))
'				aLabel.xLBL.Text = Trim(mastercorrectAnswer_Map.Get(Assets.List1.get(random)))
'				bLabel.xLBL.text = Trim(masterWrongAnswer1_Map.Get(Assets.List1.get(random)))
'				cLabel.xLBL.text = Trim(masterWrongAnswer2_Map.Get(Assets.List1.get(random)))
'				dLabel.xLBL.text = Trim(masterWrongAnswer3_Map.Get(Assets.List1.get(random)))
'			End If
'			Log("Starting Button Swap")
'			For i = 0 To 20
'				ButtonSwap
'			Next
'		Else 
'			questionLabel.Text = Trim(masterQuestionText_Map.Get(Assets.List1.get(random)))
'			aLabel.xLBL.Text = Trim(mastercorrectAnswer_Map.Get(Assets.List1.get(random)))
'			bLabel.xLBL.text = Trim(masterWrongAnswer1_Map.Get(Assets.List1.get(random)))
'			cLabel.xLBL.text = Trim(masterWrongAnswer2_Map.Get(Assets.List1.get(random)))
'			dLabel.xLBL.text = Trim(masterWrongAnswer3_Map.Get(Assets.List1.get(random)))
'		End If
'		Log("End Button Swap")
'		questionCount = questionCount + 1
'		kvscache.Put("7", kvscache.Get("7") + 1)
'		Log("Question #:" & questionCount)
'		Sleep(0)
'	End If
'	'Catch
'		Log(LastException)
'	'End Try
End Sub

Sub ButtonSwap         ' that Swaps Button Locations
	Private oldbutton As Int
	Dim r As Int = Rnd(1, 6)
	If r = 1 Then '1 with 2
		oldbutton = aLabel.mBase.Top
		aLabel.mBase.Top = bLabel.mBase.Top
		bLabel.mBase.Top = oldbutton
	else if r = 2 Then '1 with 3
		oldbutton = aLabel.mBase.Top
		aLabel.mBase.Top = cLabel.mBase.Top
		cLabel.mBase.Top = oldbutton
	else if r = 3 Then '1 with 4
		oldbutton = aLabel.mBase.Top
		aLabel.mBase.Top = dLabel.mBase.Top
		dLabel.mBase.Top = oldbutton
	else if r = 4 Then '2 with 3
		oldbutton = bLabel.mBase.Top
		bLabel.mBase.Top = cLabel.mBase.Top
		cLabel.mBase.Top = oldbutton
	else if r = 5 Then '2 with 4
		oldbutton = bLabel.mBase.Top
		bLabel.mBase.Top = dLabel.mBase.Top
		dLabel.mBase.Top = oldbutton
	else if r = 6 Then '3  with 4
		oldbutton = cLabel.mBase.Top
		cLabel.mBase.Top = dLabel.mBase.Top
		dLabel.mBase.Top = oldbutton
	End If
End Sub

Sub showAd
	Log("Settingkvs " & settingsKvs.Get("5"))
	If 0 == settingsKvs.Get("5") Then
		iad.Initialize("iad", institualAdString)
		If canshownow = True Then
			iad.Show(Page1) 'show ad
			canshownow = False 'set back to false
			iad.RequestAd 'request a new one!
		Else
			Log("ad not ready to show")
			iad.RequestAd 'request again!
		End If
	End If
End Sub

Sub playButton_Click
	If panelCount > 0 Then
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("questionLayout")
	questionDoneMap.Initialize
	showPage(NavControl,Page1,3)
	analytics.SendEvent("trivia_started", Null)
	If 1 == settingsKvs.Get("10") Then
		reportQuestionButton.Visible = True
		topBarPanel.Visible = False
		livesImageView.Visible = False
		liveSubtLabel.Visible = False
		livesLabel.Visible = False
		timeModeInfoButton.Visible = False
		levelLabel.Visible = False
		questionProgressBar.Visible = False
		correctInfoButton.Visible = False
		coinsInfoButton.Visible = False
		practiceModeLabel.Visible = True
	Else
		topBarPanel.Visible = True
		livesImageView.Visible = True
		liveSubtLabel.Visible = True
		livesLabel.Visible = True
		timeModeInfoButton.Visible = True
		reportQuestionButton.Visible = True
		correctInfoButton.Visible = True
		coinsInfoButton.Visible = True
		practiceModeLabel.Visible = False
	End If
	'Sleep(0)
	getLayoutName = "questionLayout"
	timer2.Enabled = False
	getBannerAd
	Dim skipString As String = "50-50 Eliminate two wrong answers for 50 coins"
	If .5 == buffKvs.Get("5") Then
		skipString = "50-50 Eliminate two wrong answers for 25 coins"
	Else
		skipString = "50-50 Eliminate two wrong answers for 50 coins"
	End If
	playSoundWhip
	saveOldKvsSet
	Page1.RootPanel.Alpha = .9
	NavControl.NavigationBarVisible = False
	correctInGame = 0
	GetMasterList
	livesKvsSetup
	hintInfoLabel.Text = skipString
	livesLabel.text = livesKVS.Get("1")
	bLabel.mBase.Color = colorArray(1)
	cLabel.mBase.Color = colorArray(1)
	dLabel.mBase.Color = colorArray(1)
	bLabel.disabledColor = colorArray(0)
	cLabel.disabledColor = colorArray(0)
	dLabel.disabledColor = colorArray(0)
	disableQuestionMark
	setAnswerAlignment
	questionProgressBar.ValueChangePerSecond = 100
	milestoneProgressTitle(questionProgressBar)
	levelLabel.Text = "L. " & (kvscache.Get("2"))
	titleTotalCorrectLabel.text = Round(kvscache.get("1"))
	
	If 1 == devKVS.Get("1") Then
		aLabel.xLBL.SetTextAlignment("CENTER", "LEFT")
	End If
	
	If 300 == settingsKvs.get("4") Or settingsKvs.Get("3") = True Then
		settingsKvs.Put("4", Assets.List1.Size)
	End If
	If 0 == settingsKvs.Get("4") Then
		settingsKvs.Put("4", 10)
	End If
	nextQuestionButtonUserEnabled(False)
	coinCountLabel.Text = coinKvs.Get("1")
	'Switches theme for question if switch is changed
	If 1 == settingsKvs.Get("1") Then
		questionDarkTheme
	Else
		questionLightTheme
	End If
	Log(titleKvs.Get("2"))
	If titleKvs.ContainsKey("2") = False Then
		titleKvs.Put("2", 0)
	End If
	If titleKvs.Get("2")  == 0 Then
		livesTutorialDialog
	End If
		
	ButtonText
	IdolComputation(idolKvs.Get("1"))
	If idolFlag Then
		questionIdol.Visible = True
	End If
	AnotherProgressBar1.ValueChangePerSecond = 40
	AnotherProgressBar1.mBase.SetColorAndBorder(xui.Color_RGB(0, 0, 0), 2,xui.Color_RGB(0, 0, 0),4)
	questionsRemainingLabel.Text = questionCount&"/" & (settingsKvs.Get("4"))
'	If 1 == settingsKvs.Get("3") Then
'		questionsRemainingLabel.Text = questionCount & "/" & (Assets.List1.Size)
'	Else
'		If settingsKvs.Get("4") > questionAmount Then
'			questionsRemainingLabel.Text = questionCount &"/" & questionAmount
'		Else
'			questionsRemainingLabel.Text = questionCount&"/" & (settingsKvs.Get("4"))
'		End If
'	End If
	buttonFormatSetup
	If 1 == settingsKvs.Get("2") Then
		AnimatedCounter1.Visible = True
		ornament.Visible = False
		CircularProgress1.FilledColor = Colors.Blue
		CircularProgress1.UnfilledColor = Colors.Transparent
		StartTimer(16)
	Else
		AnimatedCounter1.Visible = False
		CircularProgress1.FilledColor = Colors.Transparent
		CircularProgress1.UnfilledColor = Colors.Transparent
		If 0 == settingsKvs.Get("1") Then
			ornament.Visible = True
		Else
			ornament.Visible = False
		End If
	End If
	Else
		noCatSelectedDialg
	End If ' if panel count is less than 0
End Sub

Sub GetMasterList
	Assets.createList ' Creates question list here
	Assets2.createList2 ' Creates list for second assets
	masterQuestionText_Map = Assets.map_questionText
	mastercorrectAnswer_Map = Assets.map_correctAnswer
	masterWrongAnswer1_Map = Assets.map_wrongAnswer1
	masterWrongAnswer2_Map = Assets.map_wrongAnswer2
	masterWrongAnswer3_Map = Assets.map_wrongAnswer3
	masterQuestionCatagory_Map = Assets.questionCatagory
	Log("map size before: " & masterQuestionText_Map.Size) 
	' For each new asset file, you need a loop
	For i = 1 To Assets2.map_questionText.Size-1

		masterQuestionText_Map.Put(masterQuestionText_Map.Size + 1, Assets2.map_questionText.Get(i))
		mastercorrectAnswer_Map.Put(masterQuestionText_Map.Size, Assets2.map_correctAnswer.Get(i))
		masterWrongAnswer1_Map.Put(masterQuestionText_Map.Size, Assets2.map_wrongAnswer1.Get(i))
		masterWrongAnswer2_Map.Put(masterQuestionText_Map.Size, Assets2.map_wrongAnswer2.Get(i))
		masterWrongAnswer3_Map.Put(masterQuestionText_Map.Size, Assets2.map_wrongAnswer3.Get(i))
		masterQuestionCatagory_Map.Put(masterQuestionText_Map.Size, Assets2.questionCatagory.Get(i))
	Next
End Sub

Sub buttonFormatSetup
	questionLabel.Multiline = True
End Sub


'Sub pickerInit2
'	pickerList2.Initialize
'	pickerList2.AddAll(Array As String("Regular", "Timed", "Achievement"))
'	Picker2.SetItems(0, pickerList2)
'End Sub

Sub nextQuestionButton_Click
	If 0 >= livesKVS.Get("1") Then
		Log("OUT OF LIVES")
		outofLivesDialog
		wait for outofLivesDialog
	End If
	'getBannerAd
	sendAchievements
	idolFlag = False
	questionIdol.Visible = False
	aPanel.Visible = False
	'Try
		Log("KVS: " & kvscache.Get("1"))
		If kvscache.Get("1") < milestoneArray(kvscache.Get("2")) And kvscache.Get("1") >= (milestoneArray(kvscache.Get("2")-1)) Then
			levelLabel.Text = "L. " & (kvscache.Get("2")+1)
			levelLabel.SetLayoutAnimated(500, .7, levelLabel.Left, levelLabel.top, levelLabel.Width+20,levelLabel.Height+20)
			levelLabel.SetLayoutAnimated(500, .7, levelLabel.Left, levelLabel.top, levelLabel.Width-20,levelLabel.Height-20)
		Else
			levelLabel.Text = "L. " & (kvscache.Get("2"))
		End If
		questionProgressBar.mBase.SetColorAndBorder(xui.Color_RGB(0, 0, 0), 2,xui.Color_RGB(0, 0, 0),4)
		Page1.RootPanel.Alpha = .9
		aLabel.xLBl.Left = 0
		bLabel.mBase.Color = colorArray(1)
		dLabel.mBase.Color = colorArray(1)
		cLabel.mBase.Color = colorArray(1)
		cLabel.disabledColor = colorArray(0)
		bLabel.disabledColor = colorArray(0)
		dLabel.disabledColor = colorArray(0)
		aLabel.mBase.Color = colorArray(1)
		aLabel.disabledColor = colorArray(0)
		correctImgView.Visible = False
		incorrectImgView.Visible = False
		bLabel.mBase.Visible = True
		cLabel.mBase.Visible = True
		dLabel.mBase.Visible = True
		NavControl.NavigationBarVisible = False
		skipUserEnabled(True)
		nextQuestionButtonUserEnabled(False)
		answerButtonsUserEnabled(True)
		setAnswerAlignment
		nextQuestionAnimation
		coinCountLabel.Text = coinKvs.Get("1")
		If 1 == settingsKvs.Get("2") Then
			AnimatedCounter1.Visible = True
			CircularProgress1.SetProgress(1, 300)
			ornament.Visible = False
			Sleep(0)
			StartTimer(16)
		Else
			AnimatedCounter1.Visible = False
			If settingsKvs.Get("1") == 0 Then
				ornament.Visible = True
			End If
			
		End If
		' if question amount selected by slider and if list generated is less than question amount
		If questionCount < settingsKvs.get("4") And questionCount < Assets.List1.Size + Assets2.List1.size Then
			ButtonText
			If 1 == settingsKvs.Get(3) Then
				AnotherProgressBar1.Value = (questionCount/Assets.List1.Size) * 100
				Log("progressview: " & ((questionCount/Assets.List1.Size) * 100))
			Else
				Log(questionAmount & "/" & settingsKvs.Get("4"))
				AnotherProgressBar1.Value = (questionCount/settingsKvs.get("4")) * 100
				Log("progressview: " & (((questionCount)/Assets.List1.Size) * 100))
			End If
			If 1 == settingsKvs.Get("1") Then
				questionDarkTheme
			Else
				questionLightTheme
			End If
			Log("Correct answer: " & aLabel.xLBL.Text)
			If questionCount = settingsKvs.get("4") Then
				nextQuestionImage.Bitmap = LoadBitmap(File.DirAssets, "end-trivia-button.png")
			End If
			scoreLabel.Text = correctCount
			incorrectLabel.Text = (incorrectCount)
			questionsRemainingLabel.Text = questionCount&"/" & (settingsKvs.Get("4"))
			IdolComputation(idolKvs.Get("1"))
			If idolFlag Then
				questionIdol.Visible = True
			End If
		Else
			getLayoutName = ""
			If 1 == settingsKvs.Get("10") Then
				saveOldKvsGet
			End If
			Log("Game Over")
			Page1.RootPanel.RemoveAllViews
			Page1.RootPanel.LoadLayout("scorePage")
			B4XGifView2.SetGif(File.DirAssets, "finishbutton.gif")
			playBulbyAnimation
			analytics.SendEvent("trivia_completed", Null)
			analytics.SendEvent("correct", CreateMap ("correct": correctCount))
			showPage(NavControl,Page1,3)
			Page1.RootPanel.Alpha = 1
			timer1.Enabled = False
			ingame = False
			NavControl.NavigationBarVisible = False
			'playPulseAnimation(finishButton)
			AnotherProgressBar2.mBase.SetColorAndBorder(xui.Color_RGB(0, 0, 0), 1,xui.Color_RGB(0, 0, 0),2)
			If 1 == settingsKvs.Get("1") Then
				scoreDarkTheme
			Else
				scoreLightTheme
			End If
			If correctCount > kvscache.Get("8") Then
				kvscache.Put("8", correctCount)
			End If
			playSoundFinish
			milestoneProgressTitle(AnotherProgressBar2)
			Log(AnotherProgressBar2.Value)
			Dim i As Int = settingsKvs.get("4")
			roundScoreLabel.Text = correctCount & "/" & questionCount			
			finishCircularProgress.SetProgress(correctCount/questionCount, 2000)
			finishTotalCoinsAnimation
			finishCountAnimation
			coinsSpentLabel.Text = coinKvs.Get("3")
			levelLabel.Text = "L. " & kvscache.Get("2")
			If kvscache.Get("1") < milestoneArray(kvscache.Get("2")) And kvscache.Get("1") >= (milestoneArray(kvscache.Get("2")-1)) Then
				levelLabel.Text = "L. " & (kvscache.Get("2")+1)
				levelLabel.SetLayoutAnimated(500, .7, levelLabel.Left, levelLabel.top, levelLabel.Width+20,levelLabel.Height+20)
				levelLabel.SetLayoutAnimated(500, .7, levelLabel.Left, levelLabel.top, levelLabel.Width-20,levelLabel.Height-20)
			Else
				levelLabel.Text = (kvscache.Get("2"))
			End If
			If 1 == settingsKvs.Get("10") Then
				finishButton_Click
			End If
		End If
		milestoneProgressTitle(questionProgressBar)
		aLabel.Enabled = True

	'Catch
		Log(LastException)
	'End Try
End Sub


Sub getBannerAd
	If 0 == settingsKvs.Get("5") Then
		Try
			'Wait For GAD_TrackingAuthorization (Status As Int)
			Dim no As NativeObject = Me
			no.RunMethod("requestIDFA", Null)
			Dim sizes As List = no.RunMethod("GetAdaptiveSize:", Array(Page1.RootPanel.Width))
			Dim w As Float = sizes.Get(1) 'ignore
			Dim h As Float = sizes.Get(2)
			AdView1.Initialize("Ad", bannerAdString ,Page1,AdView1.SIZE_LARGE_BANNER)
			Page1.RootPanel.AddView(AdView1, 0, Page1.RootPanel.Height-80dip, Page1.RootPanel.Width, h)
			AdView1.LoadAd
			'AdView1.SetBorder(2, Colors.Red, 1)
			Sleep(0)
		Catch
			Log(LastException)
			catchToFirebase(LastException)
		End Try
	End If
End Sub

Sub Adview1_click
	analytics.SendEvent("banner_ad_clicked", Null)
End Sub

Sub Adview1_AdScreenDismissed
	analytics.SendEvent("banner_ad_dismissed", Null)
End Sub

Sub iad_click
	analytics.SendEvent("institual_clicked", Null)
End Sub

Sub iad_AdScreenDismissed
	analytics.SendEvent("institual_ad_dismissed", Null)
End Sub

Private Sub finishButton_Click
	playSoundWhip
	Log(pickerString)
	' 100% completion achievement detection when finish button clicked
	Log("CorrectCount: " & correctCount)
	Log("Question Count: " & questionCount)
	Log("quiz cat int: " & quizCatagoryInt)
	Log("Assets List Size: " & Assets.List1.Size)
	If correctCount == questionCount And quizCatagoryInt = 2 And correctCount = Assets.List1.Size Then
		kvscache.Put("4", 1)
	Else If correctCount == Assets.List1.Size And quizCatagoryInt = 3 And correctCount = Assets.List1.Size Then
		kvscache.Put("5", 1)
	Else If correctCount == Assets.List1.Size And quizCatagoryInt = 4 And correctCount = Assets.List1.Size Then
		kvscache.Put("6", 1)
	End If
	questionCount = 0
	correctCount = 0
	incorrectCount = 0
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("titleScreenLayout2")
	showPage(NavControl,Page1,2)
	TitlePageDesignerScript
	returnToTitle
	If 1 == settingsKvs.Get("1") Then
		titleDarkTheme
	Else
		titleLightTheme
	End If
	titleButtonColor
End Sub

Sub setIncorrectImgViewPOS(label As SwiftButton)
	incorrectImgView.Top = label.mBase.Top - 10
	incorrectImgView.Left = label.mBase.Left + (label.mBase.Width - incorrectImgView.Width/2)
	incorrectImgView.Visible = True
End Sub

Sub setCorrectImgViewPOS(label As SwiftButton)
	correctImgView.Top = label.mBase.Top - 10
	correctImgView.Left = label.mBase.Left + (label.mBase.Width - incorrectImgView.Width/2)
	correctImgView.Visible = True
End Sub

Sub aLabel_Click
	XUIViewsUtils.PerformHapticFeedback(aLabel.mBase)
	Log("Value of KVS Before init: " & kvscache.Get("1"))
	If kvscache.Get("1") = Null Then
		kvscache.Put("1", correctCount * buffKvs.Get("4"))
		Log("KVS file initialized..")
	Else
		Dim milestoneCount As Float = kvscache.Get("1")
		Log("Value of KVS Milestone Count: " & kvscache.Get("1"))
		milestoneCount = milestoneCount + (1 * buffKvs.Get("4"))
		kvscache.Put("1", milestoneCount)
	End If
	DisplayCorrect
	answerButtonsUserEnabled(False)
	nextQuestionButtonUserEnabled(True)
	If settingsKvs.Get("1") = Null Then
		settingsKvs.Put("1", 0)
	Else
	End If
	Log("KVS RESPONSE: " & kvscache.Get("1"))
	aPanel.Visible = True
End Sub

Sub bLabel_Click
	setIncorrectImgViewPOS(bLabel)
	bLabel.SetColors(Colors.ARGB(255, 144, 238, 144), Colors.ARGB(255, 139,0,0))
	bLabel.disabledColor = Colors.ARGB(255,255,114,118)
	bLabel.mBase.Color = Colors.ARGB(255, 139,0,0)
	DisplayWrong
	nextQuestionButtonUserEnabled(True)
	answerButtonsUserEnabled(False)
	aPanel.Visible = True
	livesCounter
End Sub

Sub cLabel_Click
	setIncorrectImgViewPOS(cLabel)
	cLabel.SetColors(Colors.ARGB(255, 144, 238, 144), Colors.ARGB(255, 139,0,0))
	cLabel.disabledColor = Colors.ARGB(255,255,114,118)
	cLabel.mBase.Color = Colors.ARGB(255, 139,0,0)
	DisplayWrong
	nextQuestionButtonUserEnabled(True)
	answerButtonsUserEnabled(False)
	aPanel.Visible = True
	livesCounter
End Sub

Sub dLabel_Click
	setIncorrectImgViewPOS(dLabel)
	dLabel.SetColors(Colors.ARGB(255, 144, 238, 144), Colors.ARGB(255, 139,0,0))
	dLabel.disabledColor = Colors.ARGB(255,255,114,118)
	dLabel.mBase.Color = Colors.ARGB(255, 139,0,0)
	DisplayWrong
	nextQuestionButtonUserEnabled(True)
	answerButtonsUserEnabled(False)
	aPanel.Visible = True
	livesCounter
End Sub

Sub setAnswerAlignment()
	aLabel.xLBL.Width = aLabel.mBase.Width - 20
	bLabel.xLBL.Width = bLabel.mBase.Width - 20
	cLabel.xLBL.Width = cLabel.mBase.Width - 20
	dLabel.xLBL.Width = dLabel.mBase.Width - 20
	aLabel.xLBL.BringToFront
End Sub

Sub DisplayCorrect()
	setCorrectImgViewPOS(aLabel)
	inARowKvs.Put("1", inARowKvs.Get("1")+1)
	playSoundCorrect
	timer1.Enabled = False
	aLabel.SetColors(Colors.ARGB(255, 144, 238, 144), Colors.ARGB(255, 0,100,0))
	aLabel.mBase.Color = Colors.ARGB(255, 0,100,0)
	aLabel.disabledColor = Colors.ARGB(255, 144, 238, 144)
	correctProgressAnimation
	correctCount = correctCount + 1
	scoreLabel.Text = correctCount
	If 0 == settingsKvs.Get("10") Then
		If 1 == settingsKvs.Get("2") Then
			coinKvs.Put("1", coinKvs.Get("1") + (20 * buffKvs.Get("3")))
			Log("You have: " & coinKvs.Get("1"))
			coinAddLabel.Text = "+" & (20*buffKvs.Get("3"))
			correctInGame = correctInGame + (20 * buffKvs.Get("3"))
		Else
			coinKvs.Put("1", coinKvs.Get("1") + (10 * buffKvs.Get("3")))
			Log("You have: " & coinKvs.Get("1"))
			coinAddLabel.Text = "+" & (10*buffKvs.Get("3"))
			correctInGame = correctInGame + (10 * buffKvs.Get("3"))
		End If
	End If
	coinAnimation
	coinAnimation2
	correctAnimation
End Sub

Sub livesCounter
	livesKVS.Put("1", livesKVS.Get("1") - 1)
	livesLabel.text = livesKVS.Get("1")
End Sub

Sub DisplayWrong()
	bLabel.SetColors(colorArray(0), colorArray(1))
	cLabel.SetColors(colorArray(0), colorArray(1))
	dLabel.SetColors(colorArray(0), colorArray(1))
	wrongProgressAnimation
	setCorrectImgViewPOS(aLabel)
	inARowKvs.Put("1", 0)
	playSoundIncorrect
	timer1.Enabled = False
	incorrectCount = incorrectCount + 1
	incorrectLabel.Text = (incorrectCount)
	aLabel.SetColors(Colors.ARGB(255, 144, 238, 144), Colors.ARGB(255, 0,100,0))
	aLabel.mBase.Color = Colors.ARGB(255, 0,100,0)
	aLabel.disabledColor = Colors.ARGB(255, 144, 238, 144)
	If 0 == settingsKvs.Get("10") Then
		If 1 == settingsKvs.Get("2") Then
			coinKvs.Put("1", coinKvs.Get("1") - 5)
			coinAddLabel.Text = (-5 * buffKvs.Get("3"))
			coinAddLabel.textcolor = Colors.Black
			coinAnimation
			coinAnimation2
		End If
	End If
End Sub

Sub skipUserEnabled(s As Boolean) ' enables or disables usage of next button
	skipButton.UserInteractionEnabled = s
	If s Then
		skipButton.BringToFront
		skipImage.SendToBack
		hintInfoButton.BringToFront
	Else
		skipButton.SendToBack
		skipImage.BringToFront
		hintInfoButton.BringToFront
	End If
End Sub

Sub nextQuestionButtonUserEnabled(s As Boolean) ' enables or disables usage of next button
	nextQuestionButton.UserInteractionEnabled = s
	If s Then
		nextQuestionButton.BringToFront
		nextQuestionImage.SendToBack
	Else
		nextQuestionButton.SendToBack
		nextQuestionImage.BringToFront
	End If
End Sub

Sub answerButtonsUserEnabled(s As Boolean) ' enables or disables usage of next button
	aLabel.Enabled = s
	bLabel.Enabled = s
	cLabel.Enabled = s
	dLabel.Enabled = s
End Sub

' THEMES
'Initial Switch to Dark/Light Theme
Sub setSettingsUI(Value As Boolean)
	Page1.Title = "Settings"
	If 1 == settingsKvs.Get("1") Then
		settingsDarkTheme
	Else
		settingsLightTheme
	End If
End Sub

Sub achievementDarkTheme
	Page1.RootPanel.Color = Colors.DarkGray
	milestoneLabel.TextColor = Colors.White
	levelLabel.TextColor = Colors.White
	milestoneProgressLabel.TextColor = Colors.White
	miledesc.TextColor = Colors.White
	achTitleLabel.TextColor = Colors.White
End Sub

Sub achievementLightTheme
	Page1.RootPanel.Color = Colors.ARGB(255, 252,251,244)
	milestoneLabel.TextColor = Colors.Black
	levelLabel.TextColor = Colors.Black
	milestoneProgressLabel.TextColor = Colors.Black
	achTitleLabel.TextColor = Colors.Black
End Sub

Sub storeLightTheme
	Page1.RootPanel.Color = Colors.ARGB(255, 252,251,244)
	buySchemeLabel.TextColor = Colors.Black
	buyAvatarLabel.TextColor = Colors.Black
	storeTitleLabel.TextColor = Colors.Black
	buyBuffLabel.TextColor = Colors.Black
	lblUser.TextColor = Colors.Black
	buyIdolLabel.TextColor = Colors.Black
End Sub

Sub storeDarkTheme
	Page1.RootPanel.Color = Colors.DarkGray
	buySchemeLabel.TextColor = Colors.White
	buyAvatarLabel.TextColor = Colors.White
	storeTitleLabel.TextColor = Colors.White
	buyBuffLabel.TextColor = Colors.White
	lblUser.TextColor = Colors.white
	buyIdolLabel.TextColor = Colors.white
End Sub

Sub storeButtonColor
	buySchemeButton.SetColors(colorArray(0), colorArray(1))
	butAvatarButton.SetColors(colorArray(0), colorArray(1))
	buyBuffButton.SetColors(colorArray(0), colorArray(1))
End Sub

Sub questionDarkTheme	' Set Question Page Theme
	Page1.RootPanel.Color = Colors.DarkGray
	aLabel.SetColors(colorArray(0), colorArray(1))
	bLabel.SetColors(colorArray(0), colorArray(1))
	cLabel.SetColors(colorArray(0), colorArray(1))
	dLabel.SetColors(colorArray(0), colorArray(1))
	questionLabel.TextColor = Colors.White
	scoreLabel.TextColor = Colors.White
	questionsRemainingLabel.TextColor = Colors.White
	questionBackgroundPanel.Color = Colors.Transparent
	incorrectLabel.TextColor = Colors.White
	scoreLabel.SetBorder(1, Colors.White, 3)
	incorrectLabel.SetBorder(1, Colors.White, 3)
	livesLabel.TextColor = Colors.White
	livesLabel.SetBorder(1, Colors.White, 3)
	practiceModeLabel.TextColor = Colors.White
	nextQuestionButton.Color = Colors.Transparent
	titleTotalCorrectLabel.Color = Colors.Transparent
	titleTotalCorrectLabel.SetBorder(1, Colors.White, 4)
	coinCountLabel.Color = Colors.Transparent
	coinCountLabel.SetBorder(1, Colors.White, 4)
	liveSubtLabel.TextColor = Colors.White
	titleTotalCorrectLabel.TextColor = Colors.White
	coinCountLabel.TextColor = Colors.White
	levelLabel.TextColor = Colors.White
	AnimatedCounter1.TextColor = Colors.White
	questionCatLabel.TextColor = Colors.White
	questionSubCatLabel.TextColor = Colors.White
End Sub

Sub questionLightTheme
	Page1.RootPanel.Color = Colors.ARGB(255, 252,251,244)
	aLabel.SetColors(colorArray(0), colorArray(1))
	bLabel.SetColors(colorArray(0), colorArray(1))
	cLabel.SetColors(colorArray(0), colorArray(1))
	dLabel.SetColors(colorArray(0), colorArray(1))
	'nextQuestionLabel.TextColor = Colors.Black
	questionsRemainingLabel.TextColor = Colors.Black
	questionLabel.TextColor = Colors.Black
	scoreLabel.TextColor = Colors.Black
	incorrectLabel.TextColor = Colors.Black
	scoreLabel.SetBorder(1, Colors.Black, 3)
	incorrectLabel.SetBorder(1, Colors.Black, 3)
	livesLabel.TextColor = Colors.Black
	practiceModeLabel.TextColor = Colors.Black
	livesLabel.SetBorder(1, Colors.Black, 3)
	titleTotalCorrectLabel.Color = Colors.White
	titleTotalCorrectLabel.SetBorder(1, Colors.Black, 4)
	coinCountLabel.Color = Colors.white
	coinCountLabel.SetBorder(1, Colors.Black, 4)
	liveSubtLabel.TextColor = Colors.Black
	titleTotalCorrectLabel.TextColor = Colors.Black
	coinCountLabel.TextColor = Colors.Black
	levelLabel.TextColor = Colors.black
	AnimatedCounter1.TextColor = Colors.Black
	questionCatLabel.TextColor = Colors.Black
	questionSubCatLabel.TextColor = Colors.Black
End Sub

Sub titleDarkTheme
	Page1.RootPanel.Color = Colors.DarkGray
	titleLabel.TextColor = Colors.White
	titleUsername.TextColor = Colors.White
	myNameLabel.TextColor = Colors.White
	levelLabel.TextColor = Colors.White
	milestoneProgressLabel.textcolor = Colors.White
	ImageView1.SetBorder(1, Colors.White, 4)
	catTitleLabel.TextColor = Colors.White
End Sub

Sub titleLightTheme
	Page1.RootPanel.Color = Colors.ARGB(255, 252,251,244)
	titleLabel.TextColor = Colors.Black
	titleUsername.TextColor = Colors.Black
	myNameLabel.TextColor = Colors.Black
	levelLabel.TextColor = Colors.Black
	milestoneProgressLabel.textcolor = Colors.Black
	catTitleLabel.TextColor = Colors.Black
	ImageView1.SetBorder(1, Colors.Black, 4)
End Sub

Sub titleButtonColor
End Sub

Sub settingsDarkTheme
	Page1.RootPanel.Color = Colors.DarkGray
	darkThemeLabel.TextColor = Colors.White
	quizLengthLabel.TextColor = Colors.White
	questionMarkLabel.TextColor = Colors.White
	versionNumber.TextColor = Colors.White
	removeAdsLoading.mBase.TextColor= Colors.White
	removeAdsLabel.TextColor = Colors.White
	settingsTitleLabel.TextColor = Colors.White
	muteLabel.TextColor = Colors.White
	sliderLabel.TextColor = Colors.white
End Sub

Sub settingsLightTheme
	Page1.RootPanel.Color = Colors.ARGB(255, 252,251,244)
	darkThemeLabel.TextColor = Colors.Black
	quizLengthLabel.TextColor = Colors.Black
	timerdescLabel.TextColor = Colors.Black
	questionMarkLabel.TextColor = Colors.Black
	versionNumber.TextColor = Colors.Black
	removeAdsLoading.mBase.TextColor= Colors.Black
	removeAdsLabel.TextColor = Colors.Black
	settingsTitleLabel.TextColor = Colors.Black
	muteLabel.TextColor = Colors.Black
	sliderLabel.TextColor = Colors.Black
End Sub

Sub settingsButtonSetup
	sendEmailPanel.Color = colorArray(0)
	devSitePanel.Color = colorArray(0)
	resetScorePanel.Color = colorArray(0)
	leaveReviewPanel.Color = colorArray(0)
	shareAppPanel.Color = colorArray(0)
	restorePurchPanel.Color = colorArray(0)
End Sub

Sub scoreDarkTheme	
	Dim whiteslash As Bitmap
	whiteslash.Initialize(File.DirAssets, "slash.png")
	Page1.RootPanel.Color = Colors.DarkGray
	finalScoreLabel.TextColor = Colors.white
	yourScoreIs.TextColor = Colors.White
	coinsSpent.TextColor = Colors.White
	yourTotalIs.TextColor = Colors.White
	coinsGainedLabel.TextColor = Colors.White
	coinsSpentLabel.TextColor = Colors.White
	totalledUpCoinsLabel.TextColor = Colors.White
	milestoneProgressLabel.TextColor = Colors.White
	levelLabel.TextColor = Colors.White
	roundScoreLabel.TextColor = Colors.White
End Sub

Sub scoreLightTheme
	Dim blackslash As Bitmap
	blackslash.Initialize(File.DirAssets, "divide-mathematical-sign.png")
	Page1.RootPanel.Color = Colors.ARGB(255, 252,251,244)
	finalScoreLabel.TextColor = Colors.Black
	totalledUpCoinsLabel.TextColor = Colors.Black
	yourScoreIs.TextColor = Colors.Black
	yourTotalIs.TextColor = Colors.Black
	coinsGainedLabel.TextColor = Colors.Black
	totalledUpCoinsLabel.TextColor = Colors.Black
	milestoneProgressLabel.TextColor = Colors.Black
	levelLabel.TextColor = Colors.Black
	coinsSpentLabel.TextColor = Colors.Black
	roundScoreLabel.TextColor = Colors.Black
	'slashImageView.Bitmap = blackslash
End Sub

Sub emailDarktheme
	Page1.RootPanel.Color = Colors.DarkGray
	emailTitleLabel.TextColor = Colors.White
	subjectLabel.TextColor = Colors.White
	bodyLabel.TextColor = Colors.White
	emailLabel.TextColor = Colors.White
End Sub

Sub emailLightTheme
	Page1.RootPanel.Color = Colors.ARGB(255, 252,251,244)
	emailTitleLabel.TextColor = Colors.Black
	subjectLabel.TextColor = Colors.Black
	bodyLabel.TextColor = Colors.Black
	emailLabel.TextColor = Colors.Black
End Sub

Sub emailButtonColor
	emailButton.SetColors(colorArray(0), colorArray(1))
End Sub


Sub Switch1_ValueChanged (Value As Boolean)
	setSettingsUI(Value)
	Log("Switch Value: " & Switch1.Value)
	If Switch1.Value = False Then
		settingsKvs.Put("1", 0)
		settingsLightTheme
	Else
		settingsKvs.Put("1", 1)
		settingsDarkTheme
	End If
	
End Sub

Sub Slider1_ValueChanged (Value As Float)
	If(Value >= 300) Then
		sliderNumber.Text = "Max"
		Value = 300
	End If
	Dim i As Int = Value
	If(i Mod 10 == 0) Then
	Else
		Value = Value/10
		Log("value: " & Value)
		i = Value
		Ceil(i)
		Value = i * 10
	End If
	Slider1.Value = Value
	sliderNumber.Text = Round(Value)
	settingsKvs.Put("4", Round(Value))
	sliderLabel.Text = Round(Value)
End Sub

Sub settingsDesignerScript
	Dim MiddleofPanel As Float = masterPanelSettings.Width/2
	Dim ButtonSpacing As Float = (masterPanelSettings.Width - (leaveReviewPanel.Width + shareAppPanel.Width))/3
	Dim AdjustUp As Float= leaveReviewPanel.Height/2
	Dim MiddleofButtonPanel As Float= (leaveReviewPanel.Width/2) - (leaveReviewButton.Width/2)
	Dim Spacing As Int = masterPanelSettings.Width - (leaveReviewPanel.Width + shareAppPanel.Width)
	Spacing = Spacing/3
	leaveReviewPanel.left =  DipToCurrent(Spacing)
	sendEmailPanel.Left =  DipToCurrent(Spacing)
	resetScorePanel.Left = DipToCurrent(Spacing)
	shareAppPanel.Left = leaveReviewPanel.Left + leaveReviewPanel.width + DipToCurrent(Spacing)
	devSitePanel.Left = leaveReviewPanel.Left + leaveReviewPanel.width + DipToCurrent(Spacing)
	restorePurchPanel.Left = leaveReviewPanel.Left + leaveReviewPanel.width + DipToCurrent(Spacing)
	
	leaveReviewPanel.Top = sliderLabel.Top + sliderLabel.Height + ButtonSpacing + AdjustUp/2
	shareAppPanel.Top = sliderLabel.Top + sliderLabel.Height + ButtonSpacing + AdjustUp/2
	sendEmailPanel.Top = leaveReviewPanel.top + leaveReviewPanel.Height + ButtonSpacing + AdjustUp
	devSitePanel.Top = ButtonSpacing + leaveReviewPanel.top + leaveReviewPanel.Height + AdjustUp
	resetScorePanel.Top = ButtonSpacing + sendEmailPanel.top + sendEmailPanel.Height + AdjustUp
	restorePurchPanel.Top = ButtonSpacing + sendEmailPanel.top + sendEmailPanel.Height + AdjustUp
	
	resetScoreInfoButton.Top = resetScorePanel.Top - (resetScoreInfoButton.Height/2)
	restorePurchInfoButton.Top = restorePurchPanel.Top - (restorePurchInfoButton.Height/2)
	resetScoreInfoButton.Left = resetScorePanel.Left + resetScorePanel.Width - (resetScoreInfoButton.Width/2)
	restorePurchInfoButton.Left = restorePurchPanel.Left + restorePurchPanel.Width - (restorePurchInfoButton.Width/2)
	versionNumber.Top = restorePurchPanel.Top + restorePurchPanel.Height + Spacing - (versionNumber.Height/3)
	
	muteSwitch.Left = masterPanelSettings.Width - (Spacing + muteSwitch.Width)
	Switch1.Left = masterPanelSettings.Width - (Spacing + Switch1.Width)
	removeAdsSwitch.Left = masterPanelSettings.Width - (Spacing + removeAdsSwitch.Width)
	questionMarkSwitch.Left = masterPanelSettings.Width - (Spacing + muteSwitch.Width)
	
	leaveReviewButton.Left = leaveReviewPanel.Left + MiddleofButtonPanel
	shareButton.Left = shareAppPanel.Left +  MiddleofButtonPanel
	sendEmailButton.Left = sendEmailPanel.Left + MiddleofButtonPanel
	developerSiteButton.Left = devSitePanel.Left + MiddleofButtonPanel
	resetScoreButton.Left = resetScorePanel.Left + MiddleofButtonPanel
	restorePurchasesButton.Left = restorePurchPanel.Left + MiddleofButtonPanel

	leaveReviewButton.Top = leaveReviewPanel.Top - AdjustUp - 10dip
	shareButton.Top = shareAppPanel.Top - AdjustUp - 10dip
	sendEmailButton.Top = sendEmailPanel.Top - AdjustUp -5dip
	developerSiteButton.Top = devSitePanel.Top  - AdjustUp - 10dip
	resetScoreButton.Top = resetScorePanel.Top  - AdjustUp - 10dip
	restorePurchasesButton.Top = restorePurchPanel.Top - AdjustUp - 10dip
End Sub

Sub settingsButton_Click
	playSoundClick
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("settingsPage")
	analytics.SendEvent("settings_page_opened", Null)
	settingsDesignerScript
	settingsButtonSetup
	showPage(NavControl,Page1,3)
	versionNumber.Text = ("v. " & AppVersion)
	Switch1.Value = settingsKvs.Get("1")
	Slider1.Value = settingsKvs.Get("4")
	questionMarkSwitch.Value = settingsKvs.Get("9")
	sliderNumber.text = settingsKvs.Get("4")
	sliderLabel.Text = settingsKvs.Get("4")
	disableQuestionMark
	If settingsKvs.Get("5") Then
		
	End If
	If 0==kvscache.Get("1") Then
		muteSwitch.Value = False
	Else
		muteSwitch.Value = True
		muteSwitch.Value = settingsKvs.Get("8")
	End If
	
	If 1 == settingsKvs.Get("5") Then
		removeAdsButtonDisabled
		bannerAdString = ""
		institualAdString = ""
		removeAdsSwitch.Value = True
		removeAdsLoading.mBase.Visible = False
	End If
	If 1 == settingsKvs.Get("1") Then
		settingsDarkTheme
	Else
		settingsLightTheme
	End If
	setSettingsUI(isDark)
	getBannerAd
End Sub

Sub returnToTitle
	'picker2Select
	Page1.RootPanel.Alpha = 1
	coinKvs.put("3", 0) ' reset coins spent
	getLayoutName = ""
	ingame = True
	If 1 == settingsKvs.Get("1") Then
		titleDarkTheme
	Else
		titleLightTheme
	End If
	titleButtonColor
	getBannerAd
	loadToggleButtons
	coinLabel.Text = coinKvs.Get("1")
	disableQuestionMark
	B4XGifView1.SetGif(File.DirAssets, "startButton4.gif")
	gameViewButton.Visible = True
	titleAvatarView.Bitmap= LoadBitmap(File.DirAssets, viewName)
	titleTotalCorrectLabel.text = Round(kvscache.get("1"))
	titleUsername.Text = Game.LocalPlayer.DisplayName
	avatarTitlePanel.Color = colorArray(0)
	Log(pickerString)
	milestoneProgressTitle(milestoneProgressView)
	buffIconTitle
	idolIconTitle
	StartTimer2(10)
	getTitleCatCLVItems
	If 100 == kvscache.Get("1")  Then
		If App.OSVersion > 10.3 Then
			Dim no As NativeObject
			no.Initialize("SKStoreReviewController").RunMethod("requestReview", Null)
		End If
	End If
	Dim k As Int = Rnd(1,13)
	If k == 11 Then
		Log("INTERSTITUAL AD")
		showAd
	End If
End Sub



Private Sub backButtonQuiz_Click
	playSoundClick
	Dim p As Panel
	p.Initialize("")
	p.SetLayoutAnimated(0, 1, 0, 0, Page1.RootPanel.Width - 50dip, 150dip)
	p.LoadLayout("areyousureDialog")
	Dim TimedDialog As CustomLayoutDialog
	TimedDialog.Initialize(p)
	TimedDialog.Style = TimedDialog.STYLE_INFO
	Dim sf As Object = TimedDialog.ShowAsync("", "Yes", "No", "", False)
	Dim i As Float = saveOldKvs.Get("1") - kvscache.Get("1")
	Dim q As Float = saveOldKvs.Get("2") - coinKvs.Get("1")
	titleTotalCorrectLabel.Text = Round(i)
	coinCountLabel.Text = Round(q)
	Dim disable() As Boolean = Array As Boolean(False)
	Wait For (sf) Dialog_Result (Result As Int)
	disable(0) = True 'disable the AutoClose timer
	timer1.Enabled = False
	If Result = TimedDialog.RESULT_POSITIVE Then
		saveOldKvsGet
		Page1.RootPanel.RemoveAllViews
		Page1.RootPanel.LoadLayout("titleScreenLayout2")
		showPage(NavControl,Page1,2)
		TitlePageDesignerScript
		returnToTitle
		questionCount = 0
		correctCount = 0
		incorrectCount = 0
		subtCorrectAnimation(i)
		subtCoinsAnimation(q)
	End If
	
End Sub

Sub subtCorrectAnimation(i As Float)
	If Not(i == 0) Then
		Sleep(300)
		titleTotalCorrectLabel.text = Round(kvscache.Get("1") + -(i))
		correctSubtLabel.text = Round(i)
		Sleep(300)
		correctSubtLabel.Visible = True
		correctSubtLabel.SetLayoutAnimated(1000,1, centerPanel.Left + statsPanel.left + titleTotalCorrectLabel.left, centerPanel.Top + statsPanel.Top + titleTotalCorrectLabel.Top + 30, correctSubtLabel.Width, correctSubtLabel.Height)
		titleTotalCorrectLabel.Text = kvscache.Get("1")
		Sleep(1050)
		correctSubtLabel.Visible = False
		correctSubtLabel.SetLayoutAnimated(0,1,  centerPanel.Left + statsPanel.left + titleTotalCorrectLabel.left, centerPanel.Top + statsPanel.Top + titleTotalCorrectLabel.Top, correctSubtLabel.Width, correctSubtLabel.Height)
	End If
End Sub

Sub subtCoinsAnimation(q As Float)
	If Not(q == 0) Then
		Sleep(300)
		coinLabel.text = Round(kvscache.Get("1") + -(q))
		coinSubtLabel.text = Round(q)
		Sleep(300)
		coinSubtLabel.Visible = True
		coinSubtLabel.SetLayoutAnimated(1000,1, centerPanel.Left + coinsPanel.left + coinLabel.left, centerPanel.Top + coinsPanel.Top + coinLabel.Top + 30, coinSubtLabel.Width, coinSubtLabel.Height)
		coinLabel.Text = coinKvs.Get("1")
		Sleep(1050)
		coinSubtLabel.Visible = False
		coinSubtLabel.SetLayoutAnimated(0,1,  centerPanel.Left + coinsPanel.left + coinLabel.left, centerPanel.Top + coinsPanel.Top + coinLabel.Top, coinSubtLabel.Width, coinSubtLabel.Height)
	End If
End Sub

Private Sub livesTutorialDialog
	Dim p As Panel
	p.Initialize("")
	Sleep(0)
	
	p.SetLayoutAnimated(0, 1, 0, 0, Page1.RootPanel.Width - 40dip, 190dip)
	p.LoadLayout("DialogLivesTutorial")
	liveTutorialImagePanel.Visible = True
	bulbyTextImageView.Visible = True
	bulbyintrolabel.Visible = True
	bulbyintrolabel.SetAlphaAnimated(0, 0)
	areyousureLabel.Text = "Lives are consumed when you answer a question incorrectly. You can see your lives down below indicated by a heart icon."
	bulbyintrolabel.Text = "Have Fun!"
	Sleep(0)
	bulbyintrolabel.SetAlphaAnimated(2000, 1)
	playPulseAnimation(heartViewTutorial)
	Dim TimedDialog As CustomLayoutDialog
	TimedDialog.Initialize(p)
	TimedDialog.Style = TimedDialog.STYLE_CUSTOM
	TimedDialog.CustomIcon = LoadBitmap(File.DirAssets, "lightbuilb-face.png")
	Dim sf As Object = TimedDialog.ShowAsync("", "OK", "", "", False)
	Dim disable() As Boolean = Array As Boolean(False)
	Wait For (sf) Dialog_Result (Result As Int)
	disable(0) = True 'disable the AutoClose timer
	If Result = TimedDialog.RESULT_POSITIVE Then
		titleKvs.Put("2", 1)
		Log(titleKvs.Get("1"))
		p.Visible = False
	End If
End Sub

Private Sub noCatSelectedDialg
	Dim p As Panel
	p.Initialize("")
	Sleep(0)
	p.SetLayoutAnimated(0, 1, 0, 0, Page1.RootPanel.Width - 40dip, 190dip)
	p.LoadLayout("DialogLivesTutorial")
	bulbyintrolabel.SetAlphaAnimated(0, 0)
	liveTutorialImagePanel.Visible = False
	bulbyTextImageView.Visible = False
	bulbyintrolabel.Visible = False
	Sleep(0)
	bulbyintrolabel.SetAlphaAnimated(2000, 1)
	areyousureLabel.Text = "You must select at least one subcategory of Trivia."
	playPulseAnimation(heartViewTutorial)
	Dim TimedDialog As CustomLayoutDialog
	TimedDialog.Initialize(p)
	TimedDialog.Style = TimedDialog.STYLE_CUSTOM
	TimedDialog.CustomIcon = LoadBitmap(File.DirAssets, "lightbuilb-face.png")
	Dim sf As Object = TimedDialog.ShowAsync("", "OK", "", "", False)
	Dim disable() As Boolean = Array As Boolean(False)
	Wait For (sf) Dialog_Result (Result As Int)
	disable(0) = True 'disable the AutoClose timer
	If Result = TimedDialog.RESULT_POSITIVE Then
		titleKvs.Put("2", 1)
		Log(titleKvs.Get("1"))
		p.Visible = False
	End If
End Sub

Sub clicktutorial
	Sleep(3000)
	clickGifView.SetGif(File.DirAssets, "click2.gif")
	clickTutorialMasterPanel.Visible = True
	clickGifView.mBase.Visible = True
	clickTutorialPanel.Visible = True
	
End Sub

Private Sub qmarkTutorialDialog
	Sleep(1000)
	Dim p As Panel
	p.Initialize("")
	p.SetLayoutAnimated(0, 1, 0, 0, Page1.RootPanel.Width - 40dip, 190dip)
	Sleep(0)
	p.LoadLayout("qmarktutorialview")	
	Sleep(0)
	Dim TimedDialog As CustomLayoutDialog
	TimedDialog.Initialize(p)
	TimedDialog.Style = TimedDialog.STYLE_CUSTOM
	TimedDialog.CustomIcon = LoadBitmap(File.DirAssets, "lightbuilb-face.png")
	bulbyintrolabel.SetAlphaAnimated(2000, 1)
	Sleep(0)
	Dim sf As Object = TimedDialog.ShowAsync("", "OK", "", "", False)
	Dim disable() As Boolean = Array As Boolean(False)
	Wait For (sf) Dialog_Result (Result As Int)
	disable(0) = True 'disable the AutoClose timer
	Sleep(0)
	qmarkViewTutorial.Left = Page1.RootPanel.Width/2
	If Result = TimedDialog.RESULT_POSITIVE Then
		p.Visible = False
		titleKvs.Put("1", 1)
	End If
End Sub

Private Sub outofLivesDialog
	Dim p As Panel
	p.Initialize("")
	p.SetLayoutAnimated(0, 1, 0, 0, Page1.RootPanel.Width - 50dip, 150dip)
	p.LoadLayout("outoflivesLayout")
	Dim TimedDialog As CustomLayoutDialog
	TimedDialog.Initialize(p)
	TimedDialog.Style = TimedDialog.STYLE_INFO
	Dim sf As Object = TimedDialog.ShowAsync("", "OK", "", "", False)
	playSoundLives
	Dim i As Float = saveOldKvs.Get("1") - kvscache.Get("1")
	Dim q As Float = saveOldKvs.Get("2") - coinKvs.Get("1")
	titleTotalCorrectLabel.Text = Round(i)
	coinCountLabel.Text = Round(q)
	saveOldKvsGet
	Dim disable() As Boolean = Array As Boolean(False)
	Wait For (sf) Dialog_Result (Result As Int)
	disable(0) = True 'disable the AutoClose timer
	If Result = TimedDialog.RESULT_POSITIVE Then
		analytics.SendEvent("out_of_lives", Null)
		Page1.RootPanel.RemoveAllViews
		Page1.RootPanel.LoadLayout("titleScreenLayout2")
		showPage(NavControl,Page1,2)
		TitlePageDesignerScript
		returnToTitle
		questionCount = 0
		correctCount = 0
		incorrectCount = 0
		subtCorrectAnimation(i)
		subtCoinsAnimation(q)
	End If
End Sub

Private Sub backButton_Click
	playSoundClick
	backButtonAnimation
	Sleep(100)
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("titleScreenLayout2")
	showPage(NavControl,Page1,2)
	TitlePageDesignerScript
	returnToTitle
	questionCount = 0
	correctCount = 0
	incorrectCount = 0
	
End Sub

Private Sub Application_Background
End Sub

Private Sub Page1_Resize(Width As Int, Height As Int)'
	
End Sub

Sub iad_Ready (Success As Boolean)
	If Success Then
		Log("iad is ready")
		canshownow = True
	Else
		Log("Failed to load full screen ad: " & LastException)
	End If
End Sub

Sub iadbanner_Ready (Success As Boolean)
	If Success Then
		Log("iadbanner is ready")
		canshownow = True
	Else
		Log("Failed to load BANNER ad: " & LastException)
	End If
End Sub

Sub achieveKVSInit
	If achieveKVS.ContainsKey("1") = False Then
		achieveKVS.Put("1", 0)
	End If
	
End Sub
Sub achieveKVSSetup
	achieveKVSInit
	If Not(viewName = "add-user.png") And Not(colorArray(0) = xui.Color_RGB(255,255,255)) And Not(buffKvs.Get("1") = 0)  Then
		achieveKVS.Put("1", 100)
	Else
		achieveKVS.Put("1", 0)
	End If
End Sub

Sub sendAchievements
	Try
		For i = 1 To 30
			If achieveKVS.ContainsKey(i) = False Then
				Dim stringI As String  = QUOTE & i & QUOTE
				Log(stringI)
				achieveKVS.Put(i, 0)
				Log(achieveKVS.Get(stringI))
			End If
		Next
		If kvscache.Get("1") = 5 And achieveKVS.Get("1") = 0 Then
			SubmitAchievement("grp.5questionsCorrectID", (kvscache.Get("1")/5) * 100)
			analytics.SendEvent("ach_5questionsCorrect", Null)
			achieveKVS.put(1, 1)
		End If
		If kvscache.Get("1") = 10 And achieveKVS.Get("2") = 0 Then
			SubmitAchievement("grp.10questionsCorrect", (kvscache.Get("1")/10) * 100)
			analytics.SendEvent("ach_10questionsCorrect", Null)
			achieveKVS.put(2, 1)
		End If
		If kvscache.Get("1") = 25 And achieveKVS.Get("3") = 0 Then
			SubmitAchievement("grp.25questionsCorrectID", (kvscache.Get("1")/25)  * 100)
			analytics.SendEvent("ach_25questionsCorrect", Null)
			achieveKVS.put(3, 1)
		End If
		If kvscache.Get("1") = 50 And achieveKVS.Get("4") = 0 Then
			SubmitAchievement("grp.50questionsCorrectID", (kvscache.Get("1")/50)  * 100)
			analytics.SendEvent("ach_50questionsCorrect", Null)
			achieveKVS.put(4, 1)
		End If
		If kvscache.Get("1") = 100 And achieveKVS.Get("5") = 0 Then
			SubmitAchievement("grp.100questionsCorrectID", (kvscache.Get("1")/100)  * 100)
			analytics.SendEvent("ach_100questionsCorrect", Null)
			achieveKVS.put(5, 1)
		End If
		If kvscache.Get("1") = 250 And achieveKVS.Get("6") = 0 Then
			SubmitAchievement("grp.250questionsCorrectID", (kvscache.Get("1")/250)  * 100)
			analytics.SendEvent("ach_250questionsCorrect", Null)
			achieveKVS.put(6, 1)
		End If
		If kvscache.Get("1") = 500 And achieveKVS.Get("7") = 0 Then
			SubmitAchievement("grp.500questionsCorrectID", (kvscache.Get("1")/500)  * 100)
			analytics.SendEvent("ach_500questionsCorrect", Null)
			achieveKVS.put(7, 1)
		End If
		If coinKvs.Get("1") = 100 And achieveKVS.Get("8") = 0 Then
			SubmitAchievement("grp.100CoinsID", (coinKvs.Get("1")/500)  * 100)
			analytics.SendEvent("ach_100Coins", Null)
			achieveKVS.put(8, 1)
		End If
		If kvscache.Get("1") = 500 And achieveKVS.Get("9") = 0 Then
			SubmitAchievement("grp.500CoinsID", (coinKvs.Get("1")/500)  * 100)
			analytics.SendEvent("ach_500Coins", Null)
			achieveKVS.put(9, 1)
			'SubmitAchievement("grp.StorePerksID", achieveKVS.Get("1"))
		End If
		If kvscache.Get("2") = 3 And achieveKVS.Get("10") = 0 Then
			SubmitAchievement("grp.level3ID", (kvscache.Get("2")/3)*100)
			analytics.SendEvent("ach_level3", Null)
			achieveKVS.put(10, 1)
		End If
		If kvscache.Get("2") = 5 And achieveKVS.Get("11") = 0 Then
			SubmitAchievement("grp.level5ID", (kvscache.Get("2")/5)*100)
			analytics.SendEvent("ach_level5", Null)
			achieveKVS.put(11, 1)
		End If
		If kvscache.Get("2") = 10 And achieveKVS.Get("12") = 0 Then
			SubmitAchievement("grp.Level10ID", (kvscache.Get("2")/10)*100)
			analytics.SendEvent("ach_Level10", Null)
			achieveKVS.put(12, 1)
		End If
		If kvscache.Get("2") = 15 And achieveKVS.Get("13") = 0 Then
			SubmitAchievement("grp.level15ID", (kvscache.Get("2")/15)*100)
			analytics.SendEvent("ach_level15", Null)
			achieveKVS.put(13, 1)
		End If
		If kvscache.Get("2") = 20 And achieveKVS.Get("14") = 0 Then
			SubmitAchievement("grp.level20ID", (kvscache.Get("2")/20)*100)
			analytics.SendEvent("ach_level20", Null)
			achieveKVS.put(14, 1)
		End If
		If kvscache.Get("2") = 25 And achieveKVS.Get("15") = 0 Then
			SubmitAchievement("grp.level25ID", (kvscache.Get("2")/25)*100)
			analytics.SendEvent("ach_level25", Null)
			achieveKVS.put(15, 1)
		End If
		If kvscache.Get("2") = 30 And achieveKVS.Get("16") = 0 Then
			SubmitAchievement("grp.level30ID", (kvscache.Get("2")/30)*100)
			analytics.SendEvent("ach_level30", Null)
			achieveKVS.put(16, 1)
		End If
		If kvscache.Get("2") = 35 And achieveKVS.Get("17") = 0 Then
			SubmitAchievement("grp.level35ID", (kvscache.Get("2")/35)*100)
			analytics.SendEvent("ach_level35", Null)
			achieveKVS.put(17, 1)
		End If
		If kvscache.Get("2") = 40 And achieveKVS.Get("18") = 0 Then
			SubmitAchievement("grp.level40ID", (kvscache.Get("2")/40)*100)
			analytics.SendEvent("ach_level40", Null)
			achieveKVS.put(18, 1)
		End If
		If kvscache.Get("2") = 45 And achieveKVS.Get("19") = 0 Then
			SubmitAchievement("grp.level45ID", (kvscache.Get("2")/45)*100)
			analytics.SendEvent("ach_level45", Null)
			achieveKVS.put(19, 1)
		End If
		If kvscache.Get("2") = 50 And achieveKVS.Get("20") = 0 Then
			SubmitAchievement("grp.level50ID", (kvscache.Get("2")/50)*100)
			analytics.SendEvent("ach_level50", Null)
			achieveKVS.put(20, 1)
		End If
		If inARowKvs.Get("1") = 5 And achieveKVS.Get("21") = 0 Then
			SubmitAchievement("grp.5inaRowID", (inARowKvs.Get("1")/5)*100)
			analytics.SendEvent("ach_5inaRow", Null)
			achieveKVS.put(21, 1)
		End If
		If kvscache.Get("2") = 10 And achieveKVS.Get("22") = 0 Then
			SubmitAchievement("grp.10inaRowID", (inARowKvs.Get("1")/10)*100)
			analytics.SendEvent("ach_10inaRow", Null)
			achieveKVS.put(22, 1)
		End If
		If kvscache.Get("2") = 15 And achieveKVS.Get("23") = 0 Then
			SubmitAchievement("grp.15inaRowID", (inARowKvs.Get("1")/15)*100)
			analytics.SendEvent("ach_15inaRow", Null)
			achieveKVS.put(23, 1)
		End If
		If kvscache.Get("2") = 20 And achieveKVS.Get("24") = 0 Then
			SubmitAchievement("grp.20inaRow", (inARowKvs.Get("1")/20)*100)
			analytics.SendEvent("ach_10questionsCorrect", Null)
			achieveKVS.put(24, 1)
		End If
		If kvscache.Get("2") = 25 And achieveKVS.Get("25") = 0 Then
			SubmitAchievement("grp.25inaRowID", (inARowKvs.Get("1")/25)*100)
			analytics.SendEvent("ach_10questionsCorrect", Null)
			achieveKVS.put(25, 1)
		End If
		If kvscache.Get("2") = 30 And achieveKVS.Get("26") = 0 Then
			SubmitAchievement("grp.30inaRowID", (inARowKvs.Get("1")/30)*100)
			analytics.SendEvent("ach_10questionsCorrect", Null)
			achieveKVS.put(26, 1)
		End If
		If kvscache.Get("2") = 40 And achieveKVS.Get("27") = 0 Then
			SubmitAchievement("grp.40inaRowID", (inARowKvs.Get("1")/40)*100)
			analytics.SendEvent("ach_10questionsCorrect", Null)
			achieveKVS.put(27, 1)
		End If
		If kvscache.Get("2") = 50 And achieveKVS.Get("28") = 0 Then
			SubmitAchievement("grp.50inaRowID", (inARowKvs.Get("1")/50)*100)
			analytics.SendEvent("ach_10questionsCorrect", Null)
			achieveKVS.put(28, 1)
		End If
		If kvscache.Get("2") = 100 And achieveKVS.Get("29") = 0 Then
			SubmitAchievement("grp.100inaRowID", (inARowKvs.Get("1")/100)*100)
			analytics.SendEvent("ach_10questionsCorrect", Null)
			achieveKVS.put(29, 1)
		End If
		If questionCount = 5 And correctCount = 5 And achieveKVS.Get("30") = 0 Then
			SubmitAchievement("grp.5inaRow", 100)
			analytics.SendEvent("ach_10questionsCorrect", Null)
			achieveKVS.put(30, 1)
		End If
		
		If coinKvs.get("2") > 1000 Then
			SubmitAchievement("grp.", 100)
		End If
		If coinKvs.Get("2") > 2500 Then
			SubmitAchievement("grp.", 100)
		End If
		If coinKvs.Get("2") > 5000 Then
			SubmitAchievement("grp.", 100)
		End If
		If coinKvs.Get("2") > 10000 Then
			SubmitAchievement("grp.", 100)
		End If
	Catch
		Log(LastException)
		catchToFirebase(LastException)
	End Try
End Sub

Sub GetRecord (id As Int)
	'calls the two functions below this one
	Dim req As DBRequestManager = CreateRequest
	Dim cmd1 As DBCommand = CreateCommand("select_animal", Array(id))
	
	Wait For (req.ExecuteQuery(cmd1, 0, Null)) JobDone(j As HttpJob)
	If j.Success Then
		req.HandleJobAsync(j, "req")
		Wait For (req) req_Result(res As DBResult)
		'work with result
		req.PrintTable(res)
	Else
		Log("ERROR: " & j.ErrorMessage)
	End If
	j.Release
End Sub

Sub CreateRequest As DBRequestManager
	Dim req As DBRequestManager
	req.Initialize(Me, rdcLink)
	Return req
End Sub

Sub CreateCommand(Name As String, Parameters() As Object) As DBCommand
	Dim cmd1 As DBCommand
	cmd1.Initialize
	cmd1.Name = Name
	If Parameters <> Null Then cmd1.Parameters = Parameters
	Return cmd1
End Sub

Private Sub achievementButton_Click
	playSoundClick
	Try
		achieveKVSSetup
		ShowLeaderboard(Page1, "grp.romanleaderboard", 1)
		analytics.SendEvent("achieve_screen_opened", Null)
		sendAchievements
	Catch
		Log(LastException)
		catchToFirebase(LastException)
	End Try
End Sub

Sub getKvsCache
	If 0 == settingsKvs.Get("10") Then
		Dim levelUpBool As Boolean
		If kvscache.ContainsKey("2") = False Then
			kvscache.Put("2", 1)
		End If
		If 1 == kvscache.Get("2") Then
			If kvscache.Get("1") >= 5 Then
				kvscache.Put("2", 2)
				coinKvs.Put("1", coinKvs.Get("1") + 10)
				lvlpanelInit
				levelGainedAnimation
				levelCoinsAddLabel.Text = 10
			End If
		Else
			For i = 1 To 62  ' Puts current level in kvs #2
				Dim c As Int = i - 1
				If kvscache.Get("1") < milestoneArray(i) And kvscache.Get("1") >= (milestoneArray(c)) Then
					Dim q As Int = kvscache.Get("2")
					kvscache.Put("2", i+1)
					If q < kvscache.Get("2") Then
						levelUpBool = True
					End If
					i = 63
				End If
			Next
			If 1 == kvscache.Get("2") Or 2 == kvscache.Get("2")Then
			Else
				If kvscache.Get("1") >= milestoneArray(q-2) And levelUpBool Then
					coinKvs.Put("1", coinKvs.Get("1") + milestoneArray(q-1))
					lvlpanelInit
					levelGainedAnimation
					levelCoinsAddLabel.Text = milestoneArray(q-1)
					levelUpBool = False
				End If
			End If
		End If
		If  1 == kvscache.Get("2") Then
			kvscache.Put("3", 0)
		Else
			For i = 1 To 9    ' Gets negative number of value
				Dim c As Int = i - 1
				If kvscache.Get("1") < milestoneArray(i) And kvscache.Get("1") > (milestoneArray(c)) Then
					Dim j As Int = (milestoneArray(i))
					kvscache.Put("3", j)
				End If
			Next
		End If
		If kvscache.ContainsKey("4") = False Then
			kvscache.Put("4", 0)
		End If
		If kvscache.ContainsKey("5") = False Then
			kvscache.Put("5", 0)
		End If
		If kvscache.ContainsKey("6")  = False Then
			kvscache.Put("6", 0)
		End If
	End If
End Sub

Private Sub skipButton_Click
	playSoundClick
	If aLabel.enabled = True Then
		If .5 == buffKvs.Get("5") Then ' if skip buff activated
			If coinKvs.Get("1") >= 50 Then
				coinKvs.Put("1", coinKvs.Get("1") - (50*buffKvs.Get("5")))
				coinAddLabel.Text = (-50*buffKvs.Get("5"))
				coinKvs.Put("3", coinKvs.Get("3") - coinAddLabel.Text)
				coinAddLabel.textcolor = Colors.Black
				coinAnimation
				coinAnimation2
				cLabel.mBase.Visible = False
				dLabel.mBase.Visible = False
			Else
				notEnoughCoinsMsg
			End If
		Else
			If coinKvs.Get("1") >= 50 Then
				coinKvs.Put("1", coinKvs.Get("1") - 50)
				coinAddLabel.Text = "-50"
				coinKvs.Put("3", coinKvs.Get("3") - coinAddLabel.Text)
				coinAddLabel.textcolor = Colors.Black
				coinAnimation
				coinAnimation2
				cLabel.mBase.Visible = False
				dLabel.mBase.Visible = False
			Else
				notEnoughCoinsMsg
			End If
		End If
	End If
	skipUserEnabled(False)
End Sub

Sub getTitleImage
	Dim r As Int
	r = Rnd(0,10)
	Try
		Select Case r
			Case 0
				ImageView1.bitmap = LoadBitmap(File.DirAssets, "rome.jpg")
			Case 1
				ImageView1.bitmap = LoadBitmap(File.DirAssets, "rome2.webp")
			Case 2
				ImageView1.bitmap = LoadBitmap(File.DirAssets, "rome3.webp")
			Case 3
				ImageView1.bitmap = LoadBitmap(File.DirAssets, "rome4.jpg")
			Case 4
				ImageView1.bitmap = LoadBitmap(File.DirAssets, "rome5.jpg")
			Case 5
				ImageView1.bitmap = LoadBitmap(File.DirAssets, "rome6.jpg")
			Case 6
				ImageView1.bitmap = LoadBitmap(File.DirAssets, "rome7.jpg")		
		End Select
	Catch
		Log("Cannot Open Image")
		catchToFirebase(LastException)
	End Try
	
End Sub

Private Sub ImageView1_Click
	playSoundClick
	getTitleImage
	
	peteCounter = peteCounter + 1
	If peteCounter == 20 Then
		runVideo
		peteCounter = 0
	End If
End Sub

Sub GameCenter_AuthenticationStateChanged (Authenticated As Boolean, ShouldShowDialog As Boolean)
	If Authenticated Then
		titleUsername.Text = Game.LocalPlayer.DisplayName
		gameViewButton.Alpha = 1
		gameViewButton.UserInteractionEnabled = True
		hasConnection = True
		noConnectionImageView.Visible = False
		analytics.SendEvent("gc_login_success", Null)
	Else
		analytics.SendEvent("gc_login_fail", Null)
	End If
End Sub

Sub submitLeaderScore
	Dim score As GKScore
	analytics.SendEvent("gc_submit_score", Null)
	score.Initialize("grp.romanleaderboard")
	score.Value = kvscache.Get("1")
	Wait For (Game.SubmitScore(score)) GameCenter_ScoreSubmitted (Success As Boolean)
End Sub

Sub refreshScores
	If Game.LocalPlayer.Authenticated Then
		Dim sf As Object = Game.RequestScores("grp.romanleaderboard")
		txtScore.text = Round(kvscache.get("1"))
		Wait For (sf) GameCenter_ScoresAvailable (Success As Boolean, Scores As List, PlayerScore As GKScore)
		If Success = False Then
			Log(LastException)
		Else
			CustomListView1.Clear
			CustomListView2.Clear
			For Each score As GKScore In Scores
				CustomListView1.AddTextItem($"${score.Player.Alias}"$, "")
				CustomListView2.AddTextItem($"${score.Value}"$, "")
			Next
		End If
	End If
End Sub

Private Sub gameViewButton_Click
	playSoundClick
	Try
		submitLeaderScore
		ShowLeaderboard(Page1, "grp.romanleaderboard", 0)
		analytics.SendEvent("leader_screen_opened", Null)
	Catch
		catchToFirebase(LastException)
		Log(LastException)
	End Try
End Sub

Sub AppVersion As String
	Dim no As NativeObject
	no = no.Initialize("NSBundle").RunMethod("mainBundle", Null)
	Dim version As Object = no.RunMethod("objectForInfoDictionaryKey:", Array("CFBundleShortVersionString"))
	Return version
End Sub

Private Sub removeAdsSwitch_ValueChanged (Value As Boolean)
	playSoundClick
	If Value = True Then
		removeAdsLoading.mBase.Visible = True
		MyStore.RequestPayment("roman_IAP")
		wait for MyStore_PurchaseCompleted
		removeAdsLoading.mBase.Visible = False
	Else
		removeAdsSwitch.Value = False
		hud.ToastMessageShow("Purchase Failed", False)
		removeAdsLoading.mBase.Visible = False
	End If
	analytics.SendEvent("remove_ads_click", Null)
End Sub

Sub removeAdsButtonDisabled
	removeAdsSwitch.Enabled = False
	removeAdsLabel.Text = "Ads Removed:"
	coinsInfoButton.SetLayoutAnimated(0, 1, coinsInfoButton.Left + 10, coinsInfoButton.Top,coinsInfoButton.Width, coinsInfoButton.Height)
	restorePurchasesButton.UserInteractionEnabled = False
	restorePurchPanel.UserInteractionEnabled = False
End Sub

Sub MyStore_PurchaseCompleted (Success As Boolean, Product As Purchase)
	Log("Purchase completed")
	If Product.IsInitialized Then
		Log("Product: " & Product.ProductIdentifier & ", date=" & DateTime.Time(Product.TransactionDate) & _
       ", Transaction identifier=" & Product.TransactionIdentifier)
	Else
		removeAdsLoading.mBase.Visible = False
	End If
	Log("Success = " & Success)
	If Success = True Then purchasedstuff(Product.ProductIdentifier)
	If Success = False Then
		removeAdsLoading.mBase.Visible = False
		hud.ToastMessageShow("Purchase Failed", False)
	End If
End Sub

Sub purchasedstuff (p As String)
	If p = "roman_IAP" Then 'alllevels is your product id for unlocking all levels...
		settingsKvs.Put("5", 1)
		bannerAdString = ""
		institualAdString = ""
		removeAdsButtonDisabled
		removeAdsSwitch.Value = True
		removeAdsLoading.mBase.Visible = False
		analytics.SendEvent("purchase_ads_removed", Null)
	End If
End Sub
	
Private Sub SendEmail(bodyStr As String, subj As String) 'Sets up and sends email
	Try
		emailLoadingIndicator.mBase.Visible = True
		emailButton.Enabled = False
		Log("email")
		Dim mail As SMTP
		Dim Email As String=returnEmailField.Text
		Dim Port As Int=587
		mail.DebugLogs = True
		mail.Initialize("smtp.gmail.com", Port, "natesobol@gmail.com", "ritpttmruljuairl", "SMTP")
		mail.StartTLSMode = True
		mail.UseSSL=False
		mail.To.Add("natesobol@gmail.com")
		mail.HtmlBody=True
		mail.Subject = subjectField.Text
		mail.Body = "Date: " & DateTime.Date(DateTime.Now) & " at " & (DateTime.Time(DateTime.Now)) & CRLF & returnEmailField.Text & CRLF & bodyStr
		mail.Sender = Email
		mail.HtmlBody = True
		mail.Send
		Wait For smtp_MessageSent(Success As Boolean)
		Log(Success)
		Log(LastException)
		playSoundBlastOff
		hud.ToastMessageShow("Email Sent!", False)
		emailKvs.put("1", Email) ' puts email in KVS
		Log("Email Address " & emailKvs.Get("1"))
		emailLoadingIndicator.mBase.Visible = False
		emailButton.Enabled = False
	Catch
		catchToFirebase(LastException)
		Log("SendEmail " & LastException)
	End Try
End Sub
	
Private Sub sendEmailButton_Click
	playSoundClick
	Dim checkEmailAddress As String = emailKvs.Get("1")
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("emailLayout")
	showPage(NavControl,Page1,3)
	emailTitleLabel.Text = "Email Author"
	emailLogo.Bitmap= LoadBitmap(File.DirAssets, "email.png")
	returnEmailField.KeyboardType = returnEmailField.TYPE_EMAIL_ADDRESS
	returnEmailField.Text = emailKvs.Get("1")
	If 1 == settingsKvs.Get("1") Then
		emailDarktheme
	Else
		emailLightTheme
	End If
	emailButtonColor
End Sub

Private Sub emailButton_Click
	playSoundClick
	SendEmail(bodyField.Text, subjectField.Text)
End Sub

Private Sub developerSiteButton_Click
	analytics.SendEvent("developer_site_click", Null)
	playSoundClick
	safari.Initialize("safari", "https://www.nsobol.com")
	safari.Show(Page1)
	'App.OpenUrl("https://www.nsobol.com/")
End Sub

Private Sub resetScoreButton_Click
	playSoundClick
	analytics.SendEvent("reset_scores_click", Null)
	Dim p As Panel
	p.Initialize("")
	p.SetLayoutAnimated(0, 1, 0, 0, Page1.RootPanel.Width - 50dip, 100dip)
	p.LoadLayout("resetScoreLayout")
	Dim TimedDialog As CustomLayoutDialog
	TimedDialog.Initialize(p)
	TimedDialog.Style = TimedDialog.STYLE_INFO
	Dim sf As Object = TimedDialog.ShowAsync("", "Yes", "No", "", False)
	Dim disable() As Boolean = Array As Boolean(False)
	Wait For (sf) Dialog_Result (Result As Int)
	disable(0) = True 'disable the AutoClose timer
	If Result = TimedDialog.RESULT_POSITIVE Then
		resetScores
		Page1.RootPanel.RemoveAllViews
		Page1.RootPanel.LoadLayout("titleScreenLayout2")
		showPage(NavControl,Page1, 2)
		TitlePageDesignerScript
		returnToTitle
	End If
End Sub

Sub resetScores
	kvscache.Put("1", 0)
	kvscache.Put("2", 1)
	kvscache.Put("3", 0)
	kvscache.Put("4", 0)
	kvscache.Put("5", 0)
	kvscache.Put("6", 0)
	kvscache.Put("7", 0)
	coinKvs.Put("1", 0)
	buffKvs.Put("1", 0)
	buffKvs.Put("3", 1)
	buffKvs.Put("4", 1)
	buffKvs.Put("5", 1)
	buffKvs.Put("6", 0)
	idolKvs.Put("1", 0)
	titleKvs.Remove("1")
	titleKvs.put("2", 0)
End Sub

Private Sub developerSiteButton2_Click
	analytics.SendEvent("developer_site_click", Null)
	playSoundClick
	App.OpenUrl("https://apps.apple.com/us/developer/nathan-sobol/id1479742363")
End Sub

Private Sub sliderNumber_EnterPressed
	Dim i As Int = sliderNumber.Text
	If Slider1.Value >= 300 Then
		Slider1.Value = 300
		sliderNumber.Text = 300
	End If
	settingsKvs.Put("4", i)
	Slider1.Value = i
End Sub

Private Sub leaveReviewButton_Click
	analytics.SendEvent("leave_review_click", Null)
	playSoundClick
	If App.OSVersion > 10.3 Then
		Dim no As NativeObject
		no.Initialize("SKStoreReviewController").RunMethod("requestReview", Null)
	End If
End Sub

' Blue, Red, Green, Purple, Orange, Pink, Yellow, Silver, Gold
Sub pickColor(imgview As Int)
	Dim colorPickedPrimary As Int
	Dim colorPickedSecondary As Int
	Select imgview
		Case 0
			'blue
			colorPickedPrimary = xui.Color_RGB(255,255,255)
			colorPickedSecondary = xui.Color_RGB(220,220,220)
		Case 1
			'Blue
			colorPickedPrimary = xui.Color_RGB(224,255,255)
			colorPickedSecondary = xui.Color_RGB(135,206,250)
		Case 2
			' Orange
			colorPickedPrimary = xui.Color_RGB(249, 188, 96)
			colorPickedSecondary = xui.Color_RGB(250, 69, 37)
		Case 3
			' Green
			colorPickedPrimary = xui.Color_RGB(144, 250, 37)
			colorPickedSecondary = xui.Color_RGB(85, 194, 31)
		Case 4
			' Purple
			colorPickedPrimary = xui.Color_RGB(221,160,221)
			colorPickedSecondary = xui.Color_RGB(218,112,214)
		Case 5
			'Orange
			colorPickedPrimary = xui.Color_RGB(247, 168, 64)
			colorPickedSecondary = xui.Color_RGB(191, 103, 257)
		Case 6
			' Pink
			colorPickedPrimary = xui.Color_RGB(245,218,223)
			colorPickedSecondary = xui.Color_RGB(255,182,193)
		Case 7
			'Yellow
			colorPickedPrimary = xui.Color_RGB(222, 255, 8)
			colorPickedSecondary = xui.Color_RGB(166, 191, 6)
		Case 8
			colorPickedPrimary = xui.Color_RGB(165, 166, 162)
			colorPickedSecondary = xui.Color_RGB(111, 112, 109)
		Case 9
			colorPickedPrimary = xui.Color_RGB(255, 255, 255)
			colorPickedSecondary = xui.Color_RGB(211, 211, 211)
	End Select
	colorArray(0) = colorPickedPrimary
	colorArray(1) = colorPickedSecondary
End Sub


Sub disableColorView(view As ImageView)
	colorview1.UserInteractionEnabled = True
	colorview2.UserInteractionEnabled = True
	colorview3.UserInteractionEnabled = True
	colorview4.UserInteractionEnabled = True
	coloview5.UserInteractionEnabled = True
	colorview6.UserInteractionEnabled = True
	colorview7.UserInteractionEnabled = True
	colorview8.UserInteractionEnabled = True
	colorview9.UserInteractionEnabled = True
	view.UserInteractionEnabled = False
End Sub

Sub disableAvatarView(view As ImageView)
	avatarView1.UserInteractionEnabled = True
	avatarView2.UserInteractionEnabled = True
	avatarView3.UserInteractionEnabled = True
	avatarView4.UserInteractionEnabled = True
	avatarView5.UserInteractionEnabled = True
	avatarView6.UserInteractionEnabled = True
	avatarView7.UserInteractionEnabled = True
	avatarView8.UserInteractionEnabled = True
	avatarView9.UserInteractionEnabled = True
	view.UserInteractionEnabled = False
End Sub

Sub disableIdolView(view As ImageView)
	If 0 == idolKvs.Get("1") Then
		idol1.UserInteractionEnabled = True
		idol2.UserInteractionEnabled = False
		idol3.UserInteractionEnabled = False
		idol4.UserInteractionEnabled = False
		idol5.UserInteractionEnabled = False
		idol2.Alpha = .3
		idol3.Alpha = .3
		idol4.Alpha = .3
		idol5.Alpha = .3
	End If
	If view = idol1 Then
		idol1.UserInteractionEnabled = True
		idol2.UserInteractionEnabled = True
		idol3.UserInteractionEnabled = False
		idol4.UserInteractionEnabled = False
		idol5.UserInteractionEnabled = False
		view.UserInteractionEnabled = False
		idol2.Alpha = 1
		idol3.Alpha = .3
		idol4.Alpha = .3
		idol5.Alpha = .3
	End If
	If view = idol2 Then
		idol1.UserInteractionEnabled = False
		idol2.UserInteractionEnabled = True
		idol3.UserInteractionEnabled = True
		idol4.UserInteractionEnabled = False
		idol5.UserInteractionEnabled = False
		view.UserInteractionEnabled = False
		check1.Visible = True
		idol1.Alpha = .3
		idol4.Alpha = .3
		idol5.Alpha = .3
		idol3.Alpha = 1
	End If
	If view = idol3 Then
		idol1.UserInteractionEnabled = False
		idol2.UserInteractionEnabled = False
		idol3.UserInteractionEnabled = True
		idol4.UserInteractionEnabled = True
		idol5.UserInteractionEnabled = False
		view.UserInteractionEnabled = False
		check1.Visible = True
		check2.Visible = True
		idol1.Alpha = .3
		idol2.Alpha = .3
		idol5.Alpha = .3
		idol4.Alpha = 1
	End If
	If view = idol4 Then
		idol1.UserInteractionEnabled = False
		idol2.UserInteractionEnabled = False
		idol3.UserInteractionEnabled = False
		idol4.UserInteractionEnabled = True
		idol5.UserInteractionEnabled = True
		view.UserInteractionEnabled = False
		check1.Visible = True
		check2.Visible = True
		check3.Visible = True
		idol1.Alpha = .3
		idol2.Alpha = .3
		idol3.Alpha = .3
		idol5.Alpha = 1
	End If
	If view = idol5 Then
		idol1.UserInteractionEnabled = False
		idol2.UserInteractionEnabled = False
		idol3.UserInteractionEnabled = False
		idol4.UserInteractionEnabled = False
		idol5.UserInteractionEnabled = False
		view.UserInteractionEnabled = False
		check1.Visible = True
		check2.Visible = True
		check3.Visible = True
		check4.Visible = True
		idol1.Alpha = .3
		idol2.Alpha = .3
		idol3.Alpha = .3
		idol4.Alpha = .3
	End If
End Sub

Private Sub colorview1_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(1)
		settingsKvs.Put("6", 1)
		clearBorder
		colorview1.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(colorview1)
End Sub

Private Sub colorview2_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(2)
		settingsKvs.Put("6", 2)
		clearBorder
		colorview2.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(colorview2)
End Sub

Private Sub colorview3_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(3)
		settingsKvs.Put("6", 3)
		clearBorder
		colorview3.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(colorview3)
End Sub

Private Sub colorview4_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(4)
		settingsKvs.Put("6", 4)
		clearBorder
		colorview4.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(colorview4)
End Sub

Private Sub coloview5_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(5)
		settingsKvs.Put("6", 5)
		clearBorder
		coloview5.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(coloview5)
End Sub

Private Sub colorview6_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(6)
		settingsKvs.Put("6", 6)
		clearBorder
		colorview6.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(colorview6)
End Sub

Private Sub colorview7_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(7)
		settingsKvs.Put("6", 7)
		clearBorder
		colorview7.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(colorview7)
End Sub

Private Sub colorview8_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(8)
		settingsKvs.Put("6", 8)
		clearBorder
		colorview8.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(colorview8)
End Sub

Private Sub colorview9_Click
	playSoundClick
	Dim b As Boolean = schemeCoinCounter(100)
	If b Then
		pickColor(9)
		settingsKvs.Put("6", 9)
		clearBorder
		colorview9.SetBorder(2, Colors.Black, 2)
	End If
	storeButtonColor
	updateStore(100)
	disableColorView(colorview9)
End Sub

Private Sub storeButton_Click
	playSoundClick
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("testStore")
	analytics.SendEvent("store_page_opened", Null)
	storeIdolView
	disableQuestionMark
	showPage(NavControl,Page1,3)
	colorPanel.SetShadow(Colors.DarkGray,2,2,1,True)
	avatarPanel.SetShadow(Colors.DarkGray,2,2,1,True)
	buffPanel.SetShadow(Colors.DarkGray,2,2,1,True)
	idolPanel.SetShadow(Colors.DarkGray,2,2,1,True)
	getBannerAd
	lblUser.Text = Game.LocalPlayer.DisplayName
	NavControl.NavigationBarVisible = False
	clearBorder
	pickAvatarSelectedBorder(settingsKvs.Get("7"))
	pickColorSelectedBorder(settingsKvs.Get("6"))
	pickBuffSelectedBorder
	pickIdolSelectedBorder(idolKvs.Get("1"))
	storeCoinLabel.Text = coinKvs.Get("1")
	titleAvatarView.Bitmap= LoadBitmap(File.DirAssets, viewName)
	storeAvatarView.Bitmap= LoadBitmap(File.DirAssets, viewName)
	avatarTitlePanel.Color = colorArray(0)
	If 1 == settingsKvs.Get("1") Then
		storeDarkTheme
	Else
		storeLightTheme
	End If
	storeButtonColor
End Sub

Sub updateStore(coins As Int)
	storeCoinLabel.text = coinKvs.Get("1")
	If coinKvs.Get("1") >= coins Then
		coinAddLabel.text = -(coins)
		coinKvs.Put("2", storeCoinLabel.text - coinKvs.Get("1"))
		storeCoinLabel.Text = coinKvs.Get("1")
		titleAvatarView.Bitmap = LoadBitmap(File.DirAssets, viewName)
		storeAvatarView.Bitmap= LoadBitmap(File.DirAssets, viewName)
		avatarTitlePanel.Color = colorArray(0)
		storeCoinAnimation
		playSoundCorrect
	End If
End Sub

Sub clearBorder
	colorview1.SetBorder(0,Colors.Transparent, 0)
	colorview2.SetBorder(0,Colors.Transparent, 0)
	colorview3.SetBorder(0,Colors.Transparent, 0)
	colorview4.SetBorder(0,Colors.Transparent, 0)
	coloview5.SetBorder(0,Colors.Transparent, 0)
	colorview6.SetBorder(0,Colors.Transparent, 0)
	colorview7.SetBorder(0,Colors.Transparent, 0)
	colorview8.SetBorder(0,Colors.Transparent, 0)
	colorview9.SetBorder(1,Colors.Black, 2)
End Sub

Sub clearBorderAvatar
	avatarView1.SetBorder(0,Colors.Transparent, 0)
	avatarView2.SetBorder(0,Colors.Transparent, 0)
	avatarView3.SetBorder(0,Colors.Transparent, 0)
	avatarView4.SetBorder(0,Colors.Transparent, 0)
	avatarView5.SetBorder(0,Colors.Transparent, 0)
	avatarView6.SetBorder(0,Colors.Transparent, 0)
	avatarView7.SetBorder(0,Colors.Transparent, 0)
	avatarView8.SetBorder(0,Colors.Transparent, 0)
	avatarView9.SetBorder(0,Colors.Transparent, 0)
End Sub

Sub clearBorderIdol
	idol1.SetBorder(0,Colors.Transparent, 0)
	idol2.SetBorder(0,Colors.Transparent, 0)
	idol3.SetBorder(0,Colors.Transparent, 0)
	idol4.SetBorder(0,Colors.Transparent, 0)
	idol5.SetBorder(0,Colors.Transparent, 0)
End Sub

Sub pickAvatar(avatarView As Int)
	Select avatarView
		Case 0
			viewName = "add-user.png"
		Case 1
			viewName = "bear.png"
		Case 2
			viewName = "pawn.png"
		Case 3
			viewName = "rocket.png"
		Case 4
			viewName = "groundhog.png"
		Case 5
			viewName = "horse.png"
		Case 6
			viewName = "ideas.png"
		Case 7
			viewName = "bigfoot.png"
		Case 8
			viewName = "butterfly.png"
		Case 9
			viewName = "rook.png"
	End Select
End Sub

Sub pickAvatarSelectedBorder(avatarView As Int)
	Select avatarView
		Case 0
			clearBorderAvatar
		Case 1
			avatarView1.SetBorder(2,Colors.Black, 0)
			avatarView1.UserInteractionEnabled = False
		Case 2
			avatarView2.SetBorder(2,Colors.Black, 0)
			avatarView2.UserInteractionEnabled = False
		Case 3
			avatarView3.SetBorder(2,Colors.Black, 0)
			avatarView3.UserInteractionEnabled = False
		Case 4
			avatarView4.SetBorder(2,Colors.Black, 0)
			avatarView4.UserInteractionEnabled = False
		Case 5
			avatarView5.SetBorder(2,Colors.Black, 0)
			avatarView5.UserInteractionEnabled = False
		Case 6
			avatarView6.SetBorder(2,Colors.Black, 0)
			avatarView6.UserInteractionEnabled = False
		Case 7
			avatarView7.SetBorder(2,Colors.Black, 0)
			avatarView7.UserInteractionEnabled = False
		Case 8
			avatarView8.SetBorder(2,Colors.Black, 0)
			avatarView8.UserInteractionEnabled = False
		Case 9
			avatarView9.SetBorder(2,Colors.Black, 0)
			avatarView9.UserInteractionEnabled = False
	End Select
End Sub

Sub pickColorSelectedBorder(colorView As Int)
	Select colorView
		Case 0
			
		Case 1
			colorview1.SetBorder(2,Colors.Black, 0)
			colorview1.UserInteractionEnabled = False
		Case 2
			colorview2.SetBorder(2,Colors.Black, 0)
			colorview2.UserInteractionEnabled = False
		Case 3
			colorview3.SetBorder(2,Colors.Black, 0)
			colorview3.UserInteractionEnabled = False
		Case 4
			colorview4.SetBorder(2,Colors.Black, 0)
			colorview4.UserInteractionEnabled = False
		Case 5
			coloview5.SetBorder(2,Colors.Black, 0)
			coloview5.UserInteractionEnabled = False
		Case 6
			colorview6.SetBorder(2,Colors.Black, 0)
			colorview6.UserInteractionEnabled = False
		Case 7
			colorview7.SetBorder(2,Colors.Black, 0)
			colorview7.UserInteractionEnabled = False
		Case 8
			colorview8.SetBorder(2,Colors.Black, 0)
			colorview8.UserInteractionEnabled = False
		Case 9
			colorview9.SetBorder(2,Colors.Black, 0)
			colorview9.UserInteractionEnabled = False
	End Select
End Sub

Sub pickBuffSelectedBorder()
	If buffKvs.Get("3") > 1 Then
		doubleCoinsButton.SetBorder(2,Colors.Black, 0)
	End If
	If buffKvs.Get("4") > 1 Then
		doubleCorrectButton.SetBorder(2,Colors.Black, 0)
	End If
	If .5 == buffKvs.Get("5") Then
		skipReductionButton.SetBorder(2,Colors.Black, 0)
	End If
	
	If 1 == buffKvs.Get("6") Then
		heartBuffButton.SetBorder(2,Colors.Black, 0)
	End If
End Sub

Sub pickIdolSelectedBorder(idolView As Int)
	Select idolView
		Case 0
			clearBorderAvatar
		Case 1
			idol1.SetBorder(2,Colors.Black, 0)
			idol1.UserInteractionEnabled = False
		Case 2
			idol2.SetBorder(2,Colors.Black, 0)
			idol2.UserInteractionEnabled = False
		Case 3
			idol3.SetBorder(2,Colors.Black, 0)
			idol3.UserInteractionEnabled = False
		Case 4
			idol4.SetBorder(2,Colors.Black, 0)
			idol4.UserInteractionEnabled = False
		Case 5
			idol5.SetBorder(2,Colors.Black, 0)
			idol5.UserInteractionEnabled = False
	End Select
End Sub

Private Sub avatarView1_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(1)
		settingsKvs.Put("7", 1)
		clearBorderAvatar
		avatarView1.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView1)
	End If
	updateStore(100)
End Sub

Private Sub avatarView2_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(2)
		settingsKvs.Put("7", 2)
		clearBorderAvatar
		avatarView2.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView2)
	End If
	updateStore(100)
End Sub

Private Sub avatarView3_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(3)
		settingsKvs.Put("7", 3)
		clearBorderAvatar
		avatarView3.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView3)
	End If
	updateStore(100)
End Sub

Private Sub avatarView4_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(4)
		settingsKvs.Put("7", 4)
		clearBorderAvatar
		avatarView4.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView4)
	End If
	updateStore(100)
End Sub

Private Sub avatarView5_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(5)
		settingsKvs.Put("7", 5)
		clearBorderAvatar
		avatarView5.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView5)
	End If
	updateStore(100)
End Sub

Private Sub avatarView6_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(6)
		settingsKvs.Put("7", 6)
		clearBorderAvatar
		avatarView6.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView6)
	End If
	updateStore(100)
End Sub

Private Sub avatarView7_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(7)
		settingsKvs.Put("7", 7)
		clearBorderAvatar
		avatarView7.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView7)
	End If
	updateStore(100)
End Sub

Private Sub avatarView8_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(8)
		settingsKvs.Put("7", 8)
		clearBorderAvatar
		avatarView8.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView8)
	End If
	updateStore(100)
End Sub

Private Sub avatarView9_Click
	playSoundClick
	Dim b As Boolean = avatarCoinCounter(100)
	If b Then
		pickAvatar(9)
		settingsKvs.Put("7", 9)
		clearBorderAvatar
		avatarView9.SetBorder(2, Colors.Black, 2)
		disableAvatarView(avatarView9)
	End If
	updateStore(100)
End Sub

Sub avatarCoinCounter(price As Int)
	Dim enoughCoins As Boolean
	If coinKvs.Get("1") >= price Then
		coinKvs.Put("1", (coinKvs.Get("1") - price))
		enoughCoins = True
		hud.ToastMessageShow("Avatar Changed!", False)
	Else
		notEnoughCoinsMsg
		enoughCoins = False
	End If
	Log("enoughcoins:"& enoughCoins)
	Return enoughCoins
End Sub

Sub schemeCoinCounter(price As Int)
	Dim enoughCoins As Boolean
	If coinKvs.Get("1") >= price Then
		coinKvs.Put("1", (coinKvs.Get("1") - price))
		enoughCoins = True
		hud.ToastMessageShow("Scheme Changed!", False)
	Else
		notEnoughCoinsMsg
		enoughCoins = False
	End If
	Log("enoughcoins:"& enoughCoins)
	Return enoughCoins
End Sub

Private Sub buySchemeButton_Click
	playSoundClick
	If colorPanel.Visible = False Then
		colorPanel.Visible = True
		buySchemeButton.xLBL.Text = "Close"
	Else
		colorPanel.Visible = False
		buySchemeButton.xLBL.Text = "Open"
	End If
End Sub

Private Sub butAvatarButton_Click
	playSoundClick
	If avatarPanel.Visible = False Then
		avatarPanel.Visible = True
		butAvatarButton.xLBL.Text = "Close"
	Else
		avatarPanel.Visible = False
		butAvatarButton.xLBL.Text = "Open"
	End If
End Sub

Private Sub titleAvatarView_Click
	playSoundClick
	storeButton_Click
	butAvatarButton.xLBL.Text = "Close"
	buySchemeButton.xLBL.Text = "Open"
	buyBuffButton.xLBL.Text = "Open"
End Sub

Private Sub developerSiteButton3_Click
	playSoundClick
	App.OpenUrl("https://apps.apple.com/us/developer/nathan-sobol/id1479742363")
End Sub

' SPLASH SCREEN
Private Sub splashtest_Click
	playSoundClick
	'create the panel.
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("spashscreen")
	Dim p As Panel
	p.Initialize("")
	p.SetLayoutAnimated(0, 1, 0, 0, Page1.RootPanel.Width - 50dip, 300dip)
End Sub

' SOUND
Sub playSoundClick
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"click.mp3","")
		ping.Volume = .5
		ping.Play
	End If
End Sub

Sub playSoundWhip
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"whip.mp3","")
		ping.Volume = .5
		ping.Play
	End If
End Sub

Sub playSoundLives
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"lives.mp3","")
		ping.Volume = 1
		ping.Play
	End If
End Sub

Sub playSoundFinish
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"finish.mp3","")
		ping.Volume = .5
		ping.Play
	End If
End Sub

Sub playSoundCorrect
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"correct.wav","")
		ping.Volume = 1
		ping.Play
	End If
End Sub

Sub playSoundIncorrect
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"wrong.mp3","")
		ping.Volume = 1
		ping.Play
	End If
End Sub

Sub playSoundBlastOff
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"blastoff.mp3","")
		ping.Volume = .8
		ping.Play
	End If
End Sub

Sub playSoundLevelUp
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"levelup.mp3","")
		ping.Volume = 1
		ping.Play
	End If
End Sub

Sub playSoundIdol
	If 1 == settingsKvs.Get("8") Then
		ping.Initialize(File.DirAssets,"slam.mp3","")
		ping.Volume = 1
		ping.Play
	End If
End Sub

Private Sub muteSwitch_ValueChanged (Value As Boolean)
	'playSoundClick
	If Value Then
		settingsKvs.Put("8", 1)
		playSoundClick
		analytics.SendEvent("mute_switch_on", Null)
	Else
		settingsKvs.Put("8", 0)
		analytics.SendEvent("mute_switch_off", Null)
	End If
End Sub

Private Sub correctInfoLabel_Click
	playSoundClick
	correctInfoLabel.Visible = False
	labelExitCorrectInfo.Visible = False
	If correctInfoLabel.Tag == "store" Then
		buffLabelPanel.Visible = False
	End If
End Sub

Private Sub scoreInfoLabel_Click
	playSoundClick
	scoreInfoLabel.Visible = False
	exitLabelScoreInfo.Visible = False
End Sub

Private Sub timerdescLabel_Click
	playSoundClick
	timerdescLabel.Visible = False
	exitTimerInfo.Visible = False
End Sub

Private Sub achDescLabel_Click
	playSoundClick
	achDescLabel.Visible = False
	exitAchInfo.Visible = False
End Sub

Private Sub analyticInfoLabel_Click
	playSoundClick
	analyticInfoLabel.Visible = False
	labelExitAnalytic.Visible = False
End Sub

Private Sub correctInfoButton_Click
	playSoundClick
	If(correctInfoLabel.Visible = False) Then
		correctInfoLabel.Visible = True
		correctInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While correctInfoLabel.Alpha < 1
			correctInfoLabel.Alpha = correctInfoLabel.Alpha + .1
			Sleep(5)
		Loop
		correctInfoLabel.BringToFront
		labelExitCorrectInfo.Visible = True
		labelExitCorrectInfo.BringToFront
		If buffLabelPanel.IsInitialized Then
			buffLabelPanel.Visible = True
			Label10.BringToFront
		End If
	Else
		correctInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While correctInfoLabel.Alpha > 0
			correctInfoLabel.Alpha = correctInfoLabel.Alpha - .1
			Sleep(5)
		Loop
		correctInfoLabel.Visible = False
		labelExitCorrectInfo.Visible = False
		If buffLabelPanel.IsInitialized Then
			buffLabelPanel.Visible = False
			Label10.BringToFront
		End If
	End If
	
End Sub

Private Sub scoreInfoButton_Click
	playSoundClick
	If(scoreInfoLabel.Visible = False) Then
		scoreInfoLabel.Visible = True
		scoreInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While scoreInfoLabel.Alpha < 1
			scoreInfoLabel.Alpha = scoreInfoLabel.Alpha + .1
			Sleep(5)
		Loop
		scoreInfoLabel.BringToFront
		exitLabelScoreInfo.Visible = True
		exitLabelScoreInfo.BringToFront
	Else
		scoreInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While scoreInfoLabel.Alpha > 0
			scoreInfoLabel.Alpha = scoreInfoLabel.Alpha - .1
			Sleep(5)
		Loop
		scoreInfoLabel.Visible = False
		exitLabelScoreInfo.Visible = False
	End If

End Sub

Private Sub timeModeInfoButton_Click
	playSoundClick
	If(timerdescLabel.Visible = False) Then
		timerdescLabel.Visible = True
		timerdescLabel.BringToFront
		timerdescLabel.Color = Colors.ARGB(255,255,255,255)
		Do While timerdescLabel.Alpha < 1
			timerdescLabel.Alpha = timerdescLabel.Alpha + .1
			Sleep(5)
		Loop
		timerdescLabel.bringToFront
		exitTimerInfo.Visible = True
		exitTimerInfo.BringToFront
	Else
		timerdescLabel.Color = Colors.ARGB(255,255,255,255)
		Do While timerdescLabel.Alpha > 0
			timerdescLabel.Alpha = timerdescLabel.Alpha - .1
			Sleep(5)
		Loop
		timerdescLabel.Visible = False
		exitTimerInfo.Visible = False
	End If
End Sub

Private Sub achInfoButton_Click
	playSoundClick
	If(achDescLabel.Visible = False) Then
		achDescLabel.Visible = True
		achDescLabel.BringToFront
		achDescLabel.Color = Colors.ARGB(255,255,255,255)
		Do While achDescLabel.Alpha < 1
			achDescLabel.Alpha = achDescLabel.Alpha + .1
			Sleep(5)
		Loop
		achDescLabel.bringToFront
		exitAchInfo.Visible = True
		exitAchInfo.BringToFront
	Else
		achDescLabel.Color = Colors.ARGB(255,255,255,255)
		Do While achDescLabel.Alpha > 0
			achDescLabel.Alpha = achDescLabel.Alpha - .1
			Sleep(5)
		Loop
		achDescLabel.Visible = False
		exitAchInfo.Visible = False
	End If
End Sub

Private Sub practiceModeInfoButton_Click
	playSoundClick
	If(practiceModeDesc.Visible = False) Then
		practiceModeDesc.Visible = True
		practiceModeDesc.BringToFront
		practiceModeDesc.Color = Colors.ARGB(255,255,255,255)
		Do While practiceModeDesc.Alpha < 1
			practiceModeDesc.Alpha = practiceModeDesc.Alpha + .1
			Sleep(5)
		Loop
		practiceModeDesc.bringToFront
		exitPracticeDesc.Visible = True
		exitPracticeDesc.BringToFront
	Else
		practiceModeDesc.Color = Colors.ARGB(255,255,255,255)
		Do While practiceModeDesc.Alpha > 0
			practiceModeDesc.Alpha = practiceModeDesc.Alpha - .1
			Sleep(5)
		Loop
		practiceModeDesc.Visible = False
		exitPracticeDesc.Visible = False
	End If
End Sub

' ANALYTIC
Private Sub ImageView6_Click
	playSoundClick
	analyticInfoLabel.BringToFront
	If(analyticInfoLabel.Visible = False) Then
		analyticInfoLabel.Visible = True
		analyticInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While analyticInfoLabel.Alpha < 1
			analyticInfoLabel.Alpha = analyticInfoLabel.Alpha + .1
			Sleep(5)
		Loop
		analyticInfoLabel.bringToFront
		labelExitAnalytic.Visible = True
		labelExitAnalytic.BringToFront
	Else
		analyticInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While analyticInfoLabel.Alpha > 0
			analyticInfoLabel.Alpha = analyticInfoLabel.Alpha - .1
			Sleep(5)
		Loop
		analyticInfoLabel.Visible = False
		labelExitAnalytic.Visible = False
	End If
End Sub

Sub pickBuff(buff As Int)
	Select buff
		Case 0
			buffKvs.Put("1", 0)
			buffKvs.Put("3", 1)     'double coins
			buffKvs.Put("4", 1)     'doubleCorrect = 1
			buffKvs.Put("5", 1)     'skipCost = 1
			buffKvs.Put("6", 0)     'heart
			buffKvs.Put("2", 0) 'reset counter
		Case 1
			'300
			If Not(buff == buffKvs.Get("1")) Then
				If coinKvs.Get("1") >= 300 Then
					buffKvs.Put("3", 1.2)     'double coins
					buffKvs.Put("1", 1)
					coinKvs.Put("1", (coinKvs.Get("1") - 300))
					hud.ToastMessageShow("Coin Gain Increased by +20%",False)
					storeCoinLabel.Text = coinKvs.Get("1")
					doubleCoinsButton.SetBorder(2, Colors.Black, 2)
				Else
					notEnoughCoinsMsg
				End If
			End If
		Case 2
			'500
			If Not(buff == buffKvs.Get("1")) Then
				If coinKvs.Get("1") >= 500 Then
					buffKvs.Put("4", 1.1)
					buffKvs.Put("1", 2)
					coinKvs.Put("1", (coinKvs.Get("1") - 500))
					hud.ToastMessageShow("Progression Increased by +10%",False)
					storeCoinLabel.Text = coinKvs.Get("1")
					doubleCorrectButton.SetBorder(2, Colors.Black, 2)
				Else
					notEnoughCoinsMsg
				End If
			End If
		Case 3
			'300
			If Not(buff == buffKvs.Get("1")) Then
				If coinKvs.Get("1") >= 300 Then
					buffKvs.Put("5", .5)
					buffKvs.Put("1", 3)
					coinKvs.Put("1", (coinKvs.Get("1") - 300))
					hud.ToastMessageShow("50-50 is now half off",False)
					storeCoinLabel.Text = coinKvs.Get("1")
					skipReductionButton.SetBorder(2, Colors.Black, 2)
				Else
					notEnoughCoinsMsg
				End If
			End If
			
		Case 4
			'300
			Log(buff)
			Log(buffKvs.Get("1"))
			Log(buff == buffKvs.Get("1"))
			If Not(buff == buffKvs.Get("1")) Then
				If coinKvs.Get("1") >= 300 Then
					buffKvs.Put("6", 1)
					buffKvs.Put("1", 4)
					coinKvs.Put("1", (coinKvs.Get("1") - 300))
					hud.ToastMessageShow("You now have an extra life", False)
					storeCoinLabel.Text = coinKvs.Get("1")
					heartBuffButton.SetBorder(2, Colors.Black, 2)
				Else
					notEnoughCoinsMsg
				End If
			End If
	End Select
End Sub

Sub resetBuff
	coinDoubler = 1
	doubleCorrect = 1
	skipCost = 1
	buffKvs.Put("1", 0) ' reset buff choice
	buffKvs.Put("2", 0) 'reset counter
End Sub

Sub pickBuffTitle(pBuff As Int)
	Select pBuff
		Case 1
			coinDoubler = 1.2
			doubleCorrect = 1
			skipCost = 1
		Case 2
			coinDoubler = 1
			doubleCorrect = 1.1
			skipCost = 1
		Case 3
			coinDoubler = 1
			doubleCorrect = 1
			skipCost = .5
	End Select
End Sub

Private Sub buyBuffButton_Click
	playSoundClick
	If buffPanel.Visible = True Then
		buffPanel.Visible = False
		correctInfoButton.Visible = False
		buyBuffButton.xLBL.Text = "Open"
	Else
		buffPanel.Visible = True
		correctInfoButton.Visible = True
		buyBuffButton.xLBL.Text = "Close"
	End If
End Sub

Private Sub doubleCoinsButton_Click
	If buffKvs.Get("3") > 1 Then
		hud.ToastMessageShow("You already have this", False)
	Else
		playSoundClick
		pickBuff(1)
		updateStore(300)
	End If
End Sub

Private Sub doubleCorrectButton_Click
	Log (buffKvs.Get("4")  )
	If buffKvs.Get("4") > 1 Then
		hud.ToastMessageShow("You already have this", False)
	Else
		playSoundClick
		pickBuff(2)
		updateStore(500)
	End If

End Sub

Private Sub skipReductionButton_Click
	If .5 == buffKvs.Get("5") Then
		hud.ToastMessageShow("You already have this", False)
	Else
		playSoundClick
		pickBuff(3)
		updateStore(300)
	End If
End Sub

Private Sub heartBuffButton_Click
	If 1 == buffKvs.Get("6") Then
		hud.ToastMessageShow("You already have this", False)
	Else
		playSoundClick
		pickBuff(4)
		updateStore(300)
	End If
End Sub

' Displays hud message
Sub notEnoughCoinsMsg
	hud.ToastMessageShow("You don't have enough coins!", False)
	playSoundIncorrect
End Sub

Private Sub reportQuestionButton_Click
	playSoundClick
	reportPage.Initialize("Report Page")
	reportPage.RootPanel.LoadLayout("emailLayout")
	Page1.ResignFocus
	showPage(NavControl,reportPage, 3)
	playSoundClick
	reportQuestionString =  questionLabel.Text & CRLF & "Please describe the issue with this question:" & CRLF
	emailTitleLabel.Text = "Report Question"
	emailLogo.Bitmap= LoadBitmap(File.DirAssets, "warning.png")
	returnEmailField.KeyboardType = returnEmailField.TYPE_EMAIL_ADDRESS
	returnEmailField.Text = emailKvs.Get("1")
	If 1 == settingsKvs.Get("1") Then
		emailDarktheme
	Else
		emailLightTheme
	End If
	emailButtonColor
	bodyField.Text = reportQuestionString
	subjectField.Text = titleLabel.Text & " REPORT"
	wait for backButton_Click   playSoundClick
	reportPage.ResignFocus
	disableQuestionMark
	showPage(NavControl,Page1, 2)
End Sub

Public Sub showPage(NavigationControl As NavigationController,PageToShow As Page, Direction As Int)
	Dim FromDirection As String
	Select Direction
		Case 0
			FromDirection = "fromTop"
		Case 1
			FromDirection = "fromBottom"
		Case 2
			FromDirection = "fromLeft"
		Case 3
			FromDirection = "fromRight"
	End Select
	Dim no As NativeObject=Me
	no.RunMethod("trans:::",Array(NavigationControl,"moveIn",FromDirection))
	NavigationControl.ShowPage2(PageToShow,True)
End Sub


Private Sub coinsInfoLabel_Click
	playSoundClick
	coinsInfoLabel.Visible = False
	labelexitCoins.Visible = False
End Sub

Private Sub coinsInfoButton_Click
	playSoundClick
	coinsInfoLabel.BringToFront
	If(coinsInfoLabel.Visible = False) Then
		coinsInfoLabel.Visible = True
		coinsInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While coinsInfoLabel.Alpha < 1
			coinsInfoLabel.Alpha = coinsInfoLabel.Alpha + .1
			Sleep(5)
		Loop
		coinsInfoLabel.bringToFront
		labelexitCoins.Visible = True
		labelexitCoins.BringToFront
	Else
		coinsInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While coinsInfoLabel.Alpha > 0
			coinsInfoLabel.Alpha = coinsInfoLabel.Alpha - .1
			Sleep(5)
		Loop
		labelexitCoins.Visible = False
		coinsInfoLabel.Visible = False
	End If

End Sub

Private Sub noConnectionImageView_Click
	playSoundClick
	hud.ToastMessageShow("Connect to internet for leaderboard", False)
End Sub

Private Sub analyticButton_Click
	playSoundClick
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("viewStatsLayout")
	showPage(NavControl,Page1,0)
	If kvscache.ContainsKey("7") = False Then
		kvscache.Put("7", 0)
		analyticsLabel.Text = "0"
	Else
		analyticsLabel.Text = Round((kvscache.Get("1")/kvscache.Get("7"))*100) & "%"
	End If
	
	If analyticsLabel.Text < 0 Then
		analyticsLabel.Text = 0
	End If
End Sub

Private Sub hintInfoLabel_Click
	playSoundClick
	hintInfoLabel.Visible = False
	exitHintButton.Visible = False
End Sub

Private Sub hintInfoButton_Click
	playSoundClick
	If(hintInfoLabel.Visible = False) Then
		hintInfoLabel.Visible = True
		hintInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While hintInfoLabel.Alpha < 1
			hintInfoLabel.Alpha = hintInfoLabel.Alpha + .1
			Sleep(5)
		Loop
		hintInfoLabel.BringToFront
		exitHintButton.Visible = True
		exitHintButton.BringToFront
	Else
		hintInfoLabel.Color = Colors.ARGB(255,255,255,255)
		Do While hintInfoLabel.Alpha > 0
			hintInfoLabel.Alpha = hintInfoLabel.Alpha - .1
			Sleep(5)
		Loop
		hintInfoLabel.Visible = False
		exitHintButton.Visible = False
	End If
End Sub

Sub ShowLeaderboard(Page As Page, BoardId As String, viewState As Int)
	Try
		Dim PlayerScope As Int = 0 '0 = global, 1 = friends only.
		Dim TimeScope As Int = 0 '0 = Today, 1 = Week, 2 = AllTime
		Dim gc As NativeObject
		gc = gc.Initialize("GKGameCenterViewController").RunMethod("alloc", Null)
		gc.RunMethod("initWithLeaderboardID:playerScope:timeScope:", Array(BoardId , PlayerScope, TimeScope))
		gc.SetField("viewState", viewState) '0 = leadboards
		
		Dim del As NativeObject
		del = del.Initialize("B4IGameCenterViewControllerDelegate").RunMethod("new", Null)
		gc.SetField("gameCenterDelegate", del)
    
		Dim native As NativeObject = Page
		native.RunMethod("presentViewController:animated:completion:", Array(gc, True, Null))
		analytics.SendEvent("leaderboard_opened", Null)
	Catch
		catchToFirebase(LastException)
		hud.ToastMessageShow(LastException, True)
		playSoundIncorrect
	End Try
End Sub


Private Sub testLeader_Click
	playSoundClick
	Try
		ShowLeaderboard(Page1, "grp.romanleaderboard", 1)
	Catch
		Log(LastException)
	End Try
End Sub

Private Sub restorePurchasesButton_Click
	playSoundClick
	MyStore.RestoreTransactions
End Sub

Sub MyStore_TransactionsRestored (Success As Boolean)
	If Success Then
		coinsInfoButton.SetLayoutAnimated(0, 1, coinsInfoButton.Left + 10, coinsInfoButton.Top,coinsInfoButton.Width, coinsInfoButton.Height)
		hud.ToastMessageShow("Purchase Restored", False)
	Else
		hud.ToastMessageShow("Purchase Not Restored", False)
	End If
End Sub

Private Sub timedModeButton_Click
	playSoundClick
	If timedHighlight.Visible = False Then
		practiceModeHighlight.Visible = False
		hud.ToastMessageShow("Lightning Mode On", False)
		timedHighlight.Visible = True
		timedHighlight.Color = colorArray(0)
		timedHighlight.Color = colorArray(0)
		timedModeButton.Color = Colors.Yellow
		timedModeButton.SetBorder(1, Colors.Black, 2)
		settingsKvs.Put("2", 1)
		settingsKvs.Put("10", 0)
		practiceModeHighlight.Color = Colors.ARGB(255,252, 251,244)
		practiceModeButton.Color = Colors.ARGB(255,252, 251,244)
		practiceModeButton.SetBorder(0, Colors.Black, 2)
	Else
		timedHighlight.Visible = False
		hud.ToastMessageShow("Lightning Mode Off", False)
		settingsKvs.Put("2", 0)
		timedModeButton.Color = Colors.ARGB(255,252, 251,244)
		timedModeButton.SetBorder(0, Colors.Black, 2)
	End If
End Sub

Sub buffIconTitle
	If buffKvs.Get("3") > 1 Then
		buffSlot1.Bitmap = LoadBitmap(File.DirAssets, "coinico.png")
	Else
		buffSlot1.Bitmap = LoadBitmap(File.DirAssets, "add buff.png")
	End If
	If buffKvs.Get("4") > 1 Then
		buffSlot2.Bitmap = LoadBitmap(File.DirAssets, "statisticsico.png")
	Else
		buffSlot2.Bitmap = LoadBitmap(File.DirAssets, "add buff.png")
	End If
	If .5 == buffKvs.Get("5") Then
		buffSlot3.Bitmap = LoadBitmap(File.DirAssets, "saleico.png")
	Else
		buffSlot3.Bitmap = LoadBitmap(File.DirAssets, "add buff.png")
	End If

	If 1 == buffKvs.Get("6") Then
		buffSlot4.Bitmap = LoadBitmap(File.DirAssets, "heartico.png")
	Else
		buffSlot4.Bitmap = LoadBitmap(File.DirAssets, "add buff.png")
	End If
	
	If  Not(buffKvs.Get("3") > 1) And Not(buffKvs.Get("4") > 1) And Not(.5 == buffKvs.Get("5")) And Not (1 == buffKvs.Get("6")) Then
		achievementModeButton.Bitmap = LoadBitmap(File.DirAssets, "add buff.png")
		buffSlot1.Visible = False
		buffSlot2.Visible = False
		buffSlot3.Visible = False
		buffSlot4.Visible = False
		div1.Visible = False
		div2.Visible = False
		achievementModeButton.BringToFront
	Else
		achievementModeButton.Color = Colors.Transparent
		achievementModeButton.SendToBack
		buffSlot1.Visible = True
		buffSlot2.Visible = True
		buffSlot3.Visible = True
		buffSlot4.Visible = True
		div1.Visible = True
		div2.Visible = True
	End If
End Sub

Sub idolIconTitle
	Select idolKvs.Get("1")
		Case 0
			idolButton.Bitmap = LoadBitmap(File.DirAssets, "idol.png")
		Case 1
			idolButton.Bitmap = LoadBitmap(File.DirAssets, "tier1.png")
		Case 2
			idolButton.Bitmap = LoadBitmap(File.DirAssets, "tier2.png")
		Case 3
			idolButton.Bitmap = LoadBitmap(File.DirAssets, "tier3.png")
		Case 4
			idolButton.Bitmap = LoadBitmap(File.DirAssets, "tier4.png")
		Case 5
			idolButton.Bitmap = LoadBitmap(File.DirAssets, "tier5.png")
	End Select
End Sub

Private Sub achievementModeButton_Click
	playSoundClick
	storeButton_Click
End Sub

Sub loadToggleButtons
	If 1 == settingsKvs.Get("2") Then
		timedHighlight.Visible = True
		timedHighlight.Color = Colors.Yellow
		timedModeButton.Color = Colors.Yellow
		timedModeButton.SetBorder(1, Colors.Black, 2)
		practiceModeHighlight.Color = Colors.ARGB(255,252, 251,244)
		practiceModeButton.Color = Colors.ARGB(255,252, 251,244)
		practiceModeButton.SetBorder(0, Colors.Black, 2)
	Else
		timedHighlight.Visible = False
		timedHighlight.Color = colorArray(0)
		timedModeButton.Color = Colors.ARGB(255,252, 251,244)
		timedModeButton.SetBorder(0, Colors.Black, 2)
	End If
	
	If 1 == settingsKvs.Get("10") Then
		practiceModeHighlight.Visible = True
		practiceModeHighlight.Color = Colors.Yellow
		practiceModeButton.Color = Colors.Yellow
		practiceModeButton.SetBorder(1, Colors.Black, 2)
		timedHighlight.Color = Colors.ARGB(255,252, 251,244)
		timedModeButton.Color = Colors.ARGB(255,252, 251,244)
	Else
		practiceModeHighlight.Visible = False
		practiceModeHighlight.Color = Colors.White
		practiceModeButton.Color = Colors.ARGB(255,252, 251,244)
		practiceModeButton.SetBorder(0, Colors.Black, 2)
	End If
	practiceModeHighlight.Color = colorArray(0)
End Sub

Sub disableQuestionMark   'Goes through all the imageviews and
	If 1 == settingsKvs.Get("9") Then
		Try
			For i = 0 To Page1.RootPanel.NumberOfViews-1
				If  Page1.RootPanel.GetView(i) Is ImageView Then
					Log(Page1.RootPanel.GetView(i).Alpha)
					If Page1.RootPanel.GetView(i).tag = "qmark" Then
						Page1.RootPanel.GetView(i).Visible = False
					End If
				End If
			Next
		Catch
			catchToFirebase(LastException)
			Log(LastException)
		End Try
	Else
		For i = 0 To Page1.RootPanel.NumberOfViews-1
			If  Page1.RootPanel.GetView(i) Is ImageView Then
'				Log(Page1.RootPanel.GetView(i).Alpha)
				If Page1.RootPanel.GetView(i).tag = "qmark" Then
					Page1.RootPanel.GetView(i).Visible = True
				End If
			End If
		Next
	End If
End Sub

Private Sub SubmitAchievement(Identifier As String, PercentComplete As Double)
	Try
		Dim ach As NativeObject
		ach = ach.Initialize("GKAchievement").RunMethod("alloc", Null).RunMethod("initWithIdentifier:", Array(Identifier))
		ach.RunMethod("setShowsCompletionBanner:", Array(True))
		ach.SetField("percentComplete", PercentComplete)
		Wait For (Game.As(NativeObject).RunMethod("SubmitAchievement:", Array(ach))) GameCenter_AchievementSubmitted (Success As Boolean)
	Catch
		catchToFirebase(LastException)
		Log(LastException)
	End Try
End Sub

Private Sub questionMarkSwitch_ValueChanged (Value As Boolean)
	playSoundClick
	If Value = True Then
		settingsKvs.Put("9", 1)
		disableQuestionMark
	Else
		settingsKvs.Put("9", 0)
		disableQuestionMark
	End If
End Sub

Private Sub nextQuestionImage_Click
	If nextQuestionButton.UserInteractionEnabled = True Then
		playSoundClick
		nextQuestionButton_Click
	Else
		hud.ToastMessageShow("Please select an answer", False)
	End If

End Sub

Private Sub versionNumber_Click
	'playSoundClick
	DEV_COUNTER = DEV_COUNTER + 1
	If DEV_COUNTER > 6 And 0 == devKVS.Get("1") Then
		devPW.Visible = True
		DEV_COUNTER = 0
	End If
	
	If DEV_COUNTER > 6 And 1 == devKVS.Get("1") Then
		devPW.Visible = False
		devKVS.Put("1", 0)
		hud.ToastMessageShow("Developer Mode Disabled", False)
		devPW.Visible = False
		DEV_COUNTER = 0
	End If
End Sub

Sub lvlpanelInit
	Dim r As Int = Rnd(1,4)
	If r = 1 Then
		levelupgif.SetGif(File.DirAssets, "transp.gif")
	End If
	If r = 2 Then
		levelupgif.SetGif(File.DirAssets, "transp.gif")
	End If
	If r = 3 Then
		levelupgif.SetGif(File.DirAssets, "transp.gif")
	End If
	levelupBackground.Visible = True
	levelupBackground.SetAlphaAnimated(250, 1)
	levelupgif.mBase.Visible = True
	levelupBackground.Color = Colors.ARGB(80,255,255,255)
	levelupBackground.BringToFront
	levelupgif.mBase.BringToFront
End Sub

Sub levelGainedAnimation
	If 0 == settingsKvs.Get("10") Then
		levelUpPanel.Visible = True
		levelUpPanel.BringToFront
		levelCoinsAddLabel.BringToFront
		levelUpPanel.SetAlphaAnimated(300,.3)
		levelUpPanel.SetAlphaAnimated(200,.5)
		levelUpPanel.SetAlphaAnimated(500,1)
		levelUpPanel.SetShadow(Colors.DarkGray,5,5,100,False)
		playSoundLevelUp
		newLevelLabel.Visible = True
		newLevelLabel.Text = kvscache.Get("2")
		levelCoinsAddLabel.Visible = True
	End If
End Sub

Private Sub collectButton_Click
	playSoundClick
	Log(Page1.RootPanel.NumberOfViews > 30)
	levelupBackground.SetAlphaAnimated(500, 0)
	Sleep(100)
	levelupBackground.visible = False
	'questionLayout
	If levelUpPanel.Tag = "question" Then
		levelCoinsAddLabel.SetLayoutAnimated(1000, 1, topBarPanel.Left + coinCountLabel.Left, topBarPanel.Top+ coinCountLabel.Top, coinCountLabel.Width, coinCountLabel.Height)
		If 1 == settingsKvs.Get("1") Then
			questionDarkTheme
		Else
			questionLightTheme
		End If
	End If
	'titlelayout
	If levelUpPanel.Tag = "title" Then
		levelCoinsAddLabel.SetLayoutAnimated(1000, 1, coinLabel.Left, coinLabel.Top, levelCoinsAddLabel.Width, levelCoinsAddLabel.Height)
		If 1 == settingsKvs.Get("1") Then
			titleDarkTheme
		Else
			titleLightTheme
		End If
	End If
	'finish score layout
	If levelUpPanel.Tag = "finish" Then
		levelCoinsAddLabel.SetLayoutAnimated(1000, 1, tableBackPanel.Left + coinsGainedLabel.Left, tableBackPanel.Top + coinsGainedLabel.Top, levelCoinsAddLabel.Width, levelCoinsAddLabel.Height)
		If 1 == settingsKvs.Get("1") Then
			scoreDarkTheme
		Else
			scoreLightTheme
		End If
	End If
	
	Sleep(1000)
	If levelUpPanel.Tag = "question" Then
		coinCountLabel.Text = coinKvs.Get("1")
	Else
		coinsGainedLabel.Text = correctInGame + milestoneArray(kvscache.Get("2")-2)
		totalledUpCoinsLabel.Text = coinKvs.Get("1")
	End If
	levelUpPanel.SetAlphaAnimated(1000, 0)
	levelCoinsAddLabel.Visible = False
	coinLabel.Text = coinKvs.Get("1")
	levelUpPanel.SetAlphaAnimated(1000, 0)
	levelCoinsAddLabel.SetLayoutAnimated(1000, 1,160, 282, 43, 40)
	levelUpPanel.Visible = False
	levelupBackground.Color = Colors.Transparent
	levelupBackground.SendToBack
	levelupgif.mBase.Visible = False
	topBarPanel.SendToBack
	
End Sub

Private Sub shareButton_Click
	playSoundClick
	Dim avc As ActivityViewController
	avc.Initialize("avc", Array("Trivia Whip!","https://apps.apple.com/us/app/world-war-2-trivia/id6443464575"))
	avc.Show(Page1, Page1.RootPanel) 
	Wait For avc_Complete (Success As Boolean, ActivityType As String)
	Log($"Success: ${Success}, ActivityType: ${ActivityType}"$)
End Sub

Private Sub idol1_Click
	pickIdol(1)
End Sub

Private Sub idol2_Click
	pickIdol(2)
End Sub

Private Sub idol3_Click
	pickIdol(3)
End Sub

Sub checkDuplicate
	For q = 0 To questionCount
		If questionDoneMap.Get(random) == masterQuestionText_Map.Get(random) Then
			hud.ToastMessageShow("Duplicate Question!!!", False)
			newQ = False
		End If
	Next
End Sub

Sub pickIdol(Idol As Int)
	Select Idol
		Case 0
			idolKvs.Put("1", 0) 'reset counter
		Case 1
			'300
			If Not(Idol == idolKvs.Get("1")) Then
				If coinKvs.Get("1") >= 200 Then
					playSoundClick
					coinKvs.Put("1", (coinKvs.Get("1") - 200))
					hud.ToastMessageShow("1% chance of showing the correct answer",False)
					idolKvs.Put("1", 1)
					clearBorderIdol
					idol1.SetBorder(2, Colors.Black, 2)
					disableIdolView(idol1)
					updateStore(200)
				Else
					notEnoughCoinsMsg
				End If
			Else
				hud.ToastMessageShow("You already have this", False)
			End If
		Case 2
			'400
			If Not(Idol == idolKvs.Get("1")) Then
				If coinKvs.Get("1") >= 400 Then
					playSoundClick
					coinKvs.Put("1", (coinKvs.Get("1") - 400))
					hud.ToastMessageShow("2% chance of showing the correct answer",False)
					idolKvs.Put("1", 2)
					clearBorderIdol
					idol2.SetBorder(2, Colors.Black, 2)
					disableIdolView(idol2)
					updateStore(400)
				Else
					notEnoughCoinsMsg
				End If
			Else
				hud.ToastMessageShow("You already have this", False)
			End If
		Case 3
			'600
			If Not(Idol == idolKvs.Get("1")) Then
				If coinKvs.Get("1") >= 600 Then
					playSoundClick
					
					coinKvs.Put("1", (coinKvs.Get("1") - 600))
					hud.ToastMessageShow("3% chance of showing the correct answer",False)
					idolKvs.Put("1", 3)
					clearBorderIdol
					idol3.SetBorder(2, Colors.Black, 2)
					disableIdolView(idol3)
					updateStore(600)
				Else
					notEnoughCoinsMsg
				End If
			Else
				hud.ToastMessageShow("You already have this", False)
			End If
		Case 4
			'800
			If Not(Idol == idolKvs.Get("1")) Then
				If coinKvs.Get("1") >= 800 Then
					playSoundClick
					coinKvs.Put("1", (coinKvs.Get("1") - 800))
					hud.ToastMessageShow("4% chance of showing the correct answer",False)
					idolKvs.Put("1", 4)
					clearBorderIdol
					idol4.SetBorder(2, Colors.Black, 2)
					disableIdolView(idol4)
					updateStore(800)
				Else
					notEnoughCoinsMsg
				End If
			Else
				hud.ToastMessageShow("You already have this", False)
			End If
		Case 5
			'1000
			If Not(Idol == idolKvs.Get("1")) Then
				If coinKvs.Get("1") >= 1000 Then
					playSoundClick
					coinKvs.Put("1", (coinKvs.Get("1") - 1000))
					hud.ToastMessageShow("5% chance of showing the correct answer",False)
					idolKvs.Put("1", 5)
					clearBorderIdol
					idol5.SetBorder(2, Colors.Black, 2)
					disableIdolView(idol5)
					updateStore(1000)
					playSoundCorrect
				Else
					notEnoughCoinsMsg
				End If
			End If
	End Select
End Sub

Sub IdolComputation(idolChoice As Int)
	Dim num As Long = Rnd(0, 100)
	Log(num)
	Select idolChoice
		Case 0
			idolFlag = False
		Case 1
			If num < 11 Then
				idolFlag = True
				playSoundIdol
				questionIdol.Bitmap = LoadBitmap(File.DirAssets, "tier1.png")
				questionIdol.BringToFront
				questionIdol.Top = aLabel.mBase.Top + 10
				hud.ToastMessageShow("1% Ornament Activated!", False)
			End If
		Case 2
			If num = 12 Or num = 13 Then
				playSoundIdol
				idolFlag = True
				questionIdol.BringToFront
				questionIdol.Top = aLabel.mBase.Top + 10
				questionIdol.Bitmap = LoadBitmap(File.DirAssets, "tier2.png")
				hud.ToastMessageShow("2% Ornament Activated!", False)
			End If
		Case 3
			If num = 14 Or num = 15 Or num = 16 Then
				playSoundIdol
				idolFlag = True
				questionIdol.BringToFront
				questionIdol.Top = aLabel.mBase.Top + 10
				questionIdol.Bitmap = LoadBitmap(File.DirAssets, "tier3.png")
				hud.ToastMessageShow("3% Ornament Activated!", False)
			End If
		Case 4
			If num = 17 Or num = 18 Or num = 19 Or num = 20 Then
				playSoundIdol
				idolFlag = True
				questionIdol.BringToFront
				questionIdol.Top = aLabel.mBase.Top + 10
				questionIdol.Bitmap = LoadBitmap(File.DirAssets, "tier4.png")
				hud.ToastMessageShow("4% Ornament Activated!", False)
			End If
		Case 5
			If num = 21 Or num = 22 Or num = 23 Or num = 24 Or num = 25 Then
				playSoundIdol
				idolFlag = True
				questionIdol.BringToFront
				questionIdol.Top = aLabel.mBase.Top + 10
				questionIdol.Bitmap = LoadBitmap(File.DirAssets, "tier5.png")
				hud.ToastMessageShow("5% Ornament Activated!", False)
			End If
	End Select
End Sub

Private Sub idolButton_Click
	playSoundClick
	storeButton_Click
End Sub

Private Sub devPW_EnterPressed
	If devPW.Text = "buggy123" Then
		devKVS.Put("1", 1)
		'coinKvs.Put("1", 2000)
		hud.ToastMessageShow("Developer Mode Enabled", False)
		DEV_COUNTER = 0
	End If
	If devPW.Text = "534" Then
		kvscache.Put("1", 534)
		hud.ToastMessageShow("534", False)
		DEV_COUNTER = 0
	End If
	If devPW.Text = "2000" Then
		coinKvs.Put("1", 2000)
		hud.ToastMessageShow("coins", False)
		DEV_COUNTER = 0
	End If
	If devPW.Text = "10000" Then
		coinKvs.Put("1", 10000)
		hud.ToastMessageShow("coins", False)
		DEV_COUNTER = 0
	End If
	If devPW.Text = "1$" Then
		settingsKvs.Put("4", 1)
		hud.ToastMessageShow("length 1", False)
		DEV_COUNTER = 0
	End If
	
	If devPW.Text = "helpme" Then
		hud.ToastMessageShow("dev mode: buggy123", True)
		Sleep(3000)
		hud.ToastMessageShow("coins: 2000", True)
		Sleep(3000)
		hud.ToastMessageShow("coins: 10000", True)
		Sleep(3000)
		hud.ToastMessageShow("length is 1: 1$ ", True)
		DEV_COUNTER = 0
	End If
End Sub

Private Sub aPanel_Click
	If aLabel.Enabled = False Then
		nextQuestionButton_Click
		aPanel.Visible = False
	End If
End Sub

Private Sub idol4_Click
	pickIdol(4)
End Sub

Private Sub idol5_Click
	pickIdol(5)
End Sub

Private Sub check1_Click
	storeAlreadyEnabled
End Sub

Private Sub check2_Click
	storeAlreadyEnabled
End Sub
 
Private Sub check3_Click
	storeAlreadyEnabled
End Sub

Private Sub check4_Click
	storeAlreadyEnabled
End Sub

Private Sub check5_Click
	storeAlreadyEnabled
End Sub

Sub storeAlreadyEnabled
	hud.ToastMessageShow("You already have this", False)
End Sub

Private Sub idolPanel_Click
	If 5 == idolKvs.Get("1") Then
		playSoundClick
		hud.ToastMessageShow("You already have all the Ornaments!", False)
	End If
End Sub

Private Sub titleUsername_Click
	gameViewButton_Click
End Sub

Private Sub sendEmailPanel_Click
	sendEmailButton_Click
End Sub

Private Sub devSitePanel_Click
	developerSiteButton_Click
End Sub

Private Sub resetScorePanel_Click
	resetScoreButton_Click
End Sub

Private Sub leaveReviewPanel_Click
	leaveReviewButton_Click
End Sub

Private Sub shareAppPanel_Click
	shareButton_Click
End Sub

Private Sub restorePurchPanel_Click
	restorePurchasesButton_Click
End Sub

Private Sub resetScoreInfoLabel_Click
	playSoundClick
	resetScoreInfoLabel.Visible = False
	exitResetInfoLabel.Visible = False
End Sub

Private Sub resetScoreInfoButton_Click
	playSoundClick
	If resetScoreInfoLabel.Visible = False Then
		resetScoreInfoLabel.Visible = True
		exitResetInfoLabel.Visible = True
	Else
		resetScoreInfoLabel.Visible = False
		exitResetInfoLabel.Visible = False
	End If
End Sub


Private Sub restorePurchInfoLabel_Click
	playSoundClick
	restorePurchInfoLabel.Visible = False
	exitRestorePurch.Visible = False
End Sub

Private Sub restorePurchInfoButton_Click
	playSoundClick
	If restorePurchInfoLabel.Visible = False Then
		restorePurchInfoLabel.Visible = True
		exitRestorePurch.Visible = True
	Else
		restorePurchInfoLabel.Visible = False
		exitRestorePurch.Visible = False
	End If
End Sub

Private Sub closeSplash_Click
	videoComplete
	NavControl.RemoveCurrentPage
End Sub

Private Sub skipImage_Click
	hud.ToastMessageShow("You've already used 50:50", False)
End Sub

Private Sub practiceModeButton_Click
	playSoundClick
	ShakeView(practiceModeButton, 500)
	If practiceModeHighlight.Visible = False Then
		timedHighlight.Visible = False
		practiceModeHighlight.Visible = True
		practiceModeHighlight.Color = colorArray(0)
		practiceModeHighlight.Color = colorArray(0)
		practiceModeButton.Color = Colors.Yellow
		practiceModeButton.SetBorder(1, Colors.Black, 2)
		timedModeButton.SetBorder(0, Colors.Black, 2)
		settingsKvs.Put("10", 1)
		settingsKvs.Put("2", 0)
		timedHighlight.Color = Colors.ARGB(255,252, 251,244)
		timedModeButton.Color = Colors.ARGB(255,252, 251,244)
		timedModeButton.SetBorder(0, Colors.Black, 2)
		hud.ToastMessageShow("Practice On", False)
	Else
		hud.ToastMessageShow("Practice Off", False)
		practiceModeHighlight.Visible = False
		settingsKvs.Put("10", 0)
		practiceModeButton.Color = Colors.ARGB(255,252, 251,244)
		practiceModeButton.SetBorder(0, Colors.Black, 2)
		practiceModeHighlight.Color = colorArray(0)
	End If
End Sub

Private Sub practiceModeDesc_Click
	playSoundClick
	practiceModeDesc.Visible = False
	exitPracticeDesc.Visible = False
End Sub

Private Sub playBulbyAnimation
	Dim r As Int = Rnd(1,4)
	If r = 1 Then
		endGifView.SetGif(File.DirAssets, "transp.gif")
	End If
	If r = 2 Then
		endGifView.SetGif(File.DirAssets, "transp.gif")
	End If
	If r = 3 Then
		endGifView.SetGif(File.DirAssets, "transp.gif")
	End If
End Sub

Sub ratioKvsInit
	' ADD TRIVIA ****
	If ratioKvs.ContainsKey("1") == False Then
		'SCIENCE
		ratioKvs.Put("Biology", 3)
		ratioKvs.put("Chemistry", 3)
		ratioKvs.put("Physics", 3)
		'HISTORY
		ratioKvs.put("World", 3)
		ratioKvs.put("US", 3)
		ratioKvs.put("Roman Empire", 3)
		ratioKvs.put("Ancient Egypt", 3)
		'CULTURE
		ratioKvs.put("Movies", 3)
		ratioKvs.put("TV", 3)
		ratioKvs.put("Fashion", 3)
		ratioKvs.put("Nineties Culture", 3)
		'MUSIC
		ratioKvs.put("Rock", 3)
		ratioKvs.put("Eighties", 3)
		ratioKvs.put("Nineties Music", 3)
		ratioKvs.put("Beatles", 3)
		'SPORTS
		ratioKvs.put("Basketball", 3)
		'RELIGION
		ratioKvs.put("Islam", 3)
		'Vehicle
		
	End If
End Sub

Sub subCatKvsInit
	' ADD TRIVIA
	'Sub category KVS setup
	Dim catBool As Boolean = False
	For i = 0 To subCatList.Size - 1
	If subCatKvs.ContainsKey("Biology") ==  False And subCatKvs.ContainsKey("Christmas")  == False  And subCatKvs.ContainsKey("Reality TV") == False And subCatKvs.ContainsKey("Anatomy") == False Then 'And subCatKvs.ContainsKey("Tutorial")  == False
			catBool = True
		End If
	Next

	If catBool Then
		'SCIENCE
		subCatKvs.Put("Biology", True)
		subCatKvs.put("Chemistry", True)
		subCatKvs.put("Physics", True)
		subCatKvs.put("Anatomy", True)
		'HISTORY
		subCatKvs.put("World", True)
		subCatKvs.put("US", True)
		subCatKvs.put("Roman Empire", True)
		subCatKvs.put("Ancient Egypt", True)
		subCatKvs.put("Revolutionary War", True)
		subCatKvs.Put("Crime History", True)
		'CULTURE
		subCatKvs.put("Movies", True)
		subCatKvs.put("TV", True)
		subCatKvs.put("Fashion", True)
		subCatKvs.put("Nineties Culture", True)
		subCatKvs.put("Reality TV", False)
		'MUSIC
		subCatKvs.put("Rock", True)
		subCatKvs.put("Eighties", True)
		subCatKvs.put("Nineties Music", True)
		subCatKvs.put("Beatles", True)
		'SPORTS
		subCatKvs.put("Basketball", True)
		subCatKvs.put("Golf", False)
		subCatKvs.put("Baseball", True)
		'Religion
		subCatKvs.put("Islam", False)
		subCatKvs.put("Bible", False)
		'Vehicle
		subCatKvs.Put("Car Mechanic", False)
		subCatKvs.Put("CDL", False)
		subCatKvs.Put("Sailing", False)
		'Tech
		subCatKvs.Put("Windows OS", False)
		'Geography
		subCatKvs.Put("US Geography", True)
		subCatKvs.Put("World Geography", True)
		'Humanities
		subCatKvs.Put("Literature", False)
		subCatKvs.Put("Philosophy", False)
		'Holidays
		subCatKvs.Put("Christmas", False)
		'subCatKvs.Put("Tutorial", False)
		'
	End If
'	else if catKvs.Get(0) == Null Then
'		'SCIENCE
'		subCatKvs.Put("Biology", True)
'		subCatKvs.put("Chemistry", True)
'		subCatKvs.put("Physics", True)
'		'HISTORY
'		subCatKvs.put("World", True)
'		subCatKvs.put("US", True)
'		subCatKvs.put("Roman Empire", True)
'		subCatKvs.put("Ancient Egypt", True)
'		'CULTURE
'		subCatKvs.put("Movies", True)
'		subCatKvs.put("TV", True)
'		subCatKvs.put("Fashion", True)
'		subCatKvs.put("Nineties Culture", True)
'		'MUSIC
'		subCatKvs.put("Rock", True)
'		subCatKvs.put("Eighties", True)
'		subCatKvs.put("Nineties Music", True)
'		subCatKvs.put("Beatles", True)
'		'SPORTS
'		subCatKvs.put("Basketball", True)
'		subCatKvs.put("Golf", True)
'		'Religion
'		subCatKvs.put("Islam", False)
'		subCatKvs.put("Bible", False)
'		'vehicle
'		subCatKvs.Put("Car Mechanic", False)
'		subCatKvs.Put("CDL", False)
'		'Tech
'		subCatKvs.Put("Windows OS", False)
'	End If
End Sub

Sub catKvsInit
	' ADD TRIVIA
	' Main category Kvs Setup
	Dim catBool As Boolean = False
	
	If catKvs.ContainsKey("Science") ==  False And catKvs.ContainsKey("History") ==  False And catKvs.ContainsKey("Culture") ==  False And catKvs.ContainsKey("Music") ==  False And catKvs.ContainsKey("Sports") ==  False And catKvs.ContainsKey("Religion") ==  False And catKvs.ContainsKey("Vehicle") ==  False And catKvs.ContainsKey("Technology") ==  False And catKvs.ContainsKey("Geography") ==  False And catKvs.ContainsKey("Humanities") ==  False And catKvs.ContainsKey("Holidays") ==  False Then
			catBool = True
		End If
	If catBool Then
		catKvs.Put("Science", True) 'Science
		catKvs.Put("History", True) 'History
		catKvs.Put("Culture", True) 'Culture
		catKvs.Put("Music", True) 'Music
		catKvs.Put("Sports", True) 'Sports
		catKvs.Put("Religion", False) 'Religion
		catKvs.Put("Vehicle", False) 'Vehicle
		catKvs.Put("Technology", False) 'Technology
		catKvs.Put("Geography", True) 'Technology
		catKvs.Put("Humanities", False) 'Technology
		catKvs.Put("Holidays", False) 'Technology
'	else if catKvs.Get(0) == Null Then
'		catKvs.Put("Science", True) 'Science
'		catKvs.Put("History", True) 'History
'		catKvs.Put("Culture", True) 'Culture
'		catKvs.Put("Music", True) 'Music
'		catKvs.Put("Sports", True) 'Sports
'		catKvs.Put("Religion", False) 'Religion
'		catKvs.Put("Vehicle", False) 'Vehicle
'		catKvs.Put("Technology", False) 'Tech
	End If
End Sub

Sub getAlphaCLV
	getCLVTheme(checked, unchecked)
	Dim alphaSubCatList As List
	alphaSubCatList.Initialize
	alphaSubCatList.AddAll(subCatList)
	alphaSubCatList.Sort(True)
	
	catNameLegendLabel.Visible = False
	Sleep(0)
	nameLabel.Left = 68dip
	Sleep(0)
	For i = 0 To alphaSubCatList.Size -1
		Dim p As B4XView = xui.CreatePanel("")
		p.SetLayoutAnimated(0, 0, 0, categoryListView.AsView.Width, 50dip)
		Dim catLabel As Label
		Dim chkAlpha As ImageView
		Dim alphaClickPanel As Panel
		Dim catImageView As ImageView
		catImageView.Initialize("catImageView")
		alphaClickPanel.Initialize("alphaClickPanel")
		
		'getBannerAd
		chkAlpha.Initialize("chkAlpha")
		catLabel.Initialize("catLabel")
		'alphaClickPanel.SetBorder(1, Colors.Black, 3)
		alphaClickPanel.color = Colors.Transparent
		alphaClickPanel.BringToFront		
		Sleep(0)
		catLabel.Text = alphaSubCatList.Get(i)
		
		catImageView.bitmap = subCatImages.get(i)
		catLabel.Font = Font.CreateNew(24)
		catLabel.AdjustFontSizeToFit = True
		If subCatKvs.Get(alphaSubCatList.Get(i)) == True Then
			chkAlpha.Bitmap = checked
		Else
			chkAlpha.Bitmap = unchecked
		End If
		'alphaClickPanel.SetBorder(1, Colors.Black, 3)
		'dropDownalphaClickPanel.SetBorder(1, Colors.Black, 3)
		catLabel.Tag = catLabel.Text
		'catLabel.SetBorder(1, Colors.Black, 3)
		'chkAlpha.UserInteractionEnabled = false
		alphaClickPanel.BringToFront
		catImageView.BringToFront
		p.AddView(catLabel, 90dip, 10dip, categoryListView.AsView.Width - 160dip, 30dip)
		p.AddView(chkAlpha, categoryListView.AsView.Width - 60dip, 10dip, 30dip, 30dip)
		p.AddView(alphaClickPanel, 0, 0, Page1.RootPanel.Width - catLabel.Left, 70dip)
		p.AddView(catImageView, 20dip, 4dip, 45dip, 45dip)
		categoryListView.Add(p, i)
		'alphaClickPanel.BringToFront
	Next
	Sleep(0)
	clvCheckedLegendLabel.Left = chkAlpha.Left - 32dip
	colorizeListView(subCatList)
	checkSubCats
End Sub

Sub catImageView_Click
	Dim index As Int = categoryListView.GetItemFromView(Sender)
	ShakeView(categoryListView.GetPanel(index).GetView(4), 1000)
End Sub

Sub alphaClickPanel_Click
	chkAlpha_Click
	
End Sub

Sub checkSubCats
	' ADD TRIVIA
	' put at the ends of CLV methods maybe
	If toggleAlphaKvs.Get("1") == False And backButtonBool = False Then
		Dim alphaSubCatList As List
		alphaSubCatList.Initialize
		alphaSubCatList.AddAll(subCatList)
		alphaSubCatList.Sort(True)
		
		Dim subCatListScienceSort As List 
		subCatListScienceSort.Initialize
		subCatListScienceSort.AddAll(subCatListScience)
		subCatListScienceSort.Sort(True)
		Dim subCatListHistorySort As List
		subCatListHistorySort.Initialize
		subCatListHistorySort.AddAll(subCatListHistory)
		subCatListHistorySort.Sort(True)
		Dim subCatListCultureSort As List
		subCatListCultureSort.Initialize
		subCatListCultureSort.AddAll(subCatListCulture)
		subCatListCultureSort.Sort(True)
		Dim subCatListMusicSort As List
		subCatListMusicSort.Initialize
		subCatListMusicSort.AddAll(subCatListMusic)
		subCatListMusicSort.Sort(True)
		Dim subCatListSportsSort As List
		subCatListSportsSort.Initialize
		subCatListSportsSort.AddAll(subCatListSports)
		subCatListSportsSort.Sort(True)
		Dim subCatListReligionSort As List
		subCatListReligionSort.Initialize
		subCatListReligionSort.AddAll(subCatListReligion)
		subCatListReligionSort.Sort(True)
		Dim subCatListVehicleSort As List
		subCatListVehicleSort.Initialize
		subCatListVehicleSort.AddAll(subCatListVehicle)
		subCatListVehicleSort.Sort(True)
		Dim subCatListTechSort As List
		subCatListTechSort.Initialize
		subCatListTechSort.AddAll(subCatListTech)
		subCatListTechSort.Sort(True)
		Dim subCatListGeographySort As List
		subCatListGeographySort.Initialize
		subCatListGeographySort.AddAll(subCatListGeography)
		subCatListGeographySort.Sort(True)
		Dim subCatListHumanitiesSort As List
		subCatListHumanitiesSort.Initialize
		subCatListHumanitiesSort.AddAll(subCatListHumanities)
		subCatListHumanitiesSort.Sort(True)
		Dim subCatListHolidaysSort As List
		subCatListHolidaysSort.Initialize
		subCatListHolidaysSort.AddAll(subCatListHolidays)
		subCatListHolidaysSort.Sort(True)
		getSubCatsCount(subCatListScienceSort, 0)
		getSubCatsCount(subCatListHistorySort, 1)
		getSubCatsCount(subCatListCultureSort, 2)
		getSubCatsCount(subCatListMusicSort, 3)
		getSubCatsCount(subCatListSportsSort, 4)
		getSubCatsCount(subCatListReligionSort, 5)
		getSubCatsCount(subCatListVehicleSort, 6)
		getSubCatsCount(subCatListTechSort, 7)
		getSubCatsCount(subCatListGeographySort, 8)
		getSubCatsCount(subCatListHumanitiesSort, 9)
		getSubCatsCount(subCatListHolidaysSort, 10)
		'get alpha
		Else
		'get CLV
		getSubCatsCount(subCatListScience, 0)
		getSubCatsCount(subCatListHistory, 1)
		getSubCatsCount(subCatListCulture, 2)
		getSubCatsCount(subCatListMusic, 3)
		getSubCatsCount(subCatListSports, 4)
		getSubCatsCount(subCatListReligion, 5)
		getSubCatsCount(subCatListVehicle, 6)
		getSubCatsCount(subCatListTech, 7)
		getSubCatsCount(subCatListGeography, 8)
		getSubCatsCount(subCatListHumanities, 9)
		getSubCatsCount(subCatListHolidays, 10)
	End If
End Sub

Sub getSubCatsCount(subList As List, view As Int)
	Dim Count As Int = 0
	For i = 0 To subList.Size - 1
		If subCatKvs.Get(subList.Get(i)) Then
			Count = Count + 1
			Log(subList.Get(i) & ": " & subCatKvs.Get(subList.Get(i)))
		End If
		If Count == 0 Then
			catKvs.Put(catList.Get(view), False)
			Log(catList.Get(view) & ": " & False)
		Else
			catKvs.Put(catList.Get(view), True)
			Log(catList.Get(view) & ": " & True)
		End If
	Next
End Sub

Sub chkAlpha_Click
	playSoundClick
	
	Dim isChecked As Boolean = False
	Dim index As Int = categoryListView.GetItemFromView(Sender)
	
	Log(index)
	If categoryListView.GetPanel(index).GetView(1).GetBitmap = unchecked Then
		categoryListView.GetPanel(index).GetView(1).SetBitmap(checked)
		isChecked = True
		subCatKvs.Put(categoryListView.GetPanel(index).GetView(0).Text, True)
		Log(categoryListView.GetPanel(index).GetView(0).Text & ": " & subCatKvs.Get(categoryListView.GetPanel(index).GetView(0).Text))
		playSoundClick
		analytics.SendEvent("user_action_checked", Null)
	Else
		categoryListView.GetPanel(index).GetView(1).SetBitmap(unchecked)
		isChecked  = False
		subCatKvs.Put(categoryListView.GetPanel(index).GetView(0).Text, False)
		Log(categoryListView.GetPanel(index).GetView(0).Text & ": " & subCatKvs.Get(categoryListView.GetPanel(index).GetView(0).Text))
		analytics.SendEvent("user_action_unchecked", Null)
	End If
	checkSubCats
End Sub

Sub getCLV
	Sleep(0)
	catNameLegendLabel.Visible = True
	nameLabel.Left = 50dip
	getCLVTheme(checked, unchecked)
	For i = 0 To catList.Size -1
		Dim p As B4XView = xui.CreatePanel("")
		p.SetLayoutAnimated(0, 0, 0, categoryListView.AsView.Width, 70dip)
		Dim catLabel As Label
		Dim chk As ImageView
		Dim dropDownArrow As ImageView
		Dim mainCatImageView As ImageView
		mainCatImageView.Initialize("mainCatImageView")
		
		Dim clickpanel As Panel
		Dim dropDownClickPanel As Panel
		clickpanel.Initialize("clickPanel")
		dropDownClickPanel.Initialize("dropDownClickPanel")
		dropDownArrow.Initialize("dropDownArrow")
		'getBannerAd
		dropDownArrow.Bitmap = LoadBitmap(File.DirAssets, "down-arrow.png")
		mainCatImageView.bitmap = mainCatImages.get(i)
		chk.Initialize("chk")
		catLabel.Initialize("catLabel")
		'clickpanel.SetBorder(1, Colors.Black, 3)
		clickpanel.color = Colors.Transparent
		clickpanel.BringToFront
		dropDownClickPanel.color = Colors.Transparent
		dropDownClickPanel.BringToFront
		dropDownArrow.BringToFront
		
		Sleep(0)
		catLabel.Text = catList.Get(i)
		catLabel.Font = Font.CreateNew(25)
		catLabel.AdjustFontSizeToFit = True
		If catKvs.Get(catList.Get(i)) == True Then
			chk.Bitmap = checked
		Else
			chk.Bitmap = unchecked
		End If
		Log(catList.Get(i) & "& : " & catKvs.Get(catList.Get(i)))
		dropDownClickPanel.BringToFront
		'clickpanel.SetBorder(1, Colors.Black, 3)
		'dropDownClickPanel.SetBorder(1, Colors.Black, 3)
		dropDownArrow.BringToFront
		catLabel.Tag = catLabel.Text
		p.AddView(catLabel, 100dip, 20dip, 140dip, 30dip)
		p.AddView(chk, categoryListView.AsView.Width - 70dip, 15dip, 40dip, 40dip)
		p.AddView(clickpanel, catLabel.Left + catLabel.Width + 50dip, 0, Page1.RootPanel.Width - catLabel.Left, 70dip)
		p.AddView(dropDownArrow, catLabel.Left + catLabel.Width, 20dip, 30dip, 30dip)
		p.addview(dropDownClickPanel, 0, 0, clickpanel.Left, 70dip)
		p.AddView(mainCatImageView, 20dip, 5dip, 55dip, 55dip)
		'getalpha
		dropDownArrow.BringToFront
		categoryListView.Add(p, i)
	Next
	clvCheckedLegendLabel.Left = chk.Left - 32dip
	colorizeListView(catList)
	checkSubCats
End Sub

Sub getCLVTheme(b As Bitmap, d As Bitmap)
	If 1==settingsKvs.Get("1") Then
		b.Initialize(File.DirAssets, "checked-white.png")
		d.Initialize(File.DirAssets, "unchecked-white.png")
		Else
		b.Initialize(File.DirAssets, "checkbox.png")
		d.Initialize(File.DirAssets, "unchecked.png")
	End If
End Sub

Sub colorizeListView(mtnList As List)
	Try
		Sleep(5)
		For i = 0 To mtnList.Size - 1
			Dim colorizePanel As B4XView = categoryListView.GetPanel(i)
			If 1 == settingsKvs.Get("1") Then
				categoryListView.sv.ScrollViewInnerPanel.Color = Colors.White
				colorizePanel.Color = Colors.DarkGray
				colorizePanel.getview(0).TextColor = Colors.White
			Else
				categoryListView.sv.ScrollViewInnerPanel.Color = Colors.DarkGray
				colorizePanel.Color = Colors.White
				colorizePanel.getview(0).TextColor = Colors.Black
			End If
		Next
	Catch
		catchToFirebase(LastException)
		Log(LastException)
	End Try
End Sub

Sub categoryDarkTheme
	Page1.RootPanel.Color = Colors.DarkGray
	catTitleLabel.TextColor = Colors.White
	catNameLegendLabel.TextColor = Colors.White
	clvCheckedLegendLabel.TextColor = Colors.White
	
End Sub

Sub categoryLightTheme
	Page1.RootPanel.Color = Colors.ARGB(255, 252,251,244)
	catTitleLabel.TextColor = Colors.Black
	catNameLegendLabel.TextColor = Colors.Black
	clvCheckedLegendLabel.TextColor = Colors.Black
End Sub


Private Sub categoryListView_ItemClick (Index As Int, Value As Object)
	Log("global: " & Index)
	Try
	Catch
		catchToFirebase(LastException)
		Log(LastException)
	End Try
End Sub

Sub dropDownClickPanel_Click
	dropDownArrow_Click
End Sub


Sub dropDownArrow_Click
	' ADD TRIVIA
	playSoundClick
	dropdowncount = 0
	Dim index As Int = categoryListView.GetItemFromView(Sender)
		If Not(globalindex2 = index) Then
			For i = 0 To index
				For d = 0 To subCatList.Size - 1
					If subCatList.Get(d) == categoryListView.GetPanel(i).GetView(0).Text Then
						dropdowncount = dropdowncount + 1
					End If
				Next
			Next
		End If
	globalindex2 = categoryListView.GetItemFromView(Sender)
	Dim index As Int = globalindex2 - dropdowncount
	
	'Dim globalindex2 As Int = globalindex2 '- dropdowncount
	Log("global index: " & globalindex2)
	Log("index: " & index)	
	getindex(index)
End Sub

Sub getindex(index As Int)
	Select index
		Case 0 'science
			getDropDownScience(globalindex2, subCatListScience)
		Case 1
			getDropDownHistory(globalindex2, subCatListHistory)
		Case 2
			getDropDownCulture(globalindex2, subCatListCulture)
		Case 3
			getDropDownMusic(globalindex2, subCatListMusic)
		Case 4
			getDropDownSports(globalindex2, subCatListSports)
		Case 5
			getDropDownReligion(globalindex2, subCatListReligion)
		Case 6
			getDropDownVehicle(globalindex2, subCatListVehicle)
		Case 7
			getDropDownTech(globalindex2, subCatListTech)
		Case 8
			getDropDownGeography(globalindex2, subCatListGeography)
		Case 9
			getDropDownHumanities(globalindex2, subCatListHumanities)
		Case 10
			getDropDownHolidays(globalindex2, subCatListHolidays)
			
	End Select
End Sub

Sub getDropDownScience(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub


Sub getDropDownHistory(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Log("index: " & index)
	Log("dropdowncount " & dropdowncount)
	'If index = 1 + dropdowncount Then
		' science selected
		Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
		If isDroppedDown Then
			Log(dropdowncount)
			Log(index)
			
		Dim removeIndex As Int = index + 1
			For i = 1 To ScienceSize
				
				Log(i)
				categoryListView.GetPanel(removeIndex).RemoveViewFromParent
				categoryListView.RemoveAt(removeIndex)
				'dropdowncount = dropdowncount-1
			Next
		Else
			' if not dropped down
			generateSubPanel(ddList, index)
		End If
End Sub

Sub getDropDownCulture(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownMusic(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Log("Music Dropping Down")
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownSports(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownReligion(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownVehicle(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownTech(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownGeography(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownHumanities(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownHolidays(index As Int, ddList As List)
	' get dropdown status
	Sleep(0)
	Dim const ScienceSize As Int = ddList.Size
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		Dim removeIndex As Int = index + 1
		For i = 1 To ScienceSize
			categoryListView.GetPanel(removeIndex).RemoveViewFromParent
			categoryListView.RemoveAt(removeIndex)
			'dropdowncount = dropdowncount-1
		Next
	Else
		' if not dropped down
		generateSubPanel(ddList, index)
	End If
End Sub

Sub getDropDownStatus(ddList As List)
	For i = 0 To categoryListView.Size-1
'		Log(ddList.Get(0))
'		Log(categoryListView.GetPanel(i).GetView(0).Text)
		If categoryListView.GetPanel(i).GetView(0).Text == ddList.Get(0) Then
			Log("Yes, dropped down")
			Return True
		End If
	Next
	Log("No, not dropped down")
	Return False
End Sub

Sub generateSubPanel(ddList As List, index As Int)
	categoryListView.GetPanel(index).GetView(5).Visible = False
	For i = 0 To ddList.Size-1
		Log(ddList.Get(i))
		Log("gen index: " & index)
		Dim p As B4XView = xui.CreatePanel("")
		p.SetLayoutAnimated(0, 0, 0, categoryListView.AsView.Width, 50dip)
		Dim catLabel As Label
		Dim chk As ImageView
		Dim dropDownArrow As ImageView
		Dim subClickPanel As Panel
		Dim dropDownsubClickPanel As Panel
		Dim subCatImgViewSubPanel As ImageView
		subCatImgViewSubPanel.Initialize("subCatImgViewSubPanel")
		
		subClickPanel.Initialize("subClickPanel")
		dropDownsubClickPanel.Initialize("dropDownsubClickPanel")
		dropDownArrow.Initialize("dropDownArrow")
		dropDownArrow.Bitmap = LoadBitmap(File.DirAssets, "down-arrow.png")
		chk.Initialize("chk")
		catLabel.Initialize("catLabel")
		'subClickPanel.SetBorder(1, Colors.Black, 3)
		subClickPanel.color = Colors.Transparent
		subClickPanel.BringToFront
		dropDownsubClickPanel.color = Colors.Transparent
		dropDownsubClickPanel.BringToFront
		dropDownArrow.BringToFront
		
		Sleep(0)
		catLabel.Text = ddList.Get(i)
		subCatImgViewSubPanel.Bitmap = getDropDownImages(catLabel.Text)
		catLabel.Font = Font.CreateNew(14)
		catLabel.AdjustFontSizeToFit = True
		If subCatKvs.Get(ddList.Get(i)) == True Then
			chk.Bitmap = checked
		Else
			chk.Bitmap = unchecked
		End If
		
		
		'subClickPanel.SetBorder(1, Colors.Black, 3)
		'dropDownsubClickPanel.SetBorder(1, Colors.Black, 3)
		dropDownArrow.BringToFront
		catLabel.Tag = catLabel.Text
		p.AddView(catLabel, 110dip, 10dip, 140dip, 30dip)
		p.AddView(chk, categoryListView.AsView.Width - 65dip, 10dip, 30dip, 30dip)
		p.AddView(subClickPanel, catLabel.Left + catLabel.Width + 50dip, 0, Page1.RootPanel.Width - catLabel.Left, 50dip)
		'p.addview(dropDownsubClickPanel, 0, 0, subClickPanel.Left, 70dip)
		p.AddView(subCatImgViewSubPanel, 25dip, 4dip, 45dip, 45dip)
		dropDownArrow.BringToFront
		dropDownTheme(p)
		categoryListView.InsertAt(index + 1, p, i)
		dropdowncount = dropdowncount + 1
	Next
	Log("end drop down: " & dropdowncount)
End Sub

Sub getDropDownImages(subCat As String) As Bitmap
	Dim alphaSubCatList As List
	alphaSubCatList.Initialize
	alphaSubCatList.AddAll(subCatList)
	alphaSubCatList.Sort(True)
	Dim b As Bitmap
	
	For i = 0 To alphaSubCatList.Size - 1
		If alphaSubCatList.Get(i) == subCat Then
			b = subCatImages.get(i)
			Return b
		End If
	Next
	Return b
End Sub

Sub dropDownTheme(colorizePanel As B4XView)
	If 1 == settingsKvs.Get("1") Then
		categoryListView.sv.ScrollViewInnerPanel.Color = Colors.White
		colorizePanel.Color = Colors.DarkGray
		colorizePanel.getview(0).TextColor = Colors.White
	Else
		categoryListView.sv.ScrollViewInnerPanel.Color = Colors.DarkGray
		colorizePanel.Color = Colors.White
		colorizePanel.getview(0).TextColor = Colors.Black
	End If
End Sub

Sub subClickPanel_Click
	playSoundClick
	Dim isChecked As Boolean = False
	Dim index As Int = categoryListView.GetItemFromView(Sender)
	If categoryListView.GetPanel(index).GetView(1).GetBitmap = unchecked Then
		categoryListView.GetPanel(index).GetView(1).SetBitmap(checked)
		isChecked = True
		subCatKvs.Put(categoryListView.GetPanel(index).GetView(0).Text, True)
		Log(subCatKvs.Get(categoryListView.GetPanel(index).GetView(0).Text))
		playSoundClick
		analytics.SendEvent("checked_Sub", Null)
	Else
		categoryListView.GetPanel(index).GetView(1).SetBitmap(unchecked)
		isChecked  = False
		subCatKvs.Put(categoryListView.GetPanel(index).GetView(0).Text, False)
		Log(subCatKvs.Get(categoryListView.GetPanel(index).GetView(0).Text))
		analytics.SendEvent("unchecked_Sub", Null)
	End If
End Sub

Sub chk_Click
	clickPanel_Click
End Sub

Sub checkOffDropDown(ddList As List, isChecked As Boolean)
	Dim isDroppedDown As Boolean = getDropDownStatus(ddList)
	If isDroppedDown Then
		For i = 0 To categoryListView.Size -1
			For d = 0 To ddList.Size - 1
				If ddList.Get(d) == categoryListView.GetPanel(i).GetView(0).Text Then
					If isChecked Then
						categoryListView.GetPanel(i).GetView(1).SetBitmap(checked)
					Else
						categoryListView.GetPanel(i).GetView(1).SetBitmap(unchecked)
					End If
				End If
			Next
		Next
	End If
End Sub

Sub clickPanel_Click
	playSoundClick
	Dim isChecked As Boolean = False
	Dim index As Int = categoryListView.GetItemFromView(Sender)
	Log(index)
	If categoryListView.GetPanel(index).GetView(1).GetBitmap = unchecked Then
		categoryListView.GetPanel(index).GetView(1).SetBitmap(checked)
		isChecked = True
		catKvs.Put(categoryListView.GetPanel(index).GetView(0).Text, True)
		Log(catKvs.Get(categoryListView.GetPanel(index).GetView(0).Text))
		playSoundClick
		analytics.SendEvent("user_action_checked", Null)
	Else
		categoryListView.GetPanel(index).GetView(1).SetBitmap(unchecked)
		isChecked  = False
		catKvs.Put(categoryListView.GetPanel(index).GetView(0).Text, False)
		analytics.SendEvent("user_action_unchecked", Null)
	End If
	Dim newIndex As Int = index
	' ADD TRIVIA
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Science" Then
		'SCIENCE
		If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
			catKvs.Put("Science", True)
			subCatKvs.Put("Biology", True)
			subCatKvs.put("Chemistry", True)
			subCatKvs.put("Physics", True)	
			subCatKvs.put("Anatomy", True)	
		Else
			catKvs.Put("Science", False)
			subCatKvs.Put("Biology", False)
			subCatKvs.put("Chemistry", False)
			subCatKvs.put("Physics", False)
			subCatKvs.put("Anatomy", False)
		End If
		checkOffDropDown(subCatListScience, isChecked)
	End If

	If categoryListView.GetPanel(newIndex).GetView(0).Text = "History" Then
		'HISTORY
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("History", True)
				subCatKvs.put("World", True)
				subCatKvs.put("US", True)
				subCatKvs.put("Roman Empire", True)
				subCatKvs.put("Ancient Egypt", True)
				subCatKvs.put("World War 2", True)
				subCatKvs.put("Revolutionary War", True)
				subCatKvs.put("Crime History", True)
			Else
				catKvs.Put("History", False)
				subCatKvs.put("World", False)
				subCatKvs.put("US", False)
				subCatKvs.put("Roman Empire", False)
				subCatKvs.put("Ancient Egypt", False)
				subCatKvs.put("World War 2", False)
				subCatKvs.put("Revolutionary War", False)
				subCatKvs.Put("Crime History", False)
			End If
			checkOffDropDown(subCatListHistory, isChecked)
		End If
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Culture" Then
		'CULTURE
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then	
				catKvs.Put("Culture", True)
				subCatKvs.put("Movies", True)
				subCatKvs.put("TV", True)
				subCatKvs.put("Fashion", True)
				subCatKvs.put("Nineties Culture", True)
				subCatKvs.put("Reality TV", True)
			Else
				catKvs.Put("Culture", False)
				subCatKvs.put("Movies", False)
				subCatKvs.put("TV", False)
				subCatKvs.put("Fashion", False)
				subCatKvs.put("Nineties Culture", False)
				subCatKvs.put("Reality TV", False)
			End If
			checkOffDropDown(subCatListCulture, isChecked)
		End If
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Music" Then
		'MUSIC
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("Music", True)
				subCatKvs.put("Rock", True)
				subCatKvs.put("Eighties", True)
				subCatKvs.put("Nineties Music", True)
				subCatKvs.put("Beatles", True)
			Else
				catKvs.Put("Music", False)
				subCatKvs.put("Rock", False)
				subCatKvs.put("Eighties", False)
				subCatKvs.put("Nineties Music", False)
				subCatKvs.put("Beatles", False)
			End If
			checkOffDropDown(subCatListMusic, isChecked)
		End If
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Sports" Then
			'SPORTS
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("Sports", True)
				subCatKvs.put("Basketball", True)
				subCatKvs.put("Golf", True)
				subCatKvs.put("Baseball", True)
			Else
				catKvs.Put("Sports", False)
				subCatKvs.put("Basketball", False)
				subCatKvs.put("Golf", False)
				subCatKvs.put("Baseball", False)
			End If
			checkOffDropDown(subCatListSports, isChecked)
		End If
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Religion" Then
		'Religion
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("Religion", True)
				subCatKvs.put("Islam", True)
				subCatKvs.put("Bible", True)
			Else
				catKvs.Put("Religion", False)
				subCatKvs.put("Islam", False)
				subCatKvs.put("Bible", False)
			End If
			checkOffDropDown(subCatListReligion, isChecked)
		End If
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Vehicle" Then
			'Vehicle
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("Vehicle", True)
				subCatKvs.put("Car Mechanic", True)
				subCatKvs.put("CDL", True)
				subCatKvs.put("Sailing", True)
			Else
				catKvs.Put("Vehicle", False)
				subCatKvs.put("Car Mechanic", False)
				subCatKvs.put("CDL", False)
				subCatKvs.put("Sailing", False)
			End If
			checkOffDropDown(subCatListVehicle, isChecked)
		End If
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Technology" Then
			'Technology
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("Technology", True)
				subCatKvs.put("Windows OS", True)
			Else
				catKvs.Put("Technology", False)
				subCatKvs.put("Windows OS", False)
			End If
			checkOffDropDown(subCatListTech, isChecked)
	End If
	
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Geography" Then
			'Technology
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("Geography", True)
				subCatKvs.put("US Geography", True)
				subCatKvs.put("World Geography", True)
			Else
				catKvs.Put("Geography", False)
				subCatKvs.put("World Geography", False)
				subCatKvs.put("US Geography", False)
			End If
			checkOffDropDown(subCatListGeography, isChecked)
	End If
	
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Humanities" Then
			'Technology
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("Humanities", True)
				subCatKvs.put("Literature", True)
				subCatKvs.put("Philosophy", True)
			Else
				catKvs.Put("Humanities", False)
				subCatKvs.put("Literature", False)
				subCatKvs.put("Philosophy", False)
			End If
			checkOffDropDown(subCatListHumanities, isChecked)
	End If
	
	If categoryListView.GetPanel(newIndex).GetView(0).Text = "Holidays" Then
			'Technology
			If categoryListView.GetPanel(newIndex).GetView(1).GetBitmap = checked Then
				catKvs.Put("Holidays", True)
				subCatKvs.put("Christmas", True)
				'subCatKvs.Put("Tutorial", True)
			Else
			catKvs.Put("Holidays", False)
			subCatKvs.put("Christmas", False)
			'subCatKvs.Put("Tutorial", False)
			End If
			checkOffDropDown(subCatListHolidays, isChecked)
	End If
	
	If dropDownBool Then
		If categoryListView.GetPanel(index).GetView(1).GetBitmap = checked Then
		For i = 0 To categoryListView.Size - 1
			If categoryListView.GetPanel(i).GetView(0).Left = 40dip And categoryListView.GetPanel(i).Visible = True Then
				subCatKvs.Put(subCatList.Get(i), True)
				categoryListView.GetPanel(i).GetView(1).SetBitmap(checked)
			End If
		Next
		Else
			For i = 0 To categoryListView.Size - 1
				If categoryListView.GetPanel(i).GetView(0).Left = 40dip And categoryListView.GetPanel(i).Visible = True Then
					subCatKvs.Put(subCatList.Get(i), False)
					categoryListView.GetPanel(i).GetView(1).SetBitmap(unchecked)
				End If
			Next
		End If
	End If
	checkSubCats
End Sub

Private Sub catButton_Click
	playSoundClick
	Page1.RootPanel.RemoveAllViews
	Page1.RootPanel.LoadLayout("categoryPage")
	showPage(NavControl,Page1,3)
	If backButtonBool Then
		backButton.Visible = True
		Else 
			backButton.Visible = False
	End If
	getBannerAd
	getCatSettings ' loads settings button status'
	analytics.SendEvent("cat_button_click", Null)
	If 1 == settingsKvs.Get("1") Then
		categoryDarkTheme
		Else
		categoryLightTheme
	End If
	If toggleAlphaKvs.Get("1") == False Then
			getAlphaCLV
		Else
			getCLV 'get in expandable format
	End If
	
End Sub

Private Sub titleCatCLV_Click
	clickTutorialPanel.Visible = False
	clickGifView.mBase.Visible = False
	catButton_Click
End Sub

Private Sub titleCatCLV_ItemClick (Index As Int, Value As Object)
	clickTutorialPanel.Visible = False
	clickGifView.mBase.Visible = False
	catButton_Click
End Sub

Sub getTitleCatCLVItems
	Sleep(5)
	Dim CLVtitlePanel As B4XView = xui.CreatePanel("")
	CLVtitlePanel.SetLayoutAnimated(0, 0, 0, titleCatCLV.AsView.Width, 30dip)
	Dim CLVtitleLabel As Label
	CLVtitlePanel.Color = Colors.ARGB(255, 252,251,244)
	CLVtitleLabel.Initialize("CLVtitleLabel")
	CLVtitleLabel.Text = "Categories Selected"
	CLVtitleLabel.Font = Font.CreateNew(10)
	CLVtitleLabel.SizeToFit
	CLVtitlePanel.AddView(CLVtitleLabel, ((titleCatCLV.AsView.Width/2) - (CLVtitleLabel.Width/2)), 1, 100, 30dip)
	titleCatCLV.Add(CLVtitlePanel, 0)
	For i = 0 To catList.Size -1
		Log(catKvs.Get(catList.Get(i)))
		If catKvs.Get(catList.Get(i)) Then
			Dim p As B4XView = xui.CreatePanel("")
			p.SetLayoutAnimated(0, 0, 0, titleCatCLV.AsView.Width, 30dip)
			Dim catLabel As Label
			catLabel.Initialize("catLabel")
			catLabel.Text = catList.Get(i)
			catLabel.Font = Font.CreateNew(15) 
			catLabel.SizeToFit
			Sleep(0)
			p.AddView(catLabel, ((titleCatCLV.AsView.Width/2) - (catLabel.Width/2)), 6, 100, 30dip)
			catLabel.SizeToFit
			titleCatCLV.Add(p, i)
			panelCount = panelCount + 1
		End If

		Log("panelCount: " & panelCount)
	Next
	If panelCount == 0 Then	
		noCatSelectedDialg
		catButton_Click
	End If
	colorizeTitleListView
End Sub

Sub colorizeTitleListView
	Try
		Sleep(5)
		For i = 0 To panelCount
			Dim colorizePanel As B4XView = titleCatCLV.GetPanel(i)
			If 1 == settingsKvs.Get("1") Then
				titleCatCLV.sv.ScrollViewInnerPanel.Color = Colors.White
				colorizePanel.Color = Colors.DarkGray
				colorizePanel.getview(0).TextColor = Colors.White
			Else
				titleCatCLV.sv.ScrollViewInnerPanel.Color = Colors.DarkGray
				colorizePanel.Color = Colors.White
				colorizePanel.getview(0).TextColor = Colors.Black
			End If
		Next
	Catch
		catchToFirebase(LastException)
		Log(LastException)
	End Try
End Sub

Sub getCatList
	' ADD TRIVIA
	catList.Set(0, "Science")
	catList.Set(1, "History")
	catList.Set(2, "Culture")
	catList.Set(3, "Music")
	catList.Set(4, "Sports")
	catList.Set(5, "Religion")
	catList.Set(6, "Vehicle")
	catList.Set(7, "Technology")
	catList.Set(8, "Geography")
	catList.Set(9, "Humanities")
	catList.Set(10, "Holidays")
End Sub

Sub getMainCatImages
	ScienceImage.Initialize(File.DirAssets, "science.png")
	historyImage.Initialize(File.DirAssets, "history.png")
	cultureImage.Initialize(File.DirAssets, "culture.png")
	musicImage.Initialize(File.DirAssets, "music.png")
	sportsImage.Initialize(File.DirAssets, "sports.png")
	religionImage.Initialize(File.DirAssets, "religion.png")
	vehicleImage.Initialize(File.DirAssets, "vehicles.png")
	techImage.Initialize(File.DirAssets, "tech.png")
	geoImage.Initialize(File.DirAssets, "geo.png")
	humanitiesImage.Initialize(File.DirAssets, "history-book.png")
	holidaysImage.Initialize(File.DirAssets, "holidays.png")
	
	mainCatImages.Add(ScienceImage)
	mainCatImages.Add(historyImage)
	mainCatImages.Add(cultureImage)
	mainCatImages.Add(musicImage)
	mainCatImages.Add(sportsImage)
	mainCatImages.Add(religionImage)
	mainCatImages.Add(vehicleImage)
	mainCatImages.Add(techImage)
	mainCatImages.Add(geoImage)
	mainCatImages.Add(humanitiesImage)
	mainCatImages.Add(holidaysImage)
End Sub

Sub getSubCatImages
	' ADD TRIVIA
	anatomy.Initialize(File.DirAssets, "anatomy.png")
	egyptIcon.Initialize(File.DirAssets, "pyramid.png")
	baseball.Initialize(File.DirAssets, "baseball.png")
	basketball.Initialize(File.DirAssets, "basketball.png")
	beatles.Initialize(File.DirAssets, "beatles.png")
	bible.Initialize(File.DirAssets, "bible.png")
	biology.Initialize(File.DirAssets, "biology.png")
	cdl.Initialize(File.DirAssets, "cdl.png")
	mechanic.Initialize(File.DirAssets, "mechanic.png")
	chemistry.Initialize(File.DirAssets, "chemistry.png")
	christmas.Initialize(File.DirAssets, "christmas.png")
	crimeHistory.Initialize(File.DirAssets, "criminalHistory.png")
	eightiesMusic.Initialize(File.DirAssets, "80sMusic.png")
	fashion.Initialize(File.DirAssets, "fashion.png")
	golf.Initialize(File.DirAssets, "golf.png")
	islam.Initialize(File.DirAssets, "islam.png")
	literature.Initialize(File.DirAssets, "literature.png")
	movies.Initialize(File.DirAssets, "movies.png")
	ninetiesCulture.Initialize(File.DirAssets, "90s.png")
	nintiesMusic.Initialize(File.DirAssets, "90sMusic.png")
	philosophy.Initialize(File.DirAssets, "philosophy.png")
	physics.Initialize(File.DirAssets, "physics.png")
	realityTV.Initialize(File.DirAssets, "realityTV.png")
	revWar.Initialize(File.DirAssets, "revWar.png")
	rock.Initialize(File.DirAssets, "rock.png")
	rome.Initialize(File.DirAssets, "rome.png")
	sailing.Initialize(File.DirAssets, "sailing.png")
	'tutorial.Initialize(File.DirAssets, "sailing.png")
	TV.Initialize(File.DirAssets, "tv.png")
	US.Initialize(File.DirAssets, "USHistory.png")
	USGeography.Initialize(File.DirAssets, "USgeo.png")
	windows.Initialize(File.DirAssets, "windows.png")
	worldHistory.Initialize(File.DirAssets, "worldHistory.png")
	worldGeography.Initialize(File.DirAssets, "worldgeography.png")
	WWTwo.Initialize(File.DirAssets, "ww2.png")
		
	subCatImages.Add(anatomy)
	subCatImages.Add(egyptIcon)
	subCatImages.Add(baseball)
	subCatImages.Add(basketball)
	subCatImages.Add(beatles)
	subCatImages.Add(bible)
	subCatImages.Add(biology)
	subCatImages.Add(cdl)
	subCatImages.Add(mechanic)
	subCatImages.Add(chemistry)
	subCatImages.Add(christmas)
	subCatImages.Add(crimeHistory)
	subCatImages.Add(eightiesMusic)
	subCatImages.Add(fashion)
	subCatImages.Add(golf)
	subCatImages.Add(islam)
	subCatImages.Add(literature)
	subCatImages.Add(movies)
	subCatImages.Add(ninetiesCulture)
	subCatImages.Add(nintiesMusic)
	subCatImages.Add(philosophy)
	subCatImages.Add(physics)
	subCatImages.Add(realityTV)
	subCatImages.Add(revWar)
	subCatImages.Add(rock)
	subCatImages.Add(rome)
	subCatImages.Add(sailing)
	'subCatImages.Add(tutorial)
	subCatImages.Add(TV)	
	subCatImages.Add(US)	
	subCatImages.Add(USGeography)	
	subCatImages.Add(windows)
	subCatImages.Add(worldHistory)
	subCatImages.Add(worldGeography)
	subCatImages.Add(WWTwo)
End Sub

Sub getSubCatList
	' ADD TRIVIA
	'SCIENCE
	subCatListScience.Add("Biology")
	subCatListScience.Add("Chemistry")
	subCatListScience.Add("Physics")
	subCatListScience.Add("Anatomy")
	'HISTORY
	subCatListHistory.Add("World")
	subCatListHistory.Add("US")
	subCatListHistory.Add("Roman Empire")
	subCatListHistory.Add("Ancient Egypt")
	subCatListHistory.Add("World War 2")
	subCatListHistory.Add("Revolutionary War")
	subCatListHistory.Add("Crime History")
	'CULTURE
	subCatListCulture.Add("Movies")
	subCatListCulture.Add("TV")
	subCatListCulture.Add("Fashion")
	subCatListCulture.Add("Nineties Culture")
	subCatListCulture.Add("Reality TV")
	'MUSIC
	subCatListMusic.Add("Rock")
	subCatListMusic.Add("Eighties")
	subCatListMusic.Add("Nineties Music")
	subCatListMusic.Add("Beatles")
	'SPORTS
	subCatListSports.Add("Basketball")
	subCatListSports.Add("Golf")
	subCatListSports.Add("Baseball")
	'Religion
	subCatListReligion.Add("Islam")
	subCatListReligion.Add("Bible")
	'Vehicle
	subCatListVehicle.Add("Car Mechanic")
	subCatListVehicle.Add("CDL")
	subCatListVehicle.Add("Sailing")
	'Technology
	subCatListTech.Add("Windows OS")
	'Geography
	subCatListGeography.Add("US Geography")
	subCatListGeography.Add("World Geography")
	'Humanities
	subCatListHumanities.Add("Literature")
	subCatListHumanities.Add("Philosophy")
	'Holidays
	subCatListHolidays.Add("Christmas")
	'subCatListHolidays.Add("Tutorial")

	' ADD TRIVIA!
	subCatList.AddAll(subCatListScience)
	subCatList.AddAll(subCatListHistory)
	subCatList.AddAll(subCatListCulture)
	subCatList.AddAll(subCatListMusic)
	subCatList.AddAll(subCatListSports)
	subCatList.AddAll(subCatListReligion)
	subCatList.AddAll(subCatListVehicle)
	subCatList.AddAll(subCatListTech)
	subCatList.AddAll(subCatListGeography)
	subCatList.AddAll(subCatListHumanities)
	subCatList.AddAll(subCatListHolidays)
End Sub

Private Sub catTitleLabel_Click
	catButton_Click
End Sub

Private Sub clickTutorialPanel_Click
	clickTutorialPanel.Visible = False
	clickGifView.mBase.Visible = False
End Sub

Private Sub clickGifView_Click
	clickTutorialPanel.Visible = False
	clickGifView.mBase.Visible = False
End Sub

Private Sub clickTutorialMasterPanel_Click
	clickTutorialPanel.Visible = False
	clickGifView.mBase.Visible = False
End Sub

Private Sub catViewOnStartButton_Click
	playSoundClick
	If toggleCatStartupKvs.Get("1") == False Then
		catViewOnStartImg.Bitmap = startUpOffBitmap
		toggleCatStartupKvs.Put("1", True)
	Else
		catViewOnStartImg.Bitmap = startUpOnBitmap
		toggleCatStartupKvs.Put("1", False)
	End If
End Sub

Private Sub AlphabeticalToggleButton_Click
	playSoundClick
	checkSubCats
	If toggleAlphaKvs.Get("1") == False Then
		AlphabeticalToggleImg.Bitmap = categoryViewBitmap
		toggleAlphaKvs.Put("1", True)
	Else
		AlphabeticalToggleImg.Bitmap = alphaViewBitmap
		toggleAlphaKvs.Put("1", False)
	End If
	catButton_Click
End Sub

Private Sub catDoneButton_Click
	playSoundClick
	checkSubCats
	If backButtonBool Then
		backButton_Click
	End If
End Sub

Private Sub doneImageView_Click
	checkSubCats
	catDoneButton_Click
End Sub

Private Sub catViewOnStartImg_Click
	catViewOnStartButton_Click
End Sub

Private Sub AlphabeticalToggleImg_Click
	AlphabeticalToggleButton_Click
End Sub

Private Sub subCatImageView_Click
	
End Sub

Private Sub doneButtonIntro_Click
	
End Sub

