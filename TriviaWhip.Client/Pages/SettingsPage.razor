@page "/settings"
@inject SettingsService SettingsService
@inject ProfileService ProfileService

<h2>Settings</h2>
<div class="main-card">
    <div class="stat-grid">
        <div class="stat-card">
            <div class="setting-toggle-list">
                <button type="button" class="checkbox-button toggle-button" @onclick="() => SettingsService.Current.DarkTheme = !SettingsService.Current.DarkTheme" aria-pressed="@SettingsService.Current.DarkTheme">
                    <img class="checkbox-icon" src="@GetCheckboxImage(SettingsService.Current.DarkTheme)" alt="Dark Theme toggle" />
                    <span>Dark Theme</span>
                </button>
                <button type="button" class="checkbox-button toggle-button" @onclick="() => SettingsService.Current.TimerMode = !SettingsService.Current.TimerMode" aria-pressed="@SettingsService.Current.TimerMode">
                    <img class="checkbox-icon" src="@GetCheckboxImage(SettingsService.Current.TimerMode)" alt="Timer Mode toggle" />
                    <span>Timer Mode</span>
                </button>
                <button type="button" class="checkbox-button toggle-button" @onclick="() => SettingsService.Current.AchievementMode = !SettingsService.Current.AchievementMode" aria-pressed="@SettingsService.Current.AchievementMode">
                    <img class="checkbox-icon" src="@GetCheckboxImage(SettingsService.Current.AchievementMode)" alt="Achievement Mode toggle" />
                    <span>Achievement Mode</span>
                </button>
                <button type="button" class="checkbox-button toggle-button" @onclick="() => SettingsService.Current.EnableQuestionButtons = !SettingsService.Current.EnableQuestionButtons" aria-pressed="@SettingsService.Current.EnableQuestionButtons">
                    <img class="checkbox-icon" src="@GetCheckboxImage(SettingsService.Current.EnableQuestionButtons)" alt="Help Icons toggle" />
                    <span>Help Icons</span>
                </button>
            </div>
        </div>
        <div class="stat-card">
            <label>Questions per Game</label>
            <input type="range" min="5" max="50" step="5" @bind="SettingsService.Current.QuestionCount" />
            <p>@SettingsService.Current.QuestionCount questions</p>
        </div>
        <div class="stat-card">
            <label>Scheme Color</label>
            <select @bind="SettingsService.Current.SchemeColor">
                @for (var i = 0; i < 9; i++)
                {
                    <option value="@i">Scheme @i</option>
                }
            </select>
        </div>
        <div class="stat-card">
            <label>Avatar</label>
            <select @bind="SettingsService.Current.Avatar">
                @for (var i = 0; i < 9; i++)
                {
                    <option value="@i">Avatar @i</option>
                }
            </select>
        </div>
    </div>
    <div class="button-bar" style="margin-top:1rem;">
        <button class="primary-button" @onclick="Save">Save Settings</button>
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await SettingsService.InitializeAsync();
        await ProfileService.InitializeAsync();
    }

    private async Task Save()
    {
        await SettingsService.SaveAsync();
    }

    private string GetCheckboxImage(bool isChecked)
    {
        return $"Files/{(isChecked ? "checked-white.png" : "unchecked-white.png")}";
    }
}
